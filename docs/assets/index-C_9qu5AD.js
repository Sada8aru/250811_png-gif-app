(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function r(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(e){if(e.ep)return;e.ep=!0;const n=r(e);fetch(e.href,n)}})();const rn=()=>({backgroundDropzone:document.getElementById("backgroundDropzone"),transparentDropzone:document.getElementById("transparentDropzone"),backgroundButton:document.getElementById("backgroundButton"),transparentButton:document.getElementById("transparentButton"),backgroundInput:document.getElementById("backgroundInput"),transparentInput:document.getElementById("transparentInput"),previewContainer:document.getElementById("previewContainer"),previewCanvas:document.getElementById("previewCanvas"),previewPlaceholder:document.getElementById("previewPlaceholder"),boundingBox:document.getElementById("boundingBox"),cropBox:document.getElementById("cropBox"),modeToggleEdit:document.getElementById("modeToggleEdit"),modeToggleCrop:document.getElementById("modeToggleCrop"),cropControls:document.getElementById("cropControls"),scaleInput:document.getElementById("scaleInput"),aspectRatioSelect:document.getElementById("aspectRatioSelect"),animationSpeedInput:document.getElementById("animationSpeedInput"),animationSpeedValue:document.getElementById("animationSpeedValue"),exportPngButton:document.getElementById("exportPngButton"),exportGifButton:document.getElementById("exportGifButton"),errorMessage:document.getElementById("errorMessage"),alignmentButtons:document.querySelectorAll("[data-align-target]"),positionInputX:document.getElementById("positionInputX"),positionInputY:document.getElementById("positionInputY"),positionStepperButtons:document.querySelectorAll("[data-position-step]")});let Ze;const At=()=>(Ze=rn(),Ze),H=()=>Ze??At(),on=()=>({scale:1,position:{x:0,y:0},cropArea:null,aspectRatio:"original"}),g={backgroundImage:null,transparentImages:[],transformState:on(),outputSettings:{format:"PNG",maxWidth:1200,maxHeight:675},animationSettings:{frameDelay:500}},P=t=>{const{errorMessage:a}=H();a&&(a.textContent=t,a.style.display="block",a.style.backgroundColor="#f44336",a.style.color="white",setTimeout(()=>{a.style.display="none"},5e3))},Te=t=>{const{errorMessage:a}=H();a&&(a.textContent=t,a.style.display="block",a.style.backgroundColor="#4CAF50",a.style.color="white",setTimeout(()=>{a.style.display="none",a.style.backgroundColor="#f44336",a.style.color="white"},3e3))};let E,Je,V,Z,pe,ve,Qe,lt,ct;const sn=()=>{const t=H();E=t.previewCanvas,Je=t.previewPlaceholder,V=t.boundingBox,Z=t.cropBox,pe=t.modeToggleEdit,ve=t.modeToggleCrop,Qe=t.cropControls,lt=t.exportPngButton,ct=t.exportGifButton,et()};let De=null,Pe=0,A=!1,xe=!1,Ee=null;const ze=t=>{xe=t},et=()=>{!pe||!ve||(A?(ve.classList.add("mode-toggle__button--active"),ve.setAttribute("aria-pressed","true"),pe.classList.remove("mode-toggle__button--active"),pe.setAttribute("aria-pressed","false")):(pe.classList.add("mode-toggle__button--active"),pe.setAttribute("aria-pressed","true"),ve.classList.remove("mode-toggle__button--active"),ve.setAttribute("aria-pressed","false")))},we=(t,a,r,s,e=null,n={})=>{const{useCropAreaOffset:c=!0}=n,m=t.metadata.width*a,l=t.metadata.height*a,h=r.x+(s.metadata.width-m)/2,d=r.y+(s.metadata.height-l)/2;if(e&&c){const o=h-e.x,i=d-e.y;return{x:o,y:i,width:m,height:l,baseX:h,baseY:d,cropOffsetX:e.x,cropOffsetY:e.y}}return{x:h,y:d,width:m,height:l}},Tt=()=>{if(!g.backgroundImage)return;const t=g.backgroundImage,a=E.getContext("2d",{willReadFrequently:!0});if(a.clearRect(0,0,E.width,E.height),a.drawImage(t.image,0,0),g.transparentImages.length>0){const r=g.transparentImages[0],s=g.transformState.scale,e=g.transformState.position,n=r.metadata.width*s,c=r.metadata.height*s,m=e.x+(t.metadata.width-n)/2,l=e.y+(t.metadata.height-c)/2;console.log("トリミングモード描画:",{posX:e.x,posY:e.y,bgWidth:t.metadata.width,bgHeight:t.metadata.height,scaledWidth:n,scaledHeight:c,absoluteX:m,absoluteY:l,cropArea:g.transformState.cropArea}),a.imageSmoothingEnabled=!1,a.drawImage(r.image,m,l,n,c)}},Xt=()=>{const t=!!g.backgroundImage;g.transparentImages.length>0,lt.disabled=!t,ct.disabled=!(t&&g.transparentImages.length>1)},Y=()=>{if(!g.backgroundImage){E.style.display="none",Je.style.display="flex",lt.disabled=!0,ct.disabled=!0;return}const t=g.backgroundImage,a=E.getContext("2d",{willReadFrequently:!0}),r=g.transformState.cropArea;if(A){E.width=t.metadata.width,E.height=t.metadata.height,Tt();return}if(r?(E.width=r.width,E.height=r.height):(E.width=t.metadata.width,E.height=t.metadata.height),De&&(clearInterval(De),De=null),g.transparentImages.length>1){Pe=0;const s=()=>{a.clearRect(0,0,E.width,E.height),A?a.drawImage(t.image,0,0):r?a.drawImage(t.image,r.x,r.y,r.width,r.height,0,0,E.width,E.height):a.drawImage(t.image,0,0);const e=g.transparentImages[Pe];if(e){const n=g.transformState.scale,c=g.transformState.position,m=we(e,n,c,t,r,{useCropAreaOffset:!A});a.imageSmoothingEnabled=!1,a.drawImage(e.image,m.x,m.y,m.width,m.height)}Pe=(Pe+1)%g.transparentImages.length};s(),De=setInterval(s,g.animationSettings.frameDelay)}else if(g.transparentImages.length===1){a.clearRect(0,0,E.width,E.height),r?a.drawImage(t.image,r.x,r.y,r.width,r.height,0,0,E.width,E.height):a.drawImage(t.image,0,0);const s=g.transparentImages[0],e=g.transformState.scale,n=g.transformState.position,c=we(s,e,n,t,r,{useCropAreaOffset:!A});a.imageSmoothingEnabled=!1,a.drawImage(s.image,c.x,c.y,c.width,c.height)}else a.clearRect(0,0,E.width,E.height),r?a.drawImage(t.image,r.x,r.y,r.width,r.height,0,0,E.width,E.height):a.drawImage(t.image,0,0);E.style.display="block",Je.style.display="none",Xt(),A?setTimeout(()=>ye(),100):g.transparentImages.length>0&&setTimeout(()=>ee(),100)},Ue=(t=1e3)=>{Ee&&(clearTimeout(Ee),Ee=null),xe=!0,ee(),Ee=setTimeout(()=>{xe=!1,ee(),Ee=null},t)},mt={"top-left":{horizontal:"start",vertical:"start"},"top-center":{horizontal:"center",vertical:"start"},"top-right":{horizontal:"end",vertical:"start"},"middle-left":{horizontal:"start",vertical:"center"},"middle-center":{horizontal:"center",vertical:"center"},"middle-right":{horizontal:"end",vertical:"center"},"bottom-left":{horizontal:"start",vertical:"end"},"bottom-center":{horizontal:"center",vertical:"end"},"bottom-right":{horizontal:"end",vertical:"end"}},ft=(t,a,r,s)=>{const e=r,n=r+s-a;return n<e?r+(s-a)/2:Math.min(Math.max(t,e),n)},pt=(t,a,r,s)=>{switch(t){case"start":return a;case"end":return a+r-s;case"center":default:return a+(r-s)/2}},ln=t=>{if(!mt[t]||!g.backgroundImage||g.transparentImages.length===0)return;const a=g.backgroundImage,r=g.transparentImages[0],s=g.transformState.scale,e=g.transformState.cropArea,n=r.metadata.width*s,c=r.metadata.height*s,m=e?{x:e.x,y:e.y,width:e.width,height:e.height}:{x:0,y:0,width:a.metadata.width,height:a.metadata.height},l=mt[t],h=pt(l.horizontal,m.x,m.width,n),d=pt(l.vertical,m.y,m.height,c),o=ft(h,n,m.x,m.width),i=ft(d,c,m.y,m.height);g.transformState.position.x=o-(a.metadata.width-n)/2,g.transformState.position.y=i-(a.metadata.height-c)/2,ze(!0),Y(),Ue(1200)},ee=()=>{if(!g.backgroundImage||g.transparentImages.length===0||A||!xe){V.style.display="none";return}const t=g.backgroundImage,a=g.transparentImages[0],r=g.transformState.scale,s=g.transformState.position,e=g.transformState.cropArea,n=E.getBoundingClientRect(),c=we(a,r,s,t,e),m=(()=>{if(e){const u=n.width/e.width,v=n.height/e.height;return Math.min(u,v)}const x=n.width/t.metadata.width,f=n.height/t.metadata.height;return Math.min(x,f)})(),l=e?(n.width-e.width*m)/2:(n.width-t.metadata.width*m)/2,h=e?(n.height-e.height*m)/2:(n.height-t.metadata.height*m)/2,d=c.x*m+l,o=c.y*m+h,i=c.width*m,p=c.height*m;V.style.display="block",V.style.left=d+"px",V.style.top=o+"px",V.style.width=i+"px",V.style.height=p+"px"},Yt=t=>{switch(t){case"1:1":return 1;case"16:9":return 16/9;case"4:3":return 4/3;case"free":return null;case"original":default:return g.backgroundImage?g.backgroundImage.metadata.width/g.backgroundImage.metadata.height:1}},ye=()=>{if(!g.backgroundImage||!A){Z.style.display="none";return}const t=g.backgroundImage,a=E.getBoundingClientRect(),r=a.width/t.metadata.width,s=a.height/t.metadata.height,e=Math.min(r,s);let n=g.transformState.cropArea;if(!n){if(g.transformState.aspectRatio==="original"||g.transformState.aspectRatio==="free")n={x:0,y:0,width:t.metadata.width,height:t.metadata.height};else{const i=Yt(g.transformState.aspectRatio),p=t.metadata.width/t.metadata.height;let x,f;i>p?(x=t.metadata.width,f=x/i):(f=t.metadata.height,x=f*i),n={x:(t.metadata.width-x)/2,y:(t.metadata.height-f)/2,width:x,height:f}}g.transformState.cropArea=n}const c=n.x*e,m=n.y*e,l=n.width*e,h=n.height*e,d=(a.width-t.metadata.width*e)/2,o=(a.height-t.metadata.height*e)/2;Z.style.display="block",Z.style.left=c+d+"px",Z.style.top=m+o+"px",Z.style.width=l+"px",Z.style.height=h+"px"},tt=t=>{const a=!!t;if(A===a){et();return}if(A=a,A){Qe.style.display="block",V.style.display="none",xe=!1;const r=g.backgroundImage;r&&(E.width=r.metadata.width,E.height=r.metadata.height,Tt()),ye()}else Qe.style.display="none",Z.style.display="none",xe=!1,ee(),Y();et()},he=()=>A;let zt,$t,Ot,Ut,Wt,qt,Nt=[],N,j,dt=[];const cn=()=>{const t=H();zt=t.scaleInput,$t=t.modeToggleEdit,Ot=t.modeToggleCrop,Ut=t.animationSpeedInput,Wt=t.animationSpeedValue,qt=t.aspectRatioSelect,Nt=Array.from(t.alignmentButtons??[]),N=t.positionInputX,j=t.positionInputY,dt=Array.from(t.positionStepperButtons??[])},dn=()=>!!(g.backgroundImage&&g.transparentImages.length>0),ht=()=>{if(!dn())return null;const t=g.backgroundImage,a=g.transparentImages[0];if(!a?.metadata)return null;const r=g.transformState.scale,s=a.metadata.width*r,e=a.metadata.height*r,n=g.transformState.cropArea,c=n?{x:n.x,y:n.y,width:n.width,height:n.height}:{x:0,y:0,width:t.metadata.width,height:t.metadata.height},m=g.transformState.position.x+(t.metadata.width-s)/2,l=g.transformState.position.y+(t.metadata.height-e)/2;return{bg:t,bounds:c,overlaySize:{width:s,height:e},absoluteX:m,absoluteY:l}},vt=(t,a,r,s)=>{const e=r,n=r+s-a;return n<e?r+(s-a)/2:Math.min(Math.max(t,e),n)},xt=t=>{[N,j,...dt].forEach(a=>{a&&(a.disabled=t)})},Q=()=>{if(!N||!j)return;const t=ht();if(!t){xt(!0),N.value="",j.value="";return}xt(!1),N.value=Math.round(t.absoluteX),j.value=Math.round(t.absoluteY),N.setAttribute("aria-valuemin",`${Math.round(t.bounds.x)}`),j.setAttribute("aria-valuemin",`${Math.round(t.bounds.y)}`);const a=t.bounds.x+t.bounds.width-t.overlaySize.width,r=t.bounds.y+t.bounds.height-t.overlaySize.height;N.setAttribute("aria-valuemax",`${Math.round(a)}`),j.setAttribute("aria-valuemax",`${Math.round(r)}`)},jt=(t,a,r)=>{const s=vt(a,t.overlaySize.width,t.bounds.x,t.bounds.width),e=vt(r,t.overlaySize.height,t.bounds.y,t.bounds.height);g.transformState.position.x=s-(t.bg.metadata.width-t.overlaySize.width)/2,g.transformState.position.y=e-(t.bg.metadata.height-t.overlaySize.height)/2,Y(),Ue(1e3),Q()},hn=(t,a)=>{const r=ht();if(!r)return;const s=t==="x"?r.absoluteX+a:r.absoluteX,e=t==="y"?r.absoluteY+a:r.absoluteY;jt(r,s,e)},un=(t,a)=>{const r=Number.parseInt(a,10);if(Number.isNaN(r))return;const s=ht();if(!s)return;const e=t==="x"?r:s.absoluteX,n=t==="y"?r:s.absoluteY;jt(s,e,n)},wt=t=>{const a=t.target.dataset.axis;a&&un(a,t.target.value)},gn=t=>{t.target.dataset.axis&&Number.isNaN(Number.parseInt(t.target.value,10))&&Q()},mn=()=>{!N||!j||([N,j].forEach(t=>{t.addEventListener("input",wt),t.addEventListener("change",wt),t.addEventListener("blur",gn)}),dt.forEach(t=>{t.addEventListener("click",()=>{const a=t.getAttribute("data-axis"),r=Number.parseInt(t.getAttribute("data-position-step"),10);!a||Number.isNaN(r)||hn(a,r)})}))},fn=()=>{if(!g.backgroundImage||g.transparentImages.length===0)return;const t=g.transparentImages[0],a=g.transformState.scale,r=t.metadata.width*a,s=t.metadata.height*a;(r>g.outputSettings.maxWidth||s>g.outputSettings.maxHeight)&&P(`拡大後のサイズ（${r}×${s}px）が出力サイズ制限（${g.outputSettings.maxWidth}×${g.outputSettings.maxHeight}px）を超えています。`)},pn=()=>{cn(),zt.addEventListener("input",t=>{const a=parseInt(t.target.value,10);g.transformState.scale=a,console.log("拡大倍率変更:",a),Y(),fn(),Q(),!he()&&g.transparentImages.length>0&&Ue(1e3)}),$t.addEventListener("click",()=>{tt(!1)}),Ot.addEventListener("click",()=>{tt(!0)}),Ut.addEventListener("input",t=>{const a=parseInt(t.target.value,10);g.animationSettings.frameDelay=a,Wt.textContent=`${a}ms`,console.log("アニメーション速度変更:",a+"ms"),g.transparentImages.length>1&&Y()}),qt.addEventListener("change",t=>{const a=t.target.value;g.transformState.aspectRatio=a,console.log("アスペクト比変更:",a),he()?(g.transformState.cropArea=null,ye()):Y()}),Nt.forEach(t=>{t.addEventListener("click",()=>{const a=t.getAttribute("data-align-target");a&&(console.log("整列ボタン押下:",a),ln(a),Q())})}),mn(),Q()};function vn(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ge={},yt;function xn(){if(yt)return Ge;yt=1;function t(e,n,c,h){var l=0,h=h===void 0?{}:h,d=h.loop===void 0?null:h.loop,o=h.palette===void 0?null:h.palette;if(n<=0||c<=0||n>65535||c>65535)throw new Error("Width/Height invalid.");function i(I){var b=I.length;if(b<2||b>256||b&b-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return b}e[l++]=71,e[l++]=73,e[l++]=70,e[l++]=56,e[l++]=57,e[l++]=97;var p=0,x=0;if(o!==null){for(var f=i(o);f>>=1;)++p;if(f=1<<p,--p,h.background!==void 0){if(x=h.background,x>=f)throw new Error("Background index out of range.");if(x===0)throw new Error("Background index explicitly passed as 0.")}}if(e[l++]=n&255,e[l++]=n>>8&255,e[l++]=c&255,e[l++]=c>>8&255,e[l++]=(o!==null?128:0)|p,e[l++]=x,e[l++]=0,o!==null)for(var u=0,v=o.length;u<v;++u){var w=o[u];e[l++]=w>>16&255,e[l++]=w>>8&255,e[l++]=w&255}if(d!==null){if(d<0||d>65535)throw new Error("Loop count invalid.");e[l++]=33,e[l++]=255,e[l++]=11,e[l++]=78,e[l++]=69,e[l++]=84,e[l++]=83,e[l++]=67,e[l++]=65,e[l++]=80,e[l++]=69,e[l++]=50,e[l++]=46,e[l++]=48,e[l++]=3,e[l++]=1,e[l++]=d&255,e[l++]=d>>8&255,e[l++]=0}var y=!1;this.addFrame=function(I,b,S,_,C,k){if(y===!0&&(--l,y=!1),k=k===void 0?{}:k,I<0||b<0||I>65535||b>65535)throw new Error("x/y invalid.");if(S<=0||_<=0||S>65535||_>65535)throw new Error("Width/Height invalid.");if(C.length<S*_)throw new Error("Not enough pixels for the frame size.");var F=!0,L=k.palette;if(L==null&&(F=!1,L=o),L==null)throw new Error("Must supply either a local or global palette.");for(var K=i(L),T=0;K>>=1;)++T;K=1<<T;var z=k.delay===void 0?0:k.delay,X=k.disposal===void 0?0:k.disposal;if(X<0||X>3)throw new Error("Disposal out of range.");var ge=!1,te=0;if(k.transparent!==void 0&&k.transparent!==null&&(ge=!0,te=k.transparent,te<0||te>=K))throw new Error("Transparent color index.");if((X!==0||ge||z!==0)&&(e[l++]=33,e[l++]=249,e[l++]=4,e[l++]=X<<2|(ge===!0?1:0),e[l++]=z&255,e[l++]=z>>8&255,e[l++]=te,e[l++]=0),e[l++]=44,e[l++]=I&255,e[l++]=I>>8&255,e[l++]=b&255,e[l++]=b>>8&255,e[l++]=S&255,e[l++]=S>>8&255,e[l++]=_&255,e[l++]=_>>8&255,e[l++]=F===!0?128|T-1:0,F===!0)for(var me=0,$=L.length;me<$;++me){var G=L[me];e[l++]=G>>16&255,e[l++]=G>>8&255,e[l++]=G&255}return l=a(e,l,T<2?2:T,C),l},this.end=function(){return y===!1&&(e[l++]=59,y=!0),l},this.getOutputBuffer=function(){return e},this.setOutputBuffer=function(I){e=I},this.getOutputBufferPosition=function(){return l},this.setOutputBufferPosition=function(I){l=I}}function a(e,n,c,m){e[n++]=c;var l=n++,h=1<<c,d=h-1,o=h+1,i=o+1,p=c+1,x=0,f=0;function u(k){for(;x>=k;)e[n++]=f&255,f>>=8,x-=8,n===l+256&&(e[l]=255,l=n++)}function v(k){f|=k<<x,x+=p,u(8)}var w=m[0]&d,y={};v(h);for(var I=1,b=m.length;I<b;++I){var S=m[I]&d,_=w<<8|S,C=y[_];if(C===void 0){for(f|=w<<x,x+=p;x>=8;)e[n++]=f&255,f>>=8,x-=8,n===l+256&&(e[l]=255,l=n++);i===4096?(v(h),i=o+1,p=c+1,y={}):(i>=1<<p&&++p,y[_]=i++),w=S}else w=C}return v(w),v(o),u(1),l+1===n?e[l]=0:(e[l]=n-l-1,e[n++]=0),n}function r(e){var n=0;if(e[n++]!==71||e[n++]!==73||e[n++]!==70||e[n++]!==56||(e[n++]+1&253)!==56||e[n++]!==97)throw new Error("Invalid GIF 87a/89a header.");var c=e[n++]|e[n++]<<8,m=e[n++]|e[n++]<<8,l=e[n++],h=l>>7,d=l&7,o=1<<d+1;e[n++],e[n++];var i=null,p=null;h&&(i=n,p=o,n+=o*3);var x=!0,f=[],u=0,v=null,w=0,y=null;for(this.width=c,this.height=m;x&&n<e.length;)switch(e[n++]){case 33:switch(e[n++]){case 255:if(e[n]!==11||e[n+1]==78&&e[n+2]==69&&e[n+3]==84&&e[n+4]==83&&e[n+5]==67&&e[n+6]==65&&e[n+7]==80&&e[n+8]==69&&e[n+9]==50&&e[n+10]==46&&e[n+11]==48&&e[n+12]==3&&e[n+13]==1&&e[n+16]==0)n+=14,y=e[n++]|e[n++]<<8,n++;else for(n+=12;;){var I=e[n++];if(!(I>=0))throw Error("Invalid block size");if(I===0)break;n+=I}break;case 249:if(e[n++]!==4||e[n+4]!==0)throw new Error("Invalid graphics extension block.");var b=e[n++];u=e[n++]|e[n++]<<8,v=e[n++],(b&1)===0&&(v=null),w=b>>2&7,n++;break;case 254:for(;;){var I=e[n++];if(!(I>=0))throw Error("Invalid block size");if(I===0)break;n+=I}break;default:throw new Error("Unknown graphic control label: 0x"+e[n-1].toString(16))}break;case 44:var S=e[n++]|e[n++]<<8,_=e[n++]|e[n++]<<8,C=e[n++]|e[n++]<<8,k=e[n++]|e[n++]<<8,F=e[n++],L=F>>7,K=F>>6&1,T=F&7,z=1<<T+1,X=i,ge=p,te=!1;if(L){var te=!0;X=n,ge=z,n+=z*3}var me=n;for(n++;;){var I=e[n++];if(!(I>=0))throw Error("Invalid block size");if(I===0)break;n+=I}f.push({x:S,y:_,width:C,height:k,has_local_palette:te,palette_offset:X,palette_size:ge,data_offset:me,data_length:n-me,transparent_index:v,interlaced:!!K,delay:u,disposal:w});break;case 59:x=!1;break;default:throw new Error("Unknown gif block: 0x"+e[n-1].toString(16))}this.numFrames=function(){return f.length},this.loopCount=function(){return y},this.frameInfo=function($){if($<0||$>=f.length)throw new Error("Frame index out of range.");return f[$]},this.decodeAndBlitFrameBGRA=function($,G){var B=this.frameInfo($),_e=B.width*B.height,ne=new Uint8Array(_e);s(e,B.data_offset,ne,_e);var ae=B.palette_offset,re=B.transparent_index;re===null&&(re=256);var O=B.width,oe=c-O,ie=O,ke=(B.y*c+B.x)*4,We=((B.y+B.height)*c+B.x)*4,R=ke,se=oe*4;B.interlaced===!0&&(se+=c*4*7);for(var le=8,ce=0,qe=ne.length;ce<qe;++ce){var U=ne[ce];if(ie===0&&(R+=se,ie=O,R>=We&&(se=oe*4+c*4*(le-1),R=ke+(O+oe)*(le<<1),le>>=1)),U===re)R+=4;else{var Ne=e[ae+U*3],je=e[ae+U*3+1],He=e[ae+U*3+2];G[R++]=He,G[R++]=je,G[R++]=Ne,G[R++]=255}--ie}},this.decodeAndBlitFrameRGBA=function($,G){var B=this.frameInfo($),_e=B.width*B.height,ne=new Uint8Array(_e);s(e,B.data_offset,ne,_e);var ae=B.palette_offset,re=B.transparent_index;re===null&&(re=256);var O=B.width,oe=c-O,ie=O,ke=(B.y*c+B.x)*4,We=((B.y+B.height)*c+B.x)*4,R=ke,se=oe*4;B.interlaced===!0&&(se+=c*4*7);for(var le=8,ce=0,qe=ne.length;ce<qe;++ce){var U=ne[ce];if(ie===0&&(R+=se,ie=O,R>=We&&(se=oe*4+c*4*(le-1),R=ke+(O+oe)*(le<<1),le>>=1)),U===re)R+=4;else{var Ne=e[ae+U*3],je=e[ae+U*3+1],He=e[ae+U*3+2];G[R++]=Ne,G[R++]=je,G[R++]=He,G[R++]=255}--ie}}}function s(e,n,c,m){for(var l=e[n++],h=1<<l,d=h+1,o=d+1,i=l+1,p=(1<<i)-1,x=0,f=0,u=0,v=e[n++],w=new Int32Array(4096),y=null;;){for(;x<16&&v!==0;)f|=e[n++]<<x,x+=8,v===1?v=e[n++]:--v;if(x<i)break;var I=f&p;if(f>>=i,x-=i,I===h){o=d+1,i=l+1,p=(1<<i)-1,y=null;continue}else if(I===d)break;for(var b=I<o?I:y,S=0,_=b;_>h;)_=w[_]>>8,++S;var C=_,k=u+S+(b!==I?1:0);if(k>m){console.log("Warning, gif stream longer than expected.");return}c[u++]=C,u+=S;var F=u;for(b!==I&&(c[u++]=C),_=b;S--;)_=w[_],c[--F]=_&255,_>>=8;y!==null&&o<4096&&(w[o++]=y<<8|C,o>=p+1&&i<12&&(++i,p=p<<1|1)),y=I}return u!==m&&console.log("Warning, gif stream shorter than expected."),c}try{Ge.GifWriter=t,Ge.GifReader=r}catch{}return Ge}var wn=xn(),W={},Ke={},q={},It;function Ht(){if(It)return q;It=1,Object.defineProperty(q,"__esModule",{value:!0}),q.loop=q.conditional=q.parse=void 0;var t=function s(e,n){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:c;if(Array.isArray(n))n.forEach(function(h){return s(e,h,c,m)});else if(typeof n=="function")n(e,c,m,s);else{var l=Object.keys(n)[0];Array.isArray(n[l])?(m[l]={},s(e,n[l],c,m[l])):m[l]=n[l](e,c,m,s)}return c};q.parse=t;var a=function(e,n){return function(c,m,l,h){n(c,m,l)&&h(c,e,m,l)}};q.conditional=a;var r=function(e,n){return function(c,m,l,h){for(var d=[],o=c.pos;n(c,m,l);){var i={};if(h(c,e,m,i),c.pos===o)break;o=c.pos,d.push(i)}return d}};return q.loop=r,q}var M={},bt;function Kt(){if(bt)return M;bt=1,Object.defineProperty(M,"__esModule",{value:!0}),M.readBits=M.readArray=M.readUnsigned=M.readString=M.peekBytes=M.readBytes=M.peekByte=M.readByte=M.buildStream=void 0;var t=function(o){return{data:o,pos:0}};M.buildStream=t;var a=function(){return function(o){return o.data[o.pos++]}};M.readByte=a;var r=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(i){return i.data[i.pos+o]}};M.peekByte=r;var s=function(o){return function(i){return i.data.subarray(i.pos,i.pos+=o)}};M.readBytes=s;var e=function(o){return function(i){return i.data.subarray(i.pos,i.pos+o)}};M.peekBytes=e;var n=function(o){return function(i){return Array.from(s(o)(i)).map(function(p){return String.fromCharCode(p)}).join("")}};M.readString=n;var c=function(o){return function(i){var p=s(2)(i);return o?(p[1]<<8)+p[0]:(p[0]<<8)+p[1]}};M.readUnsigned=c;var m=function(o,i){return function(p,x,f){for(var u=typeof i=="function"?i(p,x,f):i,v=s(o),w=new Array(u),y=0;y<u;y++)w[y]=v(p);return w}};M.readArray=m;var l=function(o,i,p){for(var x=0,f=0;f<p;f++)x+=o[i+f]&&Math.pow(2,p-f-1);return x},h=function(o){return function(i){for(var p=a()(i),x=new Array(8),f=0;f<8;f++)x[7-f]=!!(p&1<<f);return Object.keys(o).reduce(function(u,v){var w=o[v];return w.length?u[v]=l(x,w.index,w.length):u[v]=x[w.index],u},{})}};return M.readBits=h,M}var _t;function yn(){return _t||(_t=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=Ht(),r=Kt(),s={blocks:function(i){for(var p=0,x=[],f=i.data.length,u=0,v=(0,r.readByte)()(i);v!==p&&v;v=(0,r.readByte)()(i)){if(i.pos+v>=f){var w=f-i.pos;x.push((0,r.readBytes)(w)(i)),u+=w;break}x.push((0,r.readBytes)(v)(i)),u+=v}for(var y=new Uint8Array(u),I=0,b=0;b<x.length;b++)y.set(x[b],I),I+=x[b].length;return y}},e=(0,a.conditional)({gce:[{codes:(0,r.readBytes)(2)},{byteSize:(0,r.readByte)()},{extras:(0,r.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,r.readUnsigned)(!0)},{transparentColorIndex:(0,r.readByte)()},{terminator:(0,r.readByte)()}]},function(o){var i=(0,r.peekBytes)(2)(o);return i[0]===33&&i[1]===249}),n=(0,a.conditional)({image:[{code:(0,r.readByte)()},{descriptor:[{left:(0,r.readUnsigned)(!0)},{top:(0,r.readUnsigned)(!0)},{width:(0,r.readUnsigned)(!0)},{height:(0,r.readUnsigned)(!0)},{lct:(0,r.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,a.conditional)({lct:(0,r.readArray)(3,function(o,i,p){return Math.pow(2,p.descriptor.lct.size+1)})},function(o,i,p){return p.descriptor.lct.exists}),{data:[{minCodeSize:(0,r.readByte)()},s]}]},function(o){return(0,r.peekByte)()(o)===44}),c=(0,a.conditional)({text:[{codes:(0,r.readBytes)(2)},{blockSize:(0,r.readByte)()},{preData:function(i,p,x){return(0,r.readBytes)(x.text.blockSize)(i)}},s]},function(o){var i=(0,r.peekBytes)(2)(o);return i[0]===33&&i[1]===1}),m=(0,a.conditional)({application:[{codes:(0,r.readBytes)(2)},{blockSize:(0,r.readByte)()},{id:function(i,p,x){return(0,r.readString)(x.blockSize)(i)}},s]},function(o){var i=(0,r.peekBytes)(2)(o);return i[0]===33&&i[1]===255}),l=(0,a.conditional)({comment:[{codes:(0,r.readBytes)(2)},s]},function(o){var i=(0,r.peekBytes)(2)(o);return i[0]===33&&i[1]===254}),h=[{header:[{signature:(0,r.readString)(3)},{version:(0,r.readString)(3)}]},{lsd:[{width:(0,r.readUnsigned)(!0)},{height:(0,r.readUnsigned)(!0)},{gct:(0,r.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,r.readByte)()},{pixelAspectRatio:(0,r.readByte)()}]},(0,a.conditional)({gct:(0,r.readArray)(3,function(o,i){return Math.pow(2,i.lsd.gct.size+1)})},function(o,i){return i.lsd.gct.exists}),{frames:(0,a.loop)([e,m,l,n,c],function(o){var i=(0,r.peekByte)()(o);return i===33||i===44})}],d=h;t.default=d})(Ke)),Ke}var Se={},kt;function In(){if(kt)return Se;kt=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.deinterlace=void 0;var t=function(r,s){for(var e=new Array(r.length),n=r.length/s,c=function(p,x){var f=r.slice(x*s,(x+1)*s);e.splice.apply(e,[p*s,s].concat(f))},m=[0,4,2,1],l=[8,8,4,2],h=0,d=0;d<4;d++)for(var o=m[d];o<n;o+=l[d])c(o,h),h++;return e};return Se.deinterlace=t,Se}var Be={},Et;function bn(){if(Et)return Be;Et=1,Object.defineProperty(Be,"__esModule",{value:!0}),Be.lzw=void 0;var t=function(r,s,e){var n=4096,c=-1,m=e,l,h,d,o,i,p,x,_,f,u,S,v,C,k,L,F,w=new Array(e),y=new Array(n),I=new Array(n),b=new Array(n+1);for(v=r,h=1<<v,i=h+1,l=h+2,x=c,o=v+1,d=(1<<o)-1,f=0;f<h;f++)y[f]=0,I[f]=f;var S,_,C,k,F,L;for(S=_=C=k=F=L=0,u=0;u<m;){if(k===0){if(_<o){S+=s[L]<<_,_+=8,L++;continue}if(f=S&d,S>>=o,_-=o,f>l||f==i)break;if(f==h){o=v+1,d=(1<<o)-1,l=h+2,x=c;continue}if(x==c){b[k++]=I[f],x=f,C=f;continue}for(p=f,f==l&&(b[k++]=C,f=x);f>h;)b[k++]=I[f],f=y[f];C=I[f]&255,b[k++]=C,l<n&&(y[l]=x,I[l]=C,l++,(l&d)===0&&l<n&&(o++,d+=l)),x=p}k--,w[F++]=b[k],u++}for(u=F;u<m;u++)w[u]=0;return w};return Be.lzw=t,Be}var St;function _n(){if(St)return W;St=1,Object.defineProperty(W,"__esModule",{value:!0}),W.decompressFrames=W.decompressFrame=W.parseGIF=void 0;var t=n(yn()),a=Ht(),r=Kt(),s=In(),e=bn();function n(d){return d&&d.__esModule?d:{default:d}}var c=function(o){var i=new Uint8Array(o);return(0,a.parse)((0,r.buildStream)(i),t.default)};W.parseGIF=c;var m=function(o){for(var i=o.pixels.length,p=new Uint8ClampedArray(i*4),x=0;x<i;x++){var f=x*4,u=o.pixels[x],v=o.colorTable[u]||[0,0,0];p[f]=v[0],p[f+1]=v[1],p[f+2]=v[2],p[f+3]=u!==o.transparentIndex?255:0}return p},l=function(o,i,p){if(!o.image){console.warn("gif frame does not have associated image.");return}var x=o.image,f=x.descriptor.width*x.descriptor.height,u=(0,e.lzw)(x.data.minCodeSize,x.data.blocks,f);x.descriptor.lct.interlaced&&(u=(0,s.deinterlace)(u,x.descriptor.width));var v={pixels:u,dims:{top:o.image.descriptor.top,left:o.image.descriptor.left,width:o.image.descriptor.width,height:o.image.descriptor.height}};return x.descriptor.lct&&x.descriptor.lct.exists?v.colorTable=x.lct:v.colorTable=i,o.gce&&(v.delay=(o.gce.delay||10)*10,v.disposalType=o.gce.extras.disposal,o.gce.extras.transparentColorGiven&&(v.transparentIndex=o.gce.transparentColorIndex)),p&&(v.patch=m(v)),v};W.decompressFrame=l;var h=function(o,i){return o.frames.filter(function(p){return p.image}).map(function(p){return l(p,o.gct,i)})};return W.decompressFrames=h,W}var Bt=_n();const kn=10*1024*1024,En=["image/png","image/jpeg","image/jpg","image/gif","image/webp"],Vt=(t,{onInvalid:a}={})=>En.includes(t.type)?t.size>kn?(a?.("ファイルサイズが大きすぎます。10MB以下のファイルを選択してください。"),!1):!0:(a?.("対応していないファイル形式です。PNG、JPEG、GIF、WebPファイルを選択してください。"),!1),nt=t=>t.type==="image/gif",at=t=>new Promise((a,r)=>{const s=new FileReader;s.onload=e=>{const n=new Image;n.onload=()=>a(n),n.onerror=()=>r(new Error("画像の読み込みに失敗しました")),n.src=e.target.result},s.onerror=()=>r(new Error("ファイルの読み込みに失敗しました")),s.readAsDataURL(t)}),Xe=(t,a)=>{const r=document.createElement("canvas"),s=r.getContext("2d",{willReadFrequently:!0});return r.width=a.width,r.height=a.height,s.drawImage(a,0,0),{id:Date.now().toString()+Math.random().toString(36).substring(2,11),file:t,image:a,canvas:r,metadata:{width:a.width,height:a.height,type:t.type}}},Sn=async(t,{fullFrame:a=!0}={})=>{const r=await t.arrayBuffer();return a?Cn(r):Mn(r)},Bn=async(t,a,r,s=null)=>{const e=document.createElement("canvas");e.width=a,e.height=r;const n=e.getContext("2d");s!==null?(n.fillStyle=s,n.fillRect(0,0,a,r)):n.clearRect(0,0,a,r);const c=[];let m=null;for(let l=0;l<t.length;l++){const h=t[l];h.disposalType===3&&(m=n.getImageData(0,0,a,r));const d=h.dims.width,o=h.dims.height;if(d>0&&o>0){const p=new ImageData(new Uint8ClampedArray(h.patch),d,o);if(window.createImageBitmap){const x=await createImageBitmap(p);n.drawImage(x,h.dims.left,h.dims.top),x.close?.()}else{const x=document.createElement("canvas");x.width=d,x.height=o,x.getContext("2d").putImageData(p,0,0),n.drawImage(x,h.dims.left,h.dims.top)}}const i=await new Promise((p,x)=>{const f=new Image;f.onload=()=>p(f),f.onerror=x,f.src=e.toDataURL("image/png")});switch(c.push({image:i,delay:h.delay??100,disposal:h.disposalType??h.disposal}),h.disposalType){case 2:s!==null?(n.fillStyle=s,n.fillRect(h.dims.left,h.dims.top,h.dims.width,h.dims.height)):n.clearRect(h.dims.left,h.dims.top,h.dims.width,h.dims.height);break;case 3:m?n.putImageData(m,0,0):n.clearRect(h.dims.left,h.dims.top,h.dims.width,h.dims.height);break}}return c},Cn=async t=>{const a=Bt.parseGIF(t),r=Bt.decompressFrames(a,!0);return(await Bn(r,a.lsd.width,a.lsd.height,null)).map(e=>({image:e.image,delay:e.delay,disposal:e.disposal}))},Mn=async t=>{try{const a=new Uint8Array(t),r=new wn.GifReader(a),s=[],e=document.createElement("canvas"),n=e.getContext("2d");e.width=r.width,e.height=r.height;for(let c=0;c<r.numFrames();c++){const m=r.frameInfo(c),l=n.createImageData(e.width,e.height);r.decodeAndBlitFrameRGBA(c,l.data),n.putImageData(l,0,0);const h=new Image;await new Promise((d,o)=>{h.onload=d,h.onerror=o,h.src=e.toDataURL("image/png")}),s.push({image:h,delay:m.delay*10,disposal:m.disposal})}return s}catch(a){return console.error("GIF解析エラー:",a),Ln(t)}},Ln=async t=>{const a=new Blob([t],{type:"image/gif"}),r=URL.createObjectURL(a);try{const s=new Image;await new Promise((m,l)=>{s.onload=m,s.onerror=l,s.src=r});const e=document.createElement("canvas"),n=e.getContext("2d");e.width=s.width,e.height=s.height,n.drawImage(s,0,0);const c=new Image;return await new Promise((m,l)=>{c.onload=m,c.onerror=l,c.src=e.toDataURL("image/png")}),[{image:c,delay:500,disposal:0}]}catch(s){throw console.error("フォールバックGIF処理エラー:",s),s}finally{URL.revokeObjectURL(r)}};let ut,gt,Zt,Jt,rt,ot,it,Qt,D,Ce;const fe=500,Fn=()=>g.transparentImages.length===0?null:g.transparentImages.some(a=>a.frameInfo?.isFromGif)?"gif":g.transparentImages.length>1?"sequence":null,Rn=t=>t.some(a=>nt(a))?"gif":t.length>1?"sequence":null,en=(t,{icon:a,text:r,subtext:s})=>{const e=t.querySelector(".upload-area__icon");e&&a&&(e.textContent=a);const n=t.querySelector(".upload-area__text");n&&(n.textContent=r);const c=t.querySelector(".upload-area__subtext");c&&(c.textContent=s)},Dn=()=>{const t=H();ut=t.backgroundDropzone,gt=t.transparentDropzone,Zt=t.backgroundButton,Jt=t.transparentButton,rt=t.backgroundInput,ot=t.transparentInput,it=t.scaleInput,Qt=t.aspectRatioSelect,D=t.animationSpeedInput,Ce=t.animationSpeedValue},Pn=()=>{const t=(a,r)=>{a.addEventListener("dragover",s=>{s.preventDefault(),a.classList.add("upload-area__dropzone--dragover")}),a.addEventListener("dragleave",()=>{a.classList.remove("upload-area__dropzone--dragover")}),a.addEventListener("drop",s=>{s.preventDefault(),a.classList.remove("upload-area__dropzone--dragover");const e=s.dataTransfer?.files;e&&e.length>0&&r(e)})};t(ut,a=>tn(a[0])),t(gt,nn)},Gn=()=>{Zt.addEventListener("click",()=>{rt.click()}),Jt.addEventListener("click",()=>{ot.click()}),rt.addEventListener("change",t=>{const a=t.target.files;a&&a.length>0&&tn(a[0]),t.target.value=""}),ot.addEventListener("change",t=>{const a=t.target.files;a&&a.length>0&&nn(a),t.target.value=""})},tn=async t=>{if(Vt(t,{onInvalid:P}))try{console.log("背景画像読み込み開始:",t.name);const a=await at(t),r=Xe(t,a);g.backgroundImage=r,g.transformState.cropArea=null,g.transformState.aspectRatio="original",Qt.value="original",he()&&tt(!1),en(ut,{icon:"✅",text:`背景画像: ${t.name}`,subtext:`${a.width} × ${a.height}px`}),Y(),Q(),console.log("背景画像読み込み完了")}catch(a){console.error("背景画像読み込みエラー:",a),P("背景画像の読み込みに失敗しました: "+a.message)}},nn=async t=>{const a=Array.from(t).filter(r=>Vt(r,{onInvalid:P}));if(a.length!==0)try{console.log("透過画像読み込み開始:",a.map(d=>d.name));const r=g.transparentImages.length>0,s=Fn(),e=Rn(a);g.transparentImages=[],r||(g.transformState.position={x:0,y:0}),r&&s==="sequence"&&e==="sequence"?it.value=g.transformState.scale:(g.transformState.scale=1,it.value=1);for(const d of a)if(nt(d)){console.log("GIFファイルを処理中:",d.name);try{const o=await Sn(d,{fullFrame:!0}),i=o.map(u=>u.delay),p=i.reduce((u,v)=>u+v,0)/i.length,x=Math.min(...i),f=Math.max(...i);if(p>0){const u=Math.round(p),v=parseInt(D.min,10),w=parseInt(D.max,10),y=Math.min(v,Math.max(10,Math.round(x))),I=Math.max(w,Math.round(f));D.min=y,D.max=I,D.step=u<100?10:50,g.animationSettings.frameDelay=u,D.value=u,Ce.textContent=`${u}ms`,console.log(`GIFの元フレーム間隔を適用: ${u}ms (範囲: ${y}-${I}ms)`),console.log("フレーム間隔の詳細:",i)}else D.min=50,D.max=2e3,D.step=50,g.animationSettings.frameDelay=fe,D.value=fe,Ce.textContent=`${fe}ms`,console.log("GIFのディレイ情報が欠落していたため、デフォルト500msを適用");for(let u=0;u<o.length;u++){const v=o[u],w=new File([d],`${d.name}_frame_${u+1}`,{type:"image/png"}),y=Xe(w,v.image);y.frameInfo={delay:v.delay,disposal:v.disposal,isFromGif:!0,originalIndex:u},g.transparentImages.push(y)}console.log(`GIFから ${o.length} フレームを抽出しました`)}catch(o){console.error("GIF処理エラー:",o),P(`GIFファイル ${d.name} の処理に失敗しました: ${o.message}`);const i=await at(d),p=Xe(d,i);g.transparentImages.push(p)}}else{const o=await at(d),i=Xe(d,o);g.transparentImages.push(i)}const c=g.transparentImages.some(d=>d.frameInfo?.isFromGif);if(e==="sequence"&&!c)if(D.min=50,D.max=2e3,D.step=50,s==="sequence"&&e==="sequence"){const o=g.animationSettings.frameDelay;D.value=o,Ce.textContent=`${o}ms`,console.log("連番PNGどうしの差し替え: 再生速度を維持")}else g.animationSettings.frameDelay=fe,D.value=fe,Ce.textContent=`${fe}ms`,console.log("連番PNGアニメーションをデフォルト500msに設定");const m=g.transparentImages.length,l=a.some(d=>nt(d));let h="";l?h=`GIF含む ${a.length}ファイル → ${m}フレーム`:h=a.map(d=>d.name).join(", "),en(gt,{icon:"✨",text:`透過画像: ${h}`,subtext:`総フレーム数: ${m}`}),Y(),Q(),Xt(),!he()&&g.transparentImages.length>0&&(ze(!0),ee()),console.log("透過画像読み込み完了")}catch(r){console.error("透過画像読み込みエラー:",r),P("透過画像の読み込みに失敗しました: "+r.message)}},An=()=>{Dn(),Pn(),Gn()};let ue,st,de,Me=!1,Le=!1,Ie=0,be=0,$e=null,Ye=0,Fe=!1,Re=!1,Oe=null;const J=50,Ct=(t,a,r)=>{let s=t;return s=Math.max(a,s),typeof r=="number"&&(s=Math.min(r,s)),s},Tn=(t="")=>t.includes("--nw")?"nw":t.includes("--ne")?"ne":t.includes("--sw")?"sw":t.includes("--se")?"se":t.includes("--n")?"north":t.includes("--s")?"south":t.includes("--w")?"west":t.includes("--e")?"east":null,Xn=(t,a,r,s,e)=>{let n=Math.max(J,t),c=Math.max(J,a);return typeof s=="number"&&n>s&&(n=s,c=n/r),typeof e=="number"&&c>e&&(c=e,n=c*r,typeof s=="number"&&n>s&&(n=s,c=n/r)),n=Math.max(J,n),c=Math.max(J,c),{width:n,height:c}},Yn=(t,a,r,s)=>{const e=a.x+a.width,n=a.y+a.height,c=a.x+a.width/2,m=a.y+a.height/2;switch(t){case"nw":return{maxWidth:e,maxHeight:n};case"ne":return{maxWidth:r-a.x,maxHeight:n};case"sw":return{maxWidth:e,maxHeight:s-a.y};case"se":return{maxWidth:r-a.x,maxHeight:s-a.y};case"north":return{maxWidth:2*Math.min(c,r-c),maxHeight:n};case"south":return{maxWidth:2*Math.min(c,r-c),maxHeight:s-a.y};case"west":return{maxWidth:e,maxHeight:2*Math.min(m,s-m)};case"east":return{maxWidth:r-a.x,maxHeight:2*Math.min(m,s-m)};default:return{maxWidth:void 0,maxHeight:void 0}}},zn=(t,a,r,s)=>{const e=s.x+s.width,n=s.y+s.height,c=s.x+s.width/2,m=s.y+s.height/2;switch(t){case"nw":return{x:e-a,y:n-r};case"ne":return{x:s.x,y:n-r};case"sw":return{x:e-a,y:s.y};case"se":return{x:s.x,y:s.y};case"north":return{x:c-a/2,y:n-r};case"south":return{x:c-a/2,y:s.y};case"west":return{x:e-a,y:m-r/2};case"east":return{x:s.x,y:m-r/2};default:return{x:s.x,y:s.y}}},$n=(t,a,r,s,e,n,c)=>{const m=g.transformState.aspectRatio;if(!m||m==="free")return;const l=Yt(m);if(!l)return;const h=Tn(t);if(!h)return;const d=["nw","ne","sw","se"].includes(h);let o=r.width,i=r.height;if(d)Math.abs(s)>=Math.abs(e)?(o=Math.max(J,r.width),i=o/l):(i=Math.max(J,r.height),o=i*l);else if(h==="north"||h==="south")i=Math.max(J,r.height),o=i*l;else if(h==="east"||h==="west")o=Math.max(J,r.width),i=o/l;else return;const{maxWidth:p,maxHeight:x}=Yn(h,a,n,c),f=Xn(o,i,l,p,x),u=zn(h,f.width,f.height,a);r.x=Ct(u.x,0,n-f.width),r.y=Ct(u.y,0,c-f.height),r.width=f.width,r.height=f.height},an=()=>{const t=H();ue=t.previewCanvas,st=t.boundingBox,de=t.cropBox},Mt=t=>{t.target.classList.contains("bounding-box__handle")?(Le=!0,$e=t.target):Me=!0,Ie=t.clientX,be=t.clientY,t.preventDefault(),t.stopPropagation()},Lt=t=>{if(!Me&&!Le)return;const a=t.clientX-Ie,r=t.clientY-be;if(Me){const s=g.backgroundImage,e=g.transformState.cropArea,n=ue.getBoundingClientRect();let c;if(e){const h=n.width/e.width,d=n.height/e.height;c=Math.min(h,d)}else{const h=n.width/s.metadata.width,d=n.height/s.metadata.height;c=Math.min(h,d)}const m=a/c,l=r/c;g.transformState.position.x+=m,g.transformState.position.y+=l,Y(),Q()}else if(Le&&$e){const s=g.backgroundImage,e=ue.getBoundingClientRect();e.width/s.metadata.width,e.height/s.metadata.height;const n=$e.className;let c=0;n.includes("--nw")||n.includes("--sw")?c=-a:(n.includes("--ne")||n.includes("--se"))&&(c=a),Ye+=c*.1;const l=g.transformState.scale,h=Math.max(1,Math.round(l+Ye));if(h!==g.transformState.scale){g.transformState.scale=h;const{scaleInput:d}=H();d.value=h,Y(),Ye=0}}Ie=t.clientX,be=t.clientY},Ft=()=>{Me=!1,Le=!1,$e=null,Ye=0},On=()=>{an(),st.addEventListener("mousedown",Mt),document.addEventListener("mousemove",Lt),document.addEventListener("mouseup",Ft),st.addEventListener("touchstart",t=>{const a=t.touches[0],r=new MouseEvent("mousedown",{clientX:a.clientX,clientY:a.clientY});Mt(r),t.preventDefault()}),document.addEventListener("touchmove",t=>{if(Me||Le){const a=t.touches[0],r=new MouseEvent("mousemove",{clientX:a.clientX,clientY:a.clientY});Lt(r),t.preventDefault()}}),document.addEventListener("touchend",Ft)},Rt=t=>{t.target.classList.contains("crop-box__handle")?(Re=!0,Oe=t.target,parseInt(de.style.left,10),parseInt(de.style.top,10),parseInt(de.style.width,10),parseInt(de.style.height,10)):Fe=!0,Ie=t.clientX,be=t.clientY,t.preventDefault(),t.stopPropagation()},Dt=t=>{if(!Fe&&!Re)return;const a=t.clientX-Ie,r=t.clientY-be;if(Fe){const s=g.backgroundImage,e=ue.getBoundingClientRect(),n=e.width/s.metadata.width,c=e.height/s.metadata.height,m=Math.min(n,c),l=a/m,h=r/m,d=g.transformState.cropArea;if(!d)return;const o=Math.max(0,Math.min(s.metadata.width-d.width,d.x+l)),i=Math.max(0,Math.min(s.metadata.height-d.height,d.y+h));g.transformState.cropArea.x=o,g.transformState.cropArea.y=i,ye()}else if(Re&&Oe){const s=g.backgroundImage,e=g.transformState.cropArea,n=ue.getBoundingClientRect();if(!e)return;const c=n.width/s.metadata.width,m=n.height/s.metadata.height,l=Math.min(c,m),h=a/l,d=r/l,o=Oe.className,i={...e};o.includes("--nw")?(e.x=Math.max(0,e.x+h),e.y=Math.max(0,e.y+d),e.width=Math.max(50,e.width-h),e.height=Math.max(50,e.height-d)):o.includes("--ne")?(e.y=Math.max(0,e.y+d),e.width=Math.max(50,e.width+h),e.height=Math.max(50,e.height-d)):o.includes("--sw")?(e.x=Math.max(0,e.x+h),e.width=Math.max(50,e.width-h),e.height=Math.max(50,e.height+d)):o.includes("--se")?(e.width=Math.max(50,e.width+h),e.height=Math.max(50,e.height+d)):o.includes("--n")?(e.y=Math.max(0,e.y+d),e.height=Math.max(50,e.height-d)):o.includes("--s")?e.height=Math.max(50,e.height+d):o.includes("--w")?(e.x=Math.max(0,e.x+h),e.width=Math.max(50,e.width-h)):o.includes("--e")&&(e.width=Math.max(50,e.width+h)),$n(o,i,e,h,d,s.metadata.width,s.metadata.height),ye()}Ie=t.clientX,be=t.clientY},Pt=()=>{Fe=!1,Re=!1,Oe=null},Un=()=>{de.addEventListener("mousedown",Rt),document.addEventListener("mousemove",Dt),document.addEventListener("mouseup",Pt),de.addEventListener("touchstart",t=>{const a=t.touches[0],r=new MouseEvent("mousedown",{clientX:a.clientX,clientY:a.clientY});Rt(r),t.preventDefault()}),document.addEventListener("touchmove",t=>{if(Fe||Re){const a=t.touches[0],r=new MouseEvent("mousemove",{clientX:a.clientX,clientY:a.clientY});Dt(r),t.preventDefault()}}),document.addEventListener("touchend",Pt)},Wn=()=>{ue.addEventListener("click",t=>{if(he()||g.transparentImages.length===0)return;const a=g.transparentImages[0],r=g.backgroundImage,s=g.transformState.scale,e=g.transformState.position,n=g.transformState.cropArea,c=ue.getBoundingClientRect(),m=t.clientX-c.left,l=t.clientY-c.top,h=we(a,s,e,r,n),d=c.width/(n?n.width:r.metadata.width),o=c.height/(n?n.height:r.metadata.height),i=Math.min(d,o),p=n?(c.width-n.width*i)/2:(c.width-r.metadata.width*i)/2,x=n?(c.height-n.height*i)/2:(c.height-r.metadata.height*i)/2,f=h.x*i+p,u=h.y*i+x,v=h.width*i,w=h.height*i;m>=f&&m<=f+v&&l>=u&&l<=u+w?(ze(!0),ee()):(ze(!1),ee())})},qn=()=>{let t=null;const a=()=>{g.backgroundImage&&(Y(),ee(),he()&&ye(),he()||Ue(2e3))};window.addEventListener("resize",()=>{t&&clearTimeout(t),t=setTimeout(()=>{a()},150)}),window.addEventListener("orientationchange",()=>{setTimeout(a,300)})},Nn=()=>{an(),On(),Un(),Wn(),qn()};function Ae(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ve={exports:{}},Gt;function jn(){return Gt||(Gt=1,(function(t,a){(function(r){t.exports=r()})(function(){return(function r(s,e,n){function c(h,d){if(!e[h]){if(!s[h]){var o=typeof Ae=="function"&&Ae;if(!d&&o)return o(h,!0);if(m)return m(h,!0);var i=new Error("Cannot find module '"+h+"'");throw i.code="MODULE_NOT_FOUND",i}var p=e[h]={exports:{}};s[h][0].call(p.exports,function(x){var f=s[h][1][x];return c(f||x)},p,p.exports,r,s,e,n)}return e[h].exports}for(var m=typeof Ae=="function"&&Ae,l=0;l<n.length;l++)c(n[l]);return c})({1:[function(r,s,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}s.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(d){if(!m(d)||d<0||isNaN(d))throw TypeError("n must be a positive number");return this._maxListeners=d,this},n.prototype.emit=function(d){var o,i,p,x,f,u;if(this._events||(this._events={}),d==="error"&&(!this._events.error||l(this._events.error)&&!this._events.error.length)){if(o=arguments[1],o instanceof Error)throw o;var v=new Error('Uncaught, unspecified "error" event. ('+o+")");throw v.context=o,v}if(i=this._events[d],h(i))return!1;if(c(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:x=Array.prototype.slice.call(arguments,1),i.apply(this,x)}else if(l(i))for(x=Array.prototype.slice.call(arguments,1),u=i.slice(),p=u.length,f=0;f<p;f++)u[f].apply(this,x);return!0},n.prototype.addListener=function(d,o){var i;if(!c(o))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",d,c(o.listener)?o.listener:o),this._events[d]?l(this._events[d])?this._events[d].push(o):this._events[d]=[this._events[d],o]:this._events[d]=o,l(this._events[d])&&!this._events[d].warned&&(h(this._maxListeners)?i=n.defaultMaxListeners:i=this._maxListeners,i&&i>0&&this._events[d].length>i&&(this._events[d].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[d].length),typeof console.trace=="function"&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(d,o){if(!c(o))throw TypeError("listener must be a function");var i=!1;function p(){this.removeListener(d,p),i||(i=!0,o.apply(this,arguments))}return p.listener=o,this.on(d,p),this},n.prototype.removeListener=function(d,o){var i,p,x,f;if(!c(o))throw TypeError("listener must be a function");if(!this._events||!this._events[d])return this;if(i=this._events[d],x=i.length,p=-1,i===o||c(i.listener)&&i.listener===o)delete this._events[d],this._events.removeListener&&this.emit("removeListener",d,o);else if(l(i)){for(f=x;f-- >0;)if(i[f]===o||i[f].listener&&i[f].listener===o){p=f;break}if(p<0)return this;i.length===1?(i.length=0,delete this._events[d]):i.splice(p,1),this._events.removeListener&&this.emit("removeListener",d,o)}return this},n.prototype.removeAllListeners=function(d){var o,i;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[d]&&delete this._events[d],this;if(arguments.length===0){for(o in this._events)o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[d],c(i))this.removeListener(d,i);else if(i)for(;i.length;)this.removeListener(d,i[i.length-1]);return delete this._events[d],this},n.prototype.listeners=function(d){var o;return!this._events||!this._events[d]?o=[]:c(this._events[d])?o=[this._events[d]]:o=this._events[d].slice(),o},n.prototype.listenerCount=function(d){if(this._events){var o=this._events[d];if(c(o))return 1;if(o)return o.length}return 0},n.listenerCount=function(d,o){return d.listenerCount(o)};function c(d){return typeof d=="function"}function m(d){return typeof d=="number"}function l(d){return typeof d=="object"&&d!==null}function h(d){return d===void 0}},{}],2:[function(r,s,e){var n,c,m,l,h;h=navigator.userAgent.toLowerCase(),l=navigator.platform.toLowerCase(),n=h.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],m=n[1]==="ie"&&document.documentMode,c={name:n[1]==="version"?n[3]:n[1],version:m||parseFloat(n[1]==="opera"&&n[4]?n[4]:n[2]),platform:{name:h.match(/ip(?:ad|od|hone)/)?"ios":(h.match(/(?:webos|android)/)||l.match(/mac|win|linux/)||["other"])[0]}},c[c.name]=!0,c[c.name+parseInt(c.version,10)]=!0,c.platform[c.platform.name]=!0,s.exports=c},{}],3:[function(r,s,e){var n,c,m,l=function(i,p){for(var x in p)h.call(p,x)&&(i[x]=p[x]);function f(){this.constructor=i}return f.prototype=p.prototype,i.prototype=new f,i.__super__=p.prototype,i},h={}.hasOwnProperty,d=[].indexOf||function(i){for(var p=0,x=this.length;p<x;p++)if(p in this&&this[p]===i)return p;return-1},o=[].slice;n=r("events").EventEmitter,m=r("./browser.coffee"),c=(function(i){var p,x;l(f,i),p={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},x={delay:500,copy:!1};function f(u){var v,w,y;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(u);for(w in p)y=p[w],(v=this.options)[w]==null&&(v[w]=y)}return f.prototype.setOption=function(u,v){if(this.options[u]=v,this._canvas!=null&&(u==="width"||u==="height"))return this._canvas[u]=v},f.prototype.setOptions=function(u){var v,w,y;w=[];for(v in u)h.call(u,v)&&(y=u[v],w.push(this.setOption(v,y)));return w},f.prototype.addFrame=function(u,v){var w,y;v==null&&(v={}),w={},w.transparent=this.options.transparent;for(y in x)w[y]=v[y]||x[y];if(this.options.width==null&&this.setOption("width",u.width),this.options.height==null&&this.setOption("height",u.height),typeof ImageData<"u"&&ImageData!==null&&u instanceof ImageData)w.data=u.data;else if(typeof CanvasRenderingContext2D<"u"&&CanvasRenderingContext2D!==null&&u instanceof CanvasRenderingContext2D||typeof WebGLRenderingContext<"u"&&WebGLRenderingContext!==null&&u instanceof WebGLRenderingContext)v.copy?w.data=this.getContextData(u):w.context=u;else if(u.childNodes!=null)v.copy?w.data=this.getImageData(u):w.image=u;else throw new Error("Invalid image");return this.frames.push(w)},f.prototype.render=function(){var u,v,w;if(this.running)throw new Error("Already running");if(this.options.width==null||this.options.height==null)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=(function(){var y,I,b;for(b=[],y=0,I=this.frames.length;0<=I?y<I:y>I;0<=I?++y:--y)b.push(null);return b}).call(this),v=this.spawnWorkers(),this.options.globalPalette===!0)this.renderNextFrame();else for(u=0,w=v;0<=w?u<w:u>w;0<=w?++u:--u)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},f.prototype.abort=function(){for(var u;u=this.activeWorkers.shift(),u!=null;)this.log("killing active worker"),u.terminate();return this.running=!1,this.emit("abort")},f.prototype.spawnWorkers=function(){var u,v,w;return u=Math.min(this.options.workers,this.frames.length),(function(){w=[];for(var y=v=this.freeWorkers.length;v<=u?y<u:y>u;v<=u?y++:y--)w.push(y);return w}).apply(this).forEach((function(y){return function(I){var b;return y.log("spawning worker "+I),b=new Worker(y.options.workerScript),b.onmessage=function(S){return y.activeWorkers.splice(y.activeWorkers.indexOf(b),1),y.freeWorkers.push(b),y.frameFinished(S.data)},y.freeWorkers.push(b)}})(this)),u},f.prototype.frameFinished=function(u){var v,w;if(this.log("frame "+u.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[u.index]=u,this.options.globalPalette===!0&&(this.options.globalPalette=u.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(v=1,w=this.freeWorkers.length;1<=w?v<w:v>w;1<=w?++v:--v)this.renderNextFrame();return d.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},f.prototype.finishRendering=function(){var u,v,w,y,I,b,S,_,C,k,F,L,K,T,z,X;for(_=0,T=this.imageParts,I=0,C=T.length;I<C;I++)v=T[I],_+=(v.data.length-1)*v.pageSize+v.cursor;for(_+=v.pageSize-v.cursor,this.log("rendering finished - filesize "+Math.round(_/1e3)+"kb"),u=new Uint8Array(_),L=0,z=this.imageParts,b=0,k=z.length;b<k;b++)for(v=z[b],X=v.data,w=S=0,F=X.length;S<F;w=++S)K=X[w],u.set(K,L),w===v.data.length-1?L+=v.cursor:L+=v.pageSize;return y=new Blob([u],{type:"image/gif"}),this.emit("finished",y,u)},f.prototype.renderNextFrame=function(){var u,v,w;if(this.freeWorkers.length===0)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return u=this.frames[this.nextFrame++],w=this.freeWorkers.shift(),v=this.getTask(u),this.log("starting frame "+(v.index+1)+" of "+this.frames.length),this.activeWorkers.push(w),w.postMessage(v)},f.prototype.getContextData=function(u){return u.getImageData(0,0,this.options.width,this.options.height).data},f.prototype.getImageData=function(u){var v;return this._canvas==null&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),v=this._canvas.getContext("2d"),v.setFill=this.options.background,v.fillRect(0,0,this.options.width,this.options.height),v.drawImage(u,0,0),this.getContextData(v)},f.prototype.getTask=function(u){var v,w;if(v=this.frames.indexOf(u),w={index:v,last:v===this.frames.length-1,delay:u.delay,transparent:u.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:m.name==="chrome"},u.data!=null)w.data=u.data;else if(u.context!=null)w.data=this.getContextData(u.context);else if(u.image!=null)w.data=this.getImageData(u.image);else throw new Error("Invalid frame");return w},f.prototype.log=function(){var u;if(u=1<=arguments.length?o.call(arguments,0):[],!!this.options.debug)return console.log.apply(console,u)},f})(n),s.exports=c},{"./browser.coffee":2,events:1}]},{},[3])(3)})})(Ve)),Ve.exports}var Hn=jn();const Kn=vn(Hn),Vn=()=>{if(!g.backgroundImage||g.transparentImages.length===0){P("背景画像と透過画像の両方が必要です");return}try{const t=document.createElement("canvas"),a=t.getContext("2d",{willReadFrequently:!0}),r=g.backgroundImage,s=g.transparentImages[0],e=g.transformState.scale,n=g.transformState.position,c=g.transformState.cropArea;c?(t.width=c.width,t.height=c.height):(t.width=r.metadata.width,t.height=r.metadata.height),c?a.drawImage(r.image,c.x,c.y,c.width,c.height,0,0,t.width,t.height):a.drawImage(r.image,0,0);const m=we(s,e,n,r,c);a.imageSmoothingEnabled=!1,a.drawImage(s.image,m.x,m.y,m.width,m.height),t.toBlob(l=>{if(l){const h=URL.createObjectURL(l),d=document.createElement("a");d.href=h,d.download=`x-post-image-${Date.now()}.png`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(h),console.log("PNG エクスポート完了"),Te("PNG画像をダウンロードしました")}else throw new Error("PNG生成に失敗しました")},"image/png")}catch(t){console.error("PNG エクスポートエラー:",t),P("PNG エクスポートに失敗しました: "+t.message)}},Zn=()=>{if(!g.backgroundImage||g.transparentImages.length===0){P("背景画像と透過画像の両方が必要です");return}if(g.transparentImages.length===1){P("GIF生成には複数の透過画像が必要です。単一画像の場合はPNGをご利用ください。");return}try{console.log("GIF生成開始...");const t=g.backgroundImage,a=g.transformState.scale,r=g.transformState.position,s=g.transformState.cropArea;let e,n;s?(e=s.width,n=s.height):(e=t.metadata.width,n=t.metadata.height);const c=new URL("/250811_png-gif-app/assets/gif.worker-CjkyQP34.js",import.meta.url).href,m=new Kn({workers:2,quality:15,width:e,height:n,repeat:0,workerScript:c}),l=document.createElement("canvas"),h=l.getContext("2d",{willReadFrequently:!0});l.width=e,l.height=n,g.transparentImages.forEach((o,i)=>{try{h.clearRect(0,0,e,n),s?h.drawImage(t.image,s.x,s.y,s.width,s.height,0,0,e,n):h.drawImage(t.image,0,0);const p=we(o,a,r,t,s);h.imageSmoothingEnabled=!1,h.drawImage(o.image,p.x,p.y,p.width,p.height),m.addFrame(l,{copy:!0,delay:g.animationSettings.frameDelay}),console.log(`フレーム ${i+1}/${g.transparentImages.length} 追加完了`)}catch(p){throw console.error(`フレーム ${i+1} の処理でエラー:`,p),p}}),m.on("finished",o=>{try{const i=URL.createObjectURL(o),p=document.createElement("a");p.href=i,p.download=`x-post-animation-${Date.now()}.gif`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(i),console.log("GIF エクスポート完了"),Te("GIFアニメーションをダウンロードしました")}catch(i){console.error("GIF ダウンロードエラー:",i),P("GIF ダウンロードに失敗しました")}}),m.on("error",o=>{console.error("GIF生成エラー:",o),P("GIF生成中にエラーが発生しました: "+o.message)}),m.on("progress",o=>{const i=Math.round(o*100);console.log(`GIF生成進捗: ${i}%`),i%25===0&&Te(`GIF生成中... ${i}%`)});const d=setTimeout(()=>{console.error("GIF生成がタイムアウトしました"),P("GIF生成に時間がかかりすぎています。画像サイズを小さくするか、フレーム数を減らしてください。")},3e4);m.on("finished",()=>{clearTimeout(d)}),m.render(),console.log("GIF生成処理を開始しました..."),Te("GIF生成中です。しばらくお待ちください...")}catch(t){console.error("GIF エクスポートエラー:",t),P("GIF エクスポートに失敗しました: "+t.message)}},Jn=()=>{const{exportPngButton:t,exportGifButton:a}=H();t.addEventListener("click",Vn),a.addEventListener("click",Zn)},Qn=t=>{if(!t)return;t.textContent="",["nw","ne","sw","se"].forEach(s=>{const e=document.createElement("div");e.className=`bounding-box__handle bounding-box__handle--${s}`,t.appendChild(e)}),["top","right","bottom","left"].forEach(s=>{const e=document.createElement("div");e.className=`bounding-box__border bounding-box__border--${s}`,t.appendChild(e)})},ea=t=>{if(!t)return;t.textContent="",["nw","ne","sw","se","n","e","s","w"].forEach(s=>{const e=document.createElement("div");e.className=`crop-box__handle crop-box__handle--${s}`,t.appendChild(e)}),["top","right","bottom","left"].forEach(s=>{const e=document.createElement("div");e.className=`crop-box__overlay crop-box__overlay--${s}`,t.appendChild(e)})},ta=()=>{console.log("X用ポスト画像生成ツール - 初期化開始"),At(),sn();const t=H();Qn(t.boundingBox),ea(t.cropBox),An(),pn(),Nn(),Jn(),console.log("初期化完了")};document.addEventListener("DOMContentLoaded",ta);

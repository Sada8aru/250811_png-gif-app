(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function a(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(t){if(t.ep)return;t.ep=!0;const r=a(t);fetch(t.href,r)}})();const dn=()=>({backgroundDropzone:document.getElementById("backgroundDropzone"),transparentDropzone:document.getElementById("transparentDropzone"),backgroundButton:document.getElementById("backgroundButton"),transparentButton:document.getElementById("transparentButton"),backgroundInput:document.getElementById("backgroundInput"),transparentInput:document.getElementById("transparentInput"),previewContainer:document.getElementById("previewContainer"),previewCanvas:document.getElementById("previewCanvas"),previewPlaceholder:document.getElementById("previewPlaceholder"),boundingBox:document.getElementById("boundingBox"),cropBox:document.getElementById("cropBox"),modeToggleEdit:document.getElementById("modeToggleEdit"),modeToggleCrop:document.getElementById("modeToggleCrop"),cropControls:document.getElementById("cropControls"),editModeControls:document.querySelectorAll('[data-mode-panel="edit"]'),scaleInput:document.getElementById("scaleInput"),aspectRatioSelect:document.getElementById("aspectRatioSelect"),animationSpeedInput:document.getElementById("animationSpeedInput"),animationSpeedValue:document.getElementById("animationSpeedValue"),exportPngButton:document.getElementById("exportPngButton"),exportGifButton:document.getElementById("exportGifButton"),errorMessage:document.getElementById("errorMessage"),alignmentButtons:document.querySelectorAll("[data-align-target]"),positionInputX:document.getElementById("positionInputX"),positionInputY:document.getElementById("positionInputY")});let Je;const zt=()=>(Je=dn(),Je),X=()=>Je??zt(),un=()=>({scale:1,position:{x:0,y:0},cropArea:null,aspectRatio:"original"}),f={backgroundImage:null,transparentImages:[],transformState:un(),outputSettings:{format:"PNG",maxWidth:1200,maxHeight:675},animationSettings:{frameDelay:500}},A=e=>{const{errorMessage:n}=X();n&&(n.textContent=e,n.style.display="block",n.style.backgroundColor="#f44336",n.style.color="white",setTimeout(()=>{n.style.display="none"},5e3))},ze=e=>{const{errorMessage:n}=X();n&&(n.textContent=e,n.style.display="block",n.style.backgroundColor="#4CAF50",n.style.color="white",setTimeout(()=>{n.style.display="none",n.style.backgroundColor="#f44336",n.style.color="white"},3e3))},hn=1,gn=10,Qe=e=>e?gn:hn,fn=(e,n)=>{switch(e){case"ArrowUp":return Qe(n);case"ArrowDown":return-Qe(n);default:return null}},mn=(e,n)=>{const a=Qe(n);switch(e){case"ArrowLeft":return{axis:"x",delta:-a};case"ArrowRight":return{axis:"x",delta:a};case"ArrowUp":return{axis:"y",delta:-a};case"ArrowDown":return{axis:"y",delta:a};default:return null}},xe=({bgSize:e,cropArea:n,canvasRect:a})=>{const i=n?n.width:e.width,t=n?n.height:e.height,r=a.width/i,c=a.height/t,u=Math.min(r,c),o=(a.width-i*u)/2,h=(a.height-t*u)/2;return{scale:u,offsetX:o,offsetY:h,targetWidth:i,targetHeight:t}},$t=(e,n)=>({x:e.x*n.scale+n.offsetX,y:e.y*n.scale+n.offsetY,width:e.width*n.scale,height:e.height*n.scale});let k,et,V,Z,pe,ve,tt,Ut=[],ut,ht;const pn=()=>{const e=X();k=e.previewCanvas,et=e.previewPlaceholder,V=e.boundingBox,Z=e.cropBox,pe=e.modeToggleEdit,ve=e.modeToggleCrop,tt=e.cropControls,Ut=Array.from(e.editModeControls??[]),ut=e.exportPngButton,ht=e.exportGifButton,nt(),rt(!G)};let Ae=null,Pe=0,G=!1,ge=!1,Se=null;const Xe=e=>{ge=e},vn=()=>ge,nt=()=>{!pe||!ve||(G?(ve.classList.add("mode-toggle__button--active"),ve.setAttribute("aria-pressed","true"),pe.classList.remove("mode-toggle__button--active"),pe.setAttribute("aria-pressed","false")):(pe.classList.add("mode-toggle__button--active"),pe.setAttribute("aria-pressed","true"),ve.classList.remove("mode-toggle__button--active"),ve.setAttribute("aria-pressed","false")))},rt=e=>{Ut.forEach(n=>{n&&(n.style.display=e?"":"none",n.setAttribute("aria-hidden",e?"false":"true"))})},we=(e,n,a,i,t=null,r={})=>{const{useCropAreaOffset:c=!0}=r,u=e.metadata.width*n,o=e.metadata.height*n,h=a.x+(i.metadata.width-u)/2,d=a.y+(i.metadata.height-o)/2;if(t&&c){const s=h-t.x,l=d-t.y;return{x:s,y:l,width:u,height:o,baseX:h,baseY:d,cropOffsetX:t.x,cropOffsetY:t.y}}return{x:h,y:d,width:u,height:o}},Xt=()=>{if(!f.backgroundImage)return;const e=f.backgroundImage,n=k.getContext("2d",{willReadFrequently:!0});if(n.clearRect(0,0,k.width,k.height),n.drawImage(e.image,0,0),f.transparentImages.length>0){const a=f.transparentImages[0],i=f.transformState.scale,t=f.transformState.position,r=a.metadata.width*i,c=a.metadata.height*i,u=t.x+(e.metadata.width-r)/2,o=t.y+(e.metadata.height-c)/2;console.log("トリミングモード描画:",{posX:t.x,posY:t.y,bgWidth:e.metadata.width,bgHeight:e.metadata.height,scaledWidth:r,scaledHeight:c,absoluteX:u,absoluteY:o,cropArea:f.transformState.cropArea}),n.imageSmoothingEnabled=!1,n.drawImage(a.image,u,o,r,c)}},Yt=()=>{const e=!!f.backgroundImage;ut.disabled=!e,ht.disabled=!(e&&f.transparentImages.length>1)},$=()=>{if(!f.backgroundImage){k.style.display="none",et.style.display="flex",ut.disabled=!0,ht.disabled=!0;return}const e=f.backgroundImage,n=k.getContext("2d",{willReadFrequently:!0}),a=f.transformState.cropArea;if(G){k.width=e.metadata.width,k.height=e.metadata.height,Xt();return}if(a?(k.width=a.width,k.height=a.height):(k.width=e.metadata.width,k.height=e.metadata.height),Ae&&(clearInterval(Ae),Ae=null),f.transparentImages.length>1){Pe=0;const i=()=>{n.clearRect(0,0,k.width,k.height),G?n.drawImage(e.image,0,0):a?n.drawImage(e.image,a.x,a.y,a.width,a.height,0,0,k.width,k.height):n.drawImage(e.image,0,0);const t=f.transparentImages[Pe];if(t){const r=f.transformState.scale,c=f.transformState.position,u=we(t,r,c,e,a,{useCropAreaOffset:!G});n.imageSmoothingEnabled=!1,n.drawImage(t.image,u.x,u.y,u.width,u.height)}Pe=(Pe+1)%f.transparentImages.length};i(),Ae=setInterval(i,f.animationSettings.frameDelay)}else if(f.transparentImages.length===1){n.clearRect(0,0,k.width,k.height),a?n.drawImage(e.image,a.x,a.y,a.width,a.height,0,0,k.width,k.height):n.drawImage(e.image,0,0);const i=f.transparentImages[0],t=f.transformState.scale,r=f.transformState.position,c=we(i,t,r,e,a,{useCropAreaOffset:!G});n.imageSmoothingEnabled=!1,n.drawImage(i.image,c.x,c.y,c.width,c.height)}else n.clearRect(0,0,k.width,k.height),a?n.drawImage(e.image,a.x,a.y,a.width,a.height,0,0,k.width,k.height):n.drawImage(e.image,0,0);k.style.display="block",et.style.display="none",Yt(),G?setTimeout(()=>ye(),100):f.transparentImages.length>0&&setTimeout(()=>ee(),100)},We=(e=1e3)=>{Se&&(clearTimeout(Se),Se=null),ge=!0,ee(),Se=setTimeout(()=>{ge=!1,ee(),Se=null},e)},pt={"top-left":{horizontal:"start",vertical:"start"},"top-center":{horizontal:"center",vertical:"start"},"top-right":{horizontal:"end",vertical:"start"},"middle-left":{horizontal:"start",vertical:"center"},"middle-center":{horizontal:"center",vertical:"center"},"middle-right":{horizontal:"end",vertical:"center"},"bottom-left":{horizontal:"start",vertical:"end"},"bottom-center":{horizontal:"center",vertical:"end"},"bottom-right":{horizontal:"end",vertical:"end"}},vt=(e,n,a,i)=>{const t=a,r=a+i-n;return r<t?a+(i-n)/2:Math.min(Math.max(e,t),r)},xt=(e,n,a,i)=>{switch(e){case"start":return n;case"end":return n+a-i;case"center":default:return n+(a-i)/2}},xn=e=>{if(!pt[e]||!f.backgroundImage||f.transparentImages.length===0)return;const n=f.backgroundImage,a=f.transparentImages[0],i=f.transformState.scale,t=f.transformState.cropArea,r=a.metadata.width*i,c=a.metadata.height*i,u=t?{x:t.x,y:t.y,width:t.width,height:t.height}:{x:0,y:0,width:n.metadata.width,height:n.metadata.height},o=pt[e],h=xt(o.horizontal,u.x,u.width,r),d=xt(o.vertical,u.y,u.height,c),s=vt(h,r,u.x,u.width),l=vt(d,c,u.y,u.height);f.transformState.position.x=s-(n.metadata.width-r)/2,f.transformState.position.y=l-(n.metadata.height-c)/2,Xe(!0),$(),We(1200)},ee=()=>{if(!f.backgroundImage||f.transparentImages.length===0||G||!ge){V.style.display="none";return}const e=f.backgroundImage,n=f.transparentImages[0],a=f.transformState.scale,i=f.transformState.position,t=f.transformState.cropArea,r=k.getBoundingClientRect(),c=xe({bgSize:e.metadata,cropArea:t,canvasRect:r}),u=we(n,a,i,e,t),o=$t({x:u.x,y:u.y,width:u.width,height:u.height},c);V.style.display="block",V.style.left=o.x+"px",V.style.top=o.y+"px",V.style.width=o.width+"px",V.style.height=o.height+"px"},Ot=e=>{switch(e){case"1:1":return 1;case"16:9":return 16/9;case"9:16":return 9/16;case"4:3":return 4/3;case"3:4":return 3/4;case"free":return null;case"original":default:return f.backgroundImage?f.backgroundImage.metadata.width/f.backgroundImage.metadata.height:1}},ye=()=>{if(!f.backgroundImage||!G){Z.style.display="none";return}const e=f.backgroundImage,n=k.getBoundingClientRect(),a=xe({bgSize:e.metadata,cropArea:null,canvasRect:n});let i=f.transformState.cropArea;if(!i){if(f.transformState.aspectRatio==="original"||f.transformState.aspectRatio==="free")i={x:0,y:0,width:e.metadata.width,height:e.metadata.height};else{const r=Ot(f.transformState.aspectRatio),c=e.metadata.width/e.metadata.height;let u,o;r>c?(u=e.metadata.width,o=u/r):(o=e.metadata.height,u=o*r),i={x:(e.metadata.width-u)/2,y:(e.metadata.height-o)/2,width:u,height:o}}f.transformState.cropArea=i}const t=$t(i,a);Z.style.display="block",Z.style.left=t.x+"px",Z.style.top=t.y+"px",Z.style.width=t.width+"px",Z.style.height=t.height+"px"},at=e=>{const n=!!e;if(G===n){nt();return}if(G=n,G){tt.style.display="block",rt(!1),V.style.display="none",ge=!1;const a=f.backgroundImage;a&&(k.width=a.metadata.width,k.height=a.metadata.height,Xt()),ye()}else tt.style.display="none",rt(!0),Z.style.display="none",ge=!1,ee(),$();nt()},te=()=>G;let Wt,qt,Nt,jt,Ht,Kt,Vt=[],j,H;const wn=()=>{const e=X();Wt=e.scaleInput,qt=e.modeToggleEdit,Nt=e.modeToggleCrop,jt=e.animationSpeedInput,Ht=e.animationSpeedValue,Kt=e.aspectRatioSelect,Vt=Array.from(e.alignmentButtons??[]),j=e.positionInputX,H=e.positionInputY},yn=()=>!!(f.backgroundImage&&f.transparentImages.length>0),gt=()=>{if(!yn())return null;const e=f.backgroundImage,n=f.transparentImages[0];if(!n?.metadata)return null;const a=f.transformState.scale,i=n.metadata.width*a,t=n.metadata.height*a,r=f.transformState.cropArea,c=r?{x:r.x,y:r.y,width:r.width,height:r.height}:{x:0,y:0,width:e.metadata.width,height:e.metadata.height},u=f.transformState.position.x+(e.metadata.width-i)/2,o=f.transformState.position.y+(e.metadata.height-t)/2;return{bg:e,bounds:c,overlaySize:{width:i,height:t},absoluteX:u,absoluteY:o}},wt=(e,n,a,i)=>{const t=a,r=a+i-n;return r<t?a+(i-n)/2:Math.min(Math.max(e,t),r)},yt=e=>{[j,H].forEach(n=>{n&&(n.disabled=e)})},Q=()=>{if(!j||!H)return;const e=gt();if(!e){yt(!0),j.value="",H.value="";return}yt(!1),j.value=Math.round(e.absoluteX),H.value=Math.round(e.absoluteY),j.setAttribute("aria-valuemin",`${Math.round(e.bounds.x)}`),H.setAttribute("aria-valuemin",`${Math.round(e.bounds.y)}`);const n=e.bounds.x+e.bounds.width-e.overlaySize.width,a=e.bounds.y+e.bounds.height-e.overlaySize.height;j.setAttribute("aria-valuemax",`${Math.round(n)}`),H.setAttribute("aria-valuemax",`${Math.round(a)}`)},Zt=(e,n,a)=>{const i=wt(n,e.overlaySize.width,e.bounds.x,e.bounds.width),t=wt(a,e.overlaySize.height,e.bounds.y,e.bounds.height);f.transformState.position.x=i-(e.bg.metadata.width-e.overlaySize.width)/2,f.transformState.position.y=t-(e.bg.metadata.height-e.overlaySize.height)/2,$(),We(1e3),Q()},Jt=(e,n)=>{const a=gt();if(!a)return;const i=e==="x"?a.absoluteX+n:a.absoluteX,t=e==="y"?a.absoluteY+n:a.absoluteY;Zt(a,i,t)},In=(e,n)=>{const a=Number.parseInt(n,10);if(Number.isNaN(a))return;const i=gt();if(!i)return;const t=e==="x"?a:i.absoluteX,r=e==="y"?a:i.absoluteY;Zt(i,t,r)},It=e=>{const n=e.target.dataset.axis;n&&In(n,e.target.value)},bn=e=>{e.target.dataset.axis&&Number.isNaN(Number.parseInt(e.target.value,10))&&Q()},_n=e=>{const n=e.target.dataset.axis;if(!n)return;const a=fn(e.key,e.shiftKey);a!==null&&(e.preventDefault(),Jt(n,a))},En=()=>{!j||!H||[j,H].forEach(e=>{e.addEventListener("input",It),e.addEventListener("change",It),e.addEventListener("blur",bn),e.addEventListener("keydown",_n)})},kn=()=>{if(!f.backgroundImage||f.transparentImages.length===0)return;const e=f.transparentImages[0],n=f.transformState.scale,a=e.metadata.width*n,i=e.metadata.height*n;(a>f.outputSettings.maxWidth||i>f.outputSettings.maxHeight)&&A(`拡大後のサイズ（${a}×${i}px）が出力サイズ制限（${f.outputSettings.maxWidth}×${f.outputSettings.maxHeight}px）を超えています。`)},Sn=()=>{wn(),Wt.addEventListener("input",e=>{const n=parseInt(e.target.value,10);f.transformState.scale=n,console.log("拡大倍率変更:",n),$(),kn(),Q(),!te()&&f.transparentImages.length>0&&We(1e3)}),qt.addEventListener("click",()=>{at(!1)}),Nt.addEventListener("click",()=>{at(!0)}),jt.addEventListener("input",e=>{const n=parseInt(e.target.value,10);f.animationSettings.frameDelay=n,Ht.textContent=`${n}ms`,console.log("アニメーション速度変更:",n+"ms"),f.transparentImages.length>1&&$()}),Kt.addEventListener("change",e=>{const n=e.target.value;f.transformState.aspectRatio=n,console.log("アスペクト比変更:",n),te()?(f.transformState.cropArea=null,ye()):$()}),Vt.forEach(e=>{e.addEventListener("click",()=>{const n=e.getAttribute("data-align-target");n&&(console.log("整列ボタン押下:",n),xn(n),Q())})}),En(),Q()};function Bn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ge={},bt;function Cn(){if(bt)return Ge;bt=1;function e(t,r,c,h){var o=0,h=h===void 0?{}:h,d=h.loop===void 0?null:h.loop,s=h.palette===void 0?null:h.palette;if(r<=0||c<=0||r>65535||c>65535)throw new Error("Width/Height invalid.");function l(I){var b=I.length;if(b<2||b>256||b&b-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return b}t[o++]=71,t[o++]=73,t[o++]=70,t[o++]=56,t[o++]=57,t[o++]=97;var m=0,x=0;if(s!==null){for(var p=l(s);p>>=1;)++m;if(p=1<<m,--m,h.background!==void 0){if(x=h.background,x>=p)throw new Error("Background index out of range.");if(x===0)throw new Error("Background index explicitly passed as 0.")}}if(t[o++]=r&255,t[o++]=r>>8&255,t[o++]=c&255,t[o++]=c>>8&255,t[o++]=(s!==null?128:0)|m,t[o++]=x,t[o++]=0,s!==null)for(var g=0,v=s.length;g<v;++g){var w=s[g];t[o++]=w>>16&255,t[o++]=w>>8&255,t[o++]=w&255}if(d!==null){if(d<0||d>65535)throw new Error("Loop count invalid.");t[o++]=33,t[o++]=255,t[o++]=11,t[o++]=78,t[o++]=69,t[o++]=84,t[o++]=83,t[o++]=67,t[o++]=65,t[o++]=80,t[o++]=69,t[o++]=50,t[o++]=46,t[o++]=48,t[o++]=3,t[o++]=1,t[o++]=d&255,t[o++]=d>>8&255,t[o++]=0}var y=!1;this.addFrame=function(I,b,S,_,C,E){if(y===!0&&(--o,y=!1),E=E===void 0?{}:E,I<0||b<0||I>65535||b>65535)throw new Error("x/y invalid.");if(S<=0||_<=0||S>65535||_>65535)throw new Error("Width/Height invalid.");if(C.length<S*_)throw new Error("Not enough pixels for the frame size.");var M=!0,L=E.palette;if(L==null&&(M=!1,L=s),L==null)throw new Error("Must supply either a local or global palette.");for(var K=l(L),T=0;K>>=1;)++T;K=1<<T;var U=E.delay===void 0?0:E.delay,z=E.disposal===void 0?0:E.disposal;if(z<0||z>3)throw new Error("Disposal out of range.");var fe=!1,ne=0;if(E.transparent!==void 0&&E.transparent!==null&&(fe=!0,ne=E.transparent,ne<0||ne>=K))throw new Error("Transparent color index.");if((z!==0||fe||U!==0)&&(t[o++]=33,t[o++]=249,t[o++]=4,t[o++]=z<<2|(fe===!0?1:0),t[o++]=U&255,t[o++]=U>>8&255,t[o++]=ne,t[o++]=0),t[o++]=44,t[o++]=I&255,t[o++]=I>>8&255,t[o++]=b&255,t[o++]=b>>8&255,t[o++]=S&255,t[o++]=S>>8&255,t[o++]=_&255,t[o++]=_>>8&255,t[o++]=M===!0?128|T-1:0,M===!0)for(var me=0,Y=L.length;me<Y;++me){var P=L[me];t[o++]=P>>16&255,t[o++]=P>>8&255,t[o++]=P&255}return o=n(t,o,T<2?2:T,C),o},this.end=function(){return y===!1&&(t[o++]=59,y=!0),o},this.getOutputBuffer=function(){return t},this.setOutputBuffer=function(I){t=I},this.getOutputBufferPosition=function(){return o},this.setOutputBufferPosition=function(I){o=I}}function n(t,r,c,u){t[r++]=c;var o=r++,h=1<<c,d=h-1,s=h+1,l=s+1,m=c+1,x=0,p=0;function g(E){for(;x>=E;)t[r++]=p&255,p>>=8,x-=8,r===o+256&&(t[o]=255,o=r++)}function v(E){p|=E<<x,x+=m,g(8)}var w=u[0]&d,y={};v(h);for(var I=1,b=u.length;I<b;++I){var S=u[I]&d,_=w<<8|S,C=y[_];if(C===void 0){for(p|=w<<x,x+=m;x>=8;)t[r++]=p&255,p>>=8,x-=8,r===o+256&&(t[o]=255,o=r++);l===4096?(v(h),l=s+1,m=c+1,y={}):(l>=1<<m&&++m,y[_]=l++),w=S}else w=C}return v(w),v(s),g(1),o+1===r?t[o]=0:(t[o]=r-o-1,t[r++]=0),r}function a(t){var r=0;if(t[r++]!==71||t[r++]!==73||t[r++]!==70||t[r++]!==56||(t[r++]+1&253)!==56||t[r++]!==97)throw new Error("Invalid GIF 87a/89a header.");var c=t[r++]|t[r++]<<8,u=t[r++]|t[r++]<<8,o=t[r++],h=o>>7,d=o&7,s=1<<d+1;t[r++],t[r++];var l=null,m=null;h&&(l=r,m=s,r+=s*3);var x=!0,p=[],g=0,v=null,w=0,y=null;for(this.width=c,this.height=u;x&&r<t.length;)switch(t[r++]){case 33:switch(t[r++]){case 255:if(t[r]!==11||t[r+1]==78&&t[r+2]==69&&t[r+3]==84&&t[r+4]==83&&t[r+5]==67&&t[r+6]==65&&t[r+7]==80&&t[r+8]==69&&t[r+9]==50&&t[r+10]==46&&t[r+11]==48&&t[r+12]==3&&t[r+13]==1&&t[r+16]==0)r+=14,y=t[r++]|t[r++]<<8,r++;else for(r+=12;;){var I=t[r++];if(!(I>=0))throw Error("Invalid block size");if(I===0)break;r+=I}break;case 249:if(t[r++]!==4||t[r+4]!==0)throw new Error("Invalid graphics extension block.");var b=t[r++];g=t[r++]|t[r++]<<8,v=t[r++],(b&1)===0&&(v=null),w=b>>2&7,r++;break;case 254:for(;;){var I=t[r++];if(!(I>=0))throw Error("Invalid block size");if(I===0)break;r+=I}break;default:throw new Error("Unknown graphic control label: 0x"+t[r-1].toString(16))}break;case 44:var S=t[r++]|t[r++]<<8,_=t[r++]|t[r++]<<8,C=t[r++]|t[r++]<<8,E=t[r++]|t[r++]<<8,M=t[r++],L=M>>7,K=M>>6&1,T=M&7,U=1<<T+1,z=l,fe=m,ne=!1;if(L){var ne=!0;z=r,fe=U,r+=U*3}var me=r;for(r++;;){var I=t[r++];if(!(I>=0))throw Error("Invalid block size");if(I===0)break;r+=I}p.push({x:S,y:_,width:C,height:E,has_local_palette:ne,palette_offset:z,palette_size:fe,data_offset:me,data_length:r-me,transparent_index:v,interlaced:!!K,delay:g,disposal:w});break;case 59:x=!1;break;default:throw new Error("Unknown gif block: 0x"+t[r-1].toString(16))}this.numFrames=function(){return p.length},this.loopCount=function(){return y},this.frameInfo=function(Y){if(Y<0||Y>=p.length)throw new Error("Frame index out of range.");return p[Y]},this.decodeAndBlitFrameBGRA=function(Y,P){var B=this.frameInfo(Y),Ee=B.width*B.height,re=new Uint8Array(Ee);i(t,B.data_offset,re,Ee);var ae=B.palette_offset,oe=B.transparent_index;oe===null&&(oe=256);var O=B.width,ie=c-O,se=O,ke=(B.y*c+B.x)*4,qe=((B.y+B.height)*c+B.x)*4,F=ke,le=ie*4;B.interlaced===!0&&(le+=c*4*7);for(var ce=8,de=0,Ne=re.length;de<Ne;++de){var W=re[de];if(se===0&&(F+=le,se=O,F>=qe&&(le=ie*4+c*4*(ce-1),F=ke+(O+ie)*(ce<<1),ce>>=1)),W===oe)F+=4;else{var je=t[ae+W*3],He=t[ae+W*3+1],Ke=t[ae+W*3+2];P[F++]=Ke,P[F++]=He,P[F++]=je,P[F++]=255}--se}},this.decodeAndBlitFrameRGBA=function(Y,P){var B=this.frameInfo(Y),Ee=B.width*B.height,re=new Uint8Array(Ee);i(t,B.data_offset,re,Ee);var ae=B.palette_offset,oe=B.transparent_index;oe===null&&(oe=256);var O=B.width,ie=c-O,se=O,ke=(B.y*c+B.x)*4,qe=((B.y+B.height)*c+B.x)*4,F=ke,le=ie*4;B.interlaced===!0&&(le+=c*4*7);for(var ce=8,de=0,Ne=re.length;de<Ne;++de){var W=re[de];if(se===0&&(F+=le,se=O,F>=qe&&(le=ie*4+c*4*(ce-1),F=ke+(O+ie)*(ce<<1),ce>>=1)),W===oe)F+=4;else{var je=t[ae+W*3],He=t[ae+W*3+1],Ke=t[ae+W*3+2];P[F++]=je,P[F++]=He,P[F++]=Ke,P[F++]=255}--se}}}function i(t,r,c,u){for(var o=t[r++],h=1<<o,d=h+1,s=d+1,l=o+1,m=(1<<l)-1,x=0,p=0,g=0,v=t[r++],w=new Int32Array(4096),y=null;;){for(;x<16&&v!==0;)p|=t[r++]<<x,x+=8,v===1?v=t[r++]:--v;if(x<l)break;var I=p&m;if(p>>=l,x-=l,I===h){s=d+1,l=o+1,m=(1<<l)-1,y=null;continue}else if(I===d)break;for(var b=I<s?I:y,S=0,_=b;_>h;)_=w[_]>>8,++S;var C=_,E=g+S+(b!==I?1:0);if(E>u){console.log("Warning, gif stream longer than expected.");return}c[g++]=C,g+=S;var M=g;for(b!==I&&(c[g++]=C),_=b;S--;)_=w[_],c[--M]=_&255,_>>=8;y!==null&&s<4096&&(w[s++]=y<<8|C,s>=m+1&&l<12&&(++l,m=m<<1|1)),y=I}return g!==u&&console.log("Warning, gif stream shorter than expected."),c}try{Ge.GifWriter=e,Ge.GifReader=a}catch{}return Ge}var Dn=Cn(),q={},Ve={},N={},_t;function Qt(){if(_t)return N;_t=1,Object.defineProperty(N,"__esModule",{value:!0}),N.loop=N.conditional=N.parse=void 0;var e=function i(t,r){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:c;if(Array.isArray(r))r.forEach(function(h){return i(t,h,c,u)});else if(typeof r=="function")r(t,c,u,i);else{var o=Object.keys(r)[0];Array.isArray(r[o])?(u[o]={},i(t,r[o],c,u[o])):u[o]=r[o](t,c,u,i)}return c};N.parse=e;var n=function(t,r){return function(c,u,o,h){r(c,u,o)&&h(c,t,u,o)}};N.conditional=n;var a=function(t,r){return function(c,u,o,h){for(var d=[],s=c.pos;r(c,u,o);){var l={};if(h(c,t,u,l),c.pos===s)break;s=c.pos,d.push(l)}return d}};return N.loop=a,N}var D={},Et;function en(){if(Et)return D;Et=1,Object.defineProperty(D,"__esModule",{value:!0}),D.readBits=D.readArray=D.readUnsigned=D.readString=D.peekBytes=D.readBytes=D.peekByte=D.readByte=D.buildStream=void 0;var e=function(s){return{data:s,pos:0}};D.buildStream=e;var n=function(){return function(s){return s.data[s.pos++]}};D.readByte=n;var a=function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(l){return l.data[l.pos+s]}};D.peekByte=a;var i=function(s){return function(l){return l.data.subarray(l.pos,l.pos+=s)}};D.readBytes=i;var t=function(s){return function(l){return l.data.subarray(l.pos,l.pos+s)}};D.peekBytes=t;var r=function(s){return function(l){return Array.from(i(s)(l)).map(function(m){return String.fromCharCode(m)}).join("")}};D.readString=r;var c=function(s){return function(l){var m=i(2)(l);return s?(m[1]<<8)+m[0]:(m[0]<<8)+m[1]}};D.readUnsigned=c;var u=function(s,l){return function(m,x,p){for(var g=typeof l=="function"?l(m,x,p):l,v=i(s),w=new Array(g),y=0;y<g;y++)w[y]=v(m);return w}};D.readArray=u;var o=function(s,l,m){for(var x=0,p=0;p<m;p++)x+=s[l+p]&&Math.pow(2,m-p-1);return x},h=function(s){return function(l){for(var m=n()(l),x=new Array(8),p=0;p<8;p++)x[7-p]=!!(m&1<<p);return Object.keys(s).reduce(function(g,v){var w=s[v];return w.length?g[v]=o(x,w.index,w.length):g[v]=x[w.index],g},{})}};return D.readBits=h,D}var kt;function Ln(){return kt||(kt=1,(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=Qt(),a=en(),i={blocks:function(l){for(var m=0,x=[],p=l.data.length,g=0,v=(0,a.readByte)()(l);v!==m&&v;v=(0,a.readByte)()(l)){if(l.pos+v>=p){var w=p-l.pos;x.push((0,a.readBytes)(w)(l)),g+=w;break}x.push((0,a.readBytes)(v)(l)),g+=v}for(var y=new Uint8Array(g),I=0,b=0;b<x.length;b++)y.set(x[b],I),I+=x[b].length;return y}},t=(0,n.conditional)({gce:[{codes:(0,a.readBytes)(2)},{byteSize:(0,a.readByte)()},{extras:(0,a.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,a.readUnsigned)(!0)},{transparentColorIndex:(0,a.readByte)()},{terminator:(0,a.readByte)()}]},function(s){var l=(0,a.peekBytes)(2)(s);return l[0]===33&&l[1]===249}),r=(0,n.conditional)({image:[{code:(0,a.readByte)()},{descriptor:[{left:(0,a.readUnsigned)(!0)},{top:(0,a.readUnsigned)(!0)},{width:(0,a.readUnsigned)(!0)},{height:(0,a.readUnsigned)(!0)},{lct:(0,a.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,n.conditional)({lct:(0,a.readArray)(3,function(s,l,m){return Math.pow(2,m.descriptor.lct.size+1)})},function(s,l,m){return m.descriptor.lct.exists}),{data:[{minCodeSize:(0,a.readByte)()},i]}]},function(s){return(0,a.peekByte)()(s)===44}),c=(0,n.conditional)({text:[{codes:(0,a.readBytes)(2)},{blockSize:(0,a.readByte)()},{preData:function(l,m,x){return(0,a.readBytes)(x.text.blockSize)(l)}},i]},function(s){var l=(0,a.peekBytes)(2)(s);return l[0]===33&&l[1]===1}),u=(0,n.conditional)({application:[{codes:(0,a.readBytes)(2)},{blockSize:(0,a.readByte)()},{id:function(l,m,x){return(0,a.readString)(x.blockSize)(l)}},i]},function(s){var l=(0,a.peekBytes)(2)(s);return l[0]===33&&l[1]===255}),o=(0,n.conditional)({comment:[{codes:(0,a.readBytes)(2)},i]},function(s){var l=(0,a.peekBytes)(2)(s);return l[0]===33&&l[1]===254}),h=[{header:[{signature:(0,a.readString)(3)},{version:(0,a.readString)(3)}]},{lsd:[{width:(0,a.readUnsigned)(!0)},{height:(0,a.readUnsigned)(!0)},{gct:(0,a.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,a.readByte)()},{pixelAspectRatio:(0,a.readByte)()}]},(0,n.conditional)({gct:(0,a.readArray)(3,function(s,l){return Math.pow(2,l.lsd.gct.size+1)})},function(s,l){return l.lsd.gct.exists}),{frames:(0,n.loop)([t,u,o,r,c],function(s){var l=(0,a.peekByte)()(s);return l===33||l===44})}],d=h;e.default=d})(Ve)),Ve}var Be={},St;function Mn(){if(St)return Be;St=1,Object.defineProperty(Be,"__esModule",{value:!0}),Be.deinterlace=void 0;var e=function(a,i){for(var t=new Array(a.length),r=a.length/i,c=function(m,x){var p=a.slice(x*i,(x+1)*i);t.splice.apply(t,[m*i,i].concat(p))},u=[0,4,2,1],o=[8,8,4,2],h=0,d=0;d<4;d++)for(var s=u[d];s<r;s+=o[d])c(s,h),h++;return t};return Be.deinterlace=e,Be}var Ce={},Bt;function Fn(){if(Bt)return Ce;Bt=1,Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.lzw=void 0;var e=function(a,i,t){var r=4096,c=-1,u=t,o,h,d,s,l,m,x,_,p,g,S,v,C,E,L,M,w=new Array(t),y=new Array(r),I=new Array(r),b=new Array(r+1);for(v=a,h=1<<v,l=h+1,o=h+2,x=c,s=v+1,d=(1<<s)-1,p=0;p<h;p++)y[p]=0,I[p]=p;var S,_,C,E,M,L;for(S=_=C=E=M=L=0,g=0;g<u;){if(E===0){if(_<s){S+=i[L]<<_,_+=8,L++;continue}if(p=S&d,S>>=s,_-=s,p>o||p==l)break;if(p==h){s=v+1,d=(1<<s)-1,o=h+2,x=c;continue}if(x==c){b[E++]=I[p],x=p,C=p;continue}for(m=p,p==o&&(b[E++]=C,p=x);p>h;)b[E++]=I[p],p=y[p];C=I[p]&255,b[E++]=C,o<r&&(y[o]=x,I[o]=C,o++,(o&d)===0&&o<r&&(s++,d+=o)),x=m}E--,w[M++]=b[E],g++}for(g=M;g<u;g++)w[g]=0;return w};return Ce.lzw=e,Ce}var Ct;function Rn(){if(Ct)return q;Ct=1,Object.defineProperty(q,"__esModule",{value:!0}),q.decompressFrames=q.decompressFrame=q.parseGIF=void 0;var e=r(Ln()),n=Qt(),a=en(),i=Mn(),t=Fn();function r(d){return d&&d.__esModule?d:{default:d}}var c=function(s){var l=new Uint8Array(s);return(0,n.parse)((0,a.buildStream)(l),e.default)};q.parseGIF=c;var u=function(s){for(var l=s.pixels.length,m=new Uint8ClampedArray(l*4),x=0;x<l;x++){var p=x*4,g=s.pixels[x],v=s.colorTable[g]||[0,0,0];m[p]=v[0],m[p+1]=v[1],m[p+2]=v[2],m[p+3]=g!==s.transparentIndex?255:0}return m},o=function(s,l,m){if(!s.image){console.warn("gif frame does not have associated image.");return}var x=s.image,p=x.descriptor.width*x.descriptor.height,g=(0,t.lzw)(x.data.minCodeSize,x.data.blocks,p);x.descriptor.lct.interlaced&&(g=(0,i.deinterlace)(g,x.descriptor.width));var v={pixels:g,dims:{top:s.image.descriptor.top,left:s.image.descriptor.left,width:s.image.descriptor.width,height:s.image.descriptor.height}};return x.descriptor.lct&&x.descriptor.lct.exists?v.colorTable=x.lct:v.colorTable=l,s.gce&&(v.delay=(s.gce.delay||10)*10,v.disposalType=s.gce.extras.disposal,s.gce.extras.transparentColorGiven&&(v.transparentIndex=s.gce.transparentColorIndex)),m&&(v.patch=u(v)),v};q.decompressFrame=o;var h=function(s,l){return s.frames.filter(function(m){return m.image}).map(function(m){return o(m,s.gct,l)})};return q.decompressFrames=h,q}var Dt=Rn();const An=10*1024*1024,Pn=["image/png","image/jpeg","image/jpg","image/gif","image/webp"],tn=(e,{onInvalid:n}={})=>Pn.includes(e.type)?e.size>An?(n?.("ファイルサイズが大きすぎます。10MB以下のファイルを選択してください。"),!1):!0:(n?.("対応していないファイル形式です。PNG、JPEG、GIF、WebPファイルを選択してください。"),!1),ot=e=>e.type==="image/gif",it=e=>new Promise((n,a)=>{const i=new FileReader;i.onload=t=>{const r=new Image;r.onload=()=>n(r),r.onerror=()=>a(new Error("画像の読み込みに失敗しました")),r.src=t.target.result},i.onerror=()=>a(new Error("ファイルの読み込みに失敗しました")),i.readAsDataURL(e)}),$e=(e,n)=>{const a=document.createElement("canvas"),i=a.getContext("2d",{willReadFrequently:!0});return a.width=n.width,a.height=n.height,i.drawImage(n,0,0),{id:Date.now().toString()+Math.random().toString(36).substring(2,11),file:e,image:n,canvas:a,metadata:{width:n.width,height:n.height,type:e.type}}},Gn=async(e,{fullFrame:n=!0}={})=>{const a=await e.arrayBuffer();return n?zn(a):$n(a)},Tn=async(e,n,a,i=null)=>{const t=document.createElement("canvas");t.width=n,t.height=a;const r=t.getContext("2d");i!==null?(r.fillStyle=i,r.fillRect(0,0,n,a)):r.clearRect(0,0,n,a);const c=[];let u=null;for(let o=0;o<e.length;o++){const h=e[o];h.disposalType===3&&(u=r.getImageData(0,0,n,a));const d=h.dims.width,s=h.dims.height;if(d>0&&s>0){const m=new ImageData(new Uint8ClampedArray(h.patch),d,s);if(window.createImageBitmap){const x=await createImageBitmap(m);r.drawImage(x,h.dims.left,h.dims.top),x.close?.()}else{const x=document.createElement("canvas");x.width=d,x.height=s,x.getContext("2d").putImageData(m,0,0),r.drawImage(x,h.dims.left,h.dims.top)}}const l=await new Promise((m,x)=>{const p=new Image;p.onload=()=>m(p),p.onerror=x,p.src=t.toDataURL("image/png")});switch(c.push({image:l,delay:h.delay??100,disposal:h.disposalType??h.disposal}),h.disposalType){case 2:i!==null?(r.fillStyle=i,r.fillRect(h.dims.left,h.dims.top,h.dims.width,h.dims.height)):r.clearRect(h.dims.left,h.dims.top,h.dims.width,h.dims.height);break;case 3:u?r.putImageData(u,0,0):r.clearRect(h.dims.left,h.dims.top,h.dims.width,h.dims.height);break}}return c},zn=async e=>{const n=Dt.parseGIF(e),a=Dt.decompressFrames(n,!0);return(await Tn(a,n.lsd.width,n.lsd.height,null)).map(t=>({image:t.image,delay:t.delay,disposal:t.disposal}))},$n=async e=>{try{const n=new Uint8Array(e),a=new Dn.GifReader(n),i=[],t=document.createElement("canvas"),r=t.getContext("2d");t.width=a.width,t.height=a.height;for(let c=0;c<a.numFrames();c++){const u=a.frameInfo(c),o=r.createImageData(t.width,t.height);a.decodeAndBlitFrameRGBA(c,o.data),r.putImageData(o,0,0);const h=new Image;await new Promise((d,s)=>{h.onload=d,h.onerror=s,h.src=t.toDataURL("image/png")}),i.push({image:h,delay:u.delay*10,disposal:u.disposal})}return i}catch(n){return console.error("GIF解析エラー:",n),Un(e)}},Un=async e=>{const n=new Blob([e],{type:"image/gif"}),a=URL.createObjectURL(n);try{const i=new Image;await new Promise((u,o)=>{i.onload=u,i.onerror=o,i.src=a});const t=document.createElement("canvas"),r=t.getContext("2d");t.width=i.width,t.height=i.height,r.drawImage(i,0,0);const c=new Image;return await new Promise((u,o)=>{c.onload=u,c.onerror=o,c.src=t.toDataURL("image/png")}),[{image:c,delay:500,disposal:0}]}catch(i){throw console.error("フォールバックGIF処理エラー:",i),i}finally{URL.revokeObjectURL(a)}};let ft,mt,nn,rn,st,lt,ct,an,R,De;const ue=200,Xn=()=>f.transparentImages.length===0?null:f.transparentImages.some(n=>n.frameInfo?.isFromGif)?"gif":f.transparentImages.length>1?"sequence":null,Yn=e=>e.some(n=>ot(n))?"gif":e.length>1?"sequence":null,on=(e,{icon:n,text:a,subtext:i})=>{const t=e.querySelector(".upload-area__icon");t&&n&&(t.textContent=n);const r=e.querySelector(".upload-area__text");r&&(r.textContent=a);const c=e.querySelector(".upload-area__subtext");c&&(c.textContent=i)},On=()=>{const e=X();ft=e.backgroundDropzone,mt=e.transparentDropzone,nn=e.backgroundButton,rn=e.transparentButton,st=e.backgroundInput,lt=e.transparentInput,ct=e.scaleInput,an=e.aspectRatioSelect,R=e.animationSpeedInput,De=e.animationSpeedValue},Wn=()=>{const e=(n,a)=>{n.addEventListener("dragover",i=>{i.preventDefault(),n.classList.add("upload-area__dropzone--dragover")}),n.addEventListener("dragleave",()=>{n.classList.remove("upload-area__dropzone--dragover")}),n.addEventListener("drop",i=>{i.preventDefault(),n.classList.remove("upload-area__dropzone--dragover");const t=i.dataTransfer?.files;t&&t.length>0&&a(t)})};e(ft,n=>sn(n[0])),e(mt,ln)},qn=()=>{nn.addEventListener("click",()=>{st.click()}),rn.addEventListener("click",()=>{lt.click()}),st.addEventListener("change",e=>{const n=e.target.files;n&&n.length>0&&sn(n[0]),e.target.value=""}),lt.addEventListener("change",e=>{const n=e.target.files;n&&n.length>0&&ln(n),e.target.value=""})},sn=async e=>{if(tn(e,{onInvalid:A}))try{console.log("背景画像読み込み開始:",e.name);const n=await it(e),a=$e(e,n);f.backgroundImage=a,f.transformState.cropArea=null,f.transformState.aspectRatio="original",an.value="original",te()&&at(!1),on(ft,{icon:"✅",text:`背景画像: ${e.name}`,subtext:`${n.width} × ${n.height}px`}),$(),Q(),console.log("背景画像読み込み完了")}catch(n){console.error("背景画像読み込みエラー:",n),A("背景画像の読み込みに失敗しました: "+n.message)}},ln=async e=>{const n=Array.from(e).filter(a=>tn(a,{onInvalid:A}));if(n.length!==0)try{console.log("透過画像読み込み開始:",n.map(d=>d.name));const a=f.transparentImages.length>0,i=Xn(),t=Yn(n);f.transparentImages=[],a||(f.transformState.position={x:0,y:0}),a&&i==="sequence"&&t==="sequence"?ct.value=f.transformState.scale:(f.transformState.scale=1,ct.value=1);for(const d of n)if(ot(d)){console.log("GIFファイルを処理中:",d.name);try{const s=await Gn(d,{fullFrame:!0}),l=s.map(g=>g.delay),m=l.reduce((g,v)=>g+v,0)/l.length,x=Math.min(...l),p=Math.max(...l);if(m>0){const g=Math.round(m),v=parseInt(R.min,10),w=parseInt(R.max,10),y=Math.min(v,Math.max(10,Math.round(x))),I=Math.max(w,Math.round(p));R.min=y,R.max=I,R.step=g<100?10:50,f.animationSettings.frameDelay=g,R.value=g,De.textContent=`${g}ms`,console.log(`GIFの元フレーム間隔を適用: ${g}ms (範囲: ${y}-${I}ms)`),console.log("フレーム間隔の詳細:",l)}else R.min=50,R.max=2e3,R.step=50,f.animationSettings.frameDelay=ue,R.value=ue,De.textContent=`${ue}ms`,console.log(`GIFのディレイ情報が欠落していたため、デフォルト${ue}msを適用`);for(let g=0;g<s.length;g++){const v=s[g],w=new File([d],`${d.name}_frame_${g+1}`,{type:"image/png"}),y=$e(w,v.image);y.frameInfo={delay:v.delay,disposal:v.disposal,isFromGif:!0,originalIndex:g},f.transparentImages.push(y)}console.log(`GIFから ${s.length} フレームを抽出しました`)}catch(s){console.error("GIF処理エラー:",s),A(`GIFファイル ${d.name} の処理に失敗しました: ${s.message}`);const l=await it(d),m=$e(d,l);f.transparentImages.push(m)}}else{const s=await it(d),l=$e(d,s);f.transparentImages.push(l)}const c=f.transparentImages.some(d=>d.frameInfo?.isFromGif);if(t==="sequence"&&!c)if(R.min=10,R.max=1e3,R.step=10,i==="sequence"&&t==="sequence"){const s=f.animationSettings.frameDelay;R.value=s,De.textContent=`${s}ms`,console.log("連番PNGどうしの差し替え: 再生速度を維持")}else f.animationSettings.frameDelay=ue,R.value=ue,De.textContent=`${ue}ms`,console.log("連番PNGアニメーションをデフォルト200msに設定");const u=f.transparentImages.length,o=n.some(d=>ot(d));let h="";o?h=`GIF含む ${n.length}ファイル → ${u}フレーム`:h=n.map(d=>d.name).join(", "),on(mt,{icon:"✨",text:`透過画像: ${h}`,subtext:`総フレーム数: ${u}`}),$(),Q(),Yt(),!te()&&f.transparentImages.length>0&&(Xe(!0),ee()),console.log("透過画像読み込み完了")}catch(a){console.error("透過画像読み込みエラー:",a),A("透過画像の読み込みに失敗しました: "+a.message)}},Nn=()=>{On(),Wn(),qn()};let Ie,dt,he,Le=!1,Me=!1,be=0,_e=0,Ye=null,Ue=0,Fe=!1,Re=!1,Oe=null;const J=50,Lt=(e,n,a)=>{let i=e;return i=Math.max(n,i),typeof a=="number"&&(i=Math.min(a,i)),i},jn=(e="")=>e.includes("--nw")?"nw":e.includes("--ne")?"ne":e.includes("--sw")?"sw":e.includes("--se")?"se":e.includes("--n")?"north":e.includes("--s")?"south":e.includes("--w")?"west":e.includes("--e")?"east":null,Hn=(e,n,a,i,t)=>{let r=Math.max(J,e),c=Math.max(J,n);return typeof i=="number"&&r>i&&(r=i,c=r/a),typeof t=="number"&&c>t&&(c=t,r=c*a,typeof i=="number"&&r>i&&(r=i,c=r/a)),r=Math.max(J,r),c=Math.max(J,c),{width:r,height:c}},Kn=(e,n,a,i)=>{const t=n.x+n.width,r=n.y+n.height,c=n.x+n.width/2,u=n.y+n.height/2;switch(e){case"nw":return{maxWidth:t,maxHeight:r};case"ne":return{maxWidth:a-n.x,maxHeight:r};case"sw":return{maxWidth:t,maxHeight:i-n.y};case"se":return{maxWidth:a-n.x,maxHeight:i-n.y};case"north":return{maxWidth:2*Math.min(c,a-c),maxHeight:r};case"south":return{maxWidth:2*Math.min(c,a-c),maxHeight:i-n.y};case"west":return{maxWidth:t,maxHeight:2*Math.min(u,i-u)};case"east":return{maxWidth:a-n.x,maxHeight:2*Math.min(u,i-u)};default:return{maxWidth:void 0,maxHeight:void 0}}},Vn=(e,n,a,i)=>{const t=i.x+i.width,r=i.y+i.height,c=i.x+i.width/2,u=i.y+i.height/2;switch(e){case"nw":return{x:t-n,y:r-a};case"ne":return{x:i.x,y:r-a};case"sw":return{x:t-n,y:i.y};case"se":return{x:i.x,y:i.y};case"north":return{x:c-n/2,y:r-a};case"south":return{x:c-n/2,y:i.y};case"west":return{x:t-n,y:u-a/2};case"east":return{x:i.x,y:u-a/2};default:return{x:i.x,y:i.y}}},Zn=(e,n,a,i,t,r,c)=>{const u=f.transformState.aspectRatio;if(!u||u==="free")return;const o=Ot(u);if(!o)return;const h=jn(e);if(!h)return;const d=["nw","ne","sw","se"].includes(h);let s=a.width,l=a.height;if(d)Math.abs(i)>=Math.abs(t)?(s=Math.max(J,a.width),l=s/o):(l=Math.max(J,a.height),s=l*o);else if(h==="north"||h==="south")l=Math.max(J,a.height),s=l*o;else if(h==="east"||h==="west")s=Math.max(J,a.width),l=s/o;else return;const{maxWidth:m,maxHeight:x}=Kn(h,n,r,c),p=Hn(s,l,o,m,x),g=Vn(h,p.width,p.height,n);a.x=Lt(g.x,0,r-p.width),a.y=Lt(g.y,0,c-p.height),a.width=p.width,a.height=p.height},cn=()=>{const e=X();Ie=e.previewCanvas,dt=e.boundingBox,he=e.cropBox},Mt=e=>{e.target.classList.contains("bounding-box__handle")?(Me=!0,Ye=e.target):Le=!0,be=e.clientX,_e=e.clientY,e.preventDefault(),e.stopPropagation()},Ft=e=>{if(!Le&&!Me)return;const n=e.clientX-be,a=e.clientY-_e;if(Le){const i=f.backgroundImage,t=f.transformState.cropArea,r=Ie.getBoundingClientRect(),c=xe({bgSize:i.metadata,cropArea:t,canvasRect:r}),u=n/c.scale,o=a/c.scale;f.transformState.position.x+=u,f.transformState.position.y+=o,$(),Q()}else if(Me&&Ye){const i=Ye.className;let t=0;i.includes("--nw")||i.includes("--sw")?t=-n:(i.includes("--ne")||i.includes("--se"))&&(t=n),Ue+=t*.1;const c=f.transformState.scale,u=Math.max(1,Math.round(c+Ue));if(u!==f.transformState.scale){f.transformState.scale=u;const{scaleInput:o}=X();o.value=u,$(),Ue=0}}be=e.clientX,_e=e.clientY},Rt=()=>{Le=!1,Me=!1,Ye=null,Ue=0},Jn=()=>{cn(),dt.addEventListener("mousedown",Mt),document.addEventListener("mousemove",Ft),document.addEventListener("mouseup",Rt),dt.addEventListener("touchstart",e=>{const n=e.touches[0],a=new MouseEvent("mousedown",{clientX:n.clientX,clientY:n.clientY});Mt(a),e.preventDefault()}),document.addEventListener("touchmove",e=>{if(Le||Me){const n=e.touches[0],a=new MouseEvent("mousemove",{clientX:n.clientX,clientY:n.clientY});Ft(a),e.preventDefault()}}),document.addEventListener("touchend",Rt)},At=e=>{e.target.classList.contains("crop-box__handle")?(Re=!0,Oe=e.target,parseInt(he.style.left,10),parseInt(he.style.top,10),parseInt(he.style.width,10),parseInt(he.style.height,10)):Fe=!0,be=e.clientX,_e=e.clientY,e.preventDefault(),e.stopPropagation()},Pt=e=>{if(!Fe&&!Re)return;const n=e.clientX-be,a=e.clientY-_e;if(Fe){const i=f.backgroundImage,t=Ie.getBoundingClientRect(),r=xe({bgSize:i.metadata,cropArea:null,canvasRect:t}),c=n/r.scale,u=a/r.scale,o=f.transformState.cropArea;if(!o)return;const h=Math.max(0,Math.min(i.metadata.width-o.width,o.x+c)),d=Math.max(0,Math.min(i.metadata.height-o.height,o.y+u));f.transformState.cropArea.x=h,f.transformState.cropArea.y=d,ye()}else if(Re&&Oe){const i=f.backgroundImage,t=f.transformState.cropArea,r=Ie.getBoundingClientRect();if(!t)return;const c=xe({bgSize:i.metadata,cropArea:null,canvasRect:r}),u=n/c.scale,o=a/c.scale,h=Oe.className,d={...t};h.includes("--nw")?(t.x=Math.max(0,t.x+u),t.y=Math.max(0,t.y+o),t.width=Math.max(50,t.width-u),t.height=Math.max(50,t.height-o)):h.includes("--ne")?(t.y=Math.max(0,t.y+o),t.width=Math.max(50,t.width+u),t.height=Math.max(50,t.height-o)):h.includes("--sw")?(t.x=Math.max(0,t.x+u),t.width=Math.max(50,t.width-u),t.height=Math.max(50,t.height+o)):h.includes("--se")?(t.width=Math.max(50,t.width+u),t.height=Math.max(50,t.height+o)):h.includes("--n")?(t.y=Math.max(0,t.y+o),t.height=Math.max(50,t.height-o)):h.includes("--s")?t.height=Math.max(50,t.height+o):h.includes("--w")?(t.x=Math.max(0,t.x+u),t.width=Math.max(50,t.width-u)):h.includes("--e")&&(t.width=Math.max(50,t.width+u)),Zn(h,d,t,u,o,i.metadata.width,i.metadata.height),ye()}be=e.clientX,_e=e.clientY},Gt=()=>{Fe=!1,Re=!1,Oe=null},Qn=()=>{he.addEventListener("mousedown",At),document.addEventListener("mousemove",Pt),document.addEventListener("mouseup",Gt),he.addEventListener("touchstart",e=>{const n=e.touches[0],a=new MouseEvent("mousedown",{clientX:n.clientX,clientY:n.clientY});At(a),e.preventDefault()}),document.addEventListener("touchmove",e=>{if(Fe||Re){const n=e.touches[0],a=new MouseEvent("mousemove",{clientX:n.clientX,clientY:n.clientY});Pt(a),e.preventDefault()}}),document.addEventListener("touchend",Gt)},er=()=>{Ie.addEventListener("click",e=>{if(te()||f.transparentImages.length===0)return;const n=f.transparentImages[0],a=f.backgroundImage,i=f.transformState.scale,t=f.transformState.position,r=f.transformState.cropArea,c=Ie.getBoundingClientRect(),u=e.clientX-c.left,o=e.clientY-c.top,h=we(n,i,t,a,r),d=xe({bgSize:a.metadata,cropArea:r??null,canvasRect:c}),s=h.x*d.scale+d.offsetX,l=h.y*d.scale+d.offsetY,m=h.width*d.scale,x=h.height*d.scale;u>=s&&u<=s+m&&o>=l&&o<=l+x?(Xe(!0),ee()):(Xe(!1),ee())})},tr=()=>{let e=null;const n=()=>{f.backgroundImage&&($(),ee(),te()&&ye(),te()||We(2e3))};window.addEventListener("resize",()=>{e&&clearTimeout(e),e=setTimeout(()=>{n()},150)}),window.addEventListener("orientationchange",()=>{setTimeout(n,300)})},nr=()=>{cn(),Jn(),Qn(),er(),tr(),or()},rr=()=>{const e=X(),n=document.activeElement;return n===e.positionInputX||n===e.positionInputY},ar=e=>{if(e.defaultPrevented||te()||rr()||!vn()||!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)||!f.backgroundImage||f.transparentImages.length===0)return;const n=mn(e.key,e.shiftKey);n&&(e.preventDefault(),Jt(n.axis,n.delta))},or=()=>{window.addEventListener("keydown",ar)};function Te(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ze={exports:{}},Tt;function ir(){return Tt||(Tt=1,(function(e,n){(function(a){e.exports=a()})(function(){return(function a(i,t,r){function c(h,d){if(!t[h]){if(!i[h]){var s=typeof Te=="function"&&Te;if(!d&&s)return s(h,!0);if(u)return u(h,!0);var l=new Error("Cannot find module '"+h+"'");throw l.code="MODULE_NOT_FOUND",l}var m=t[h]={exports:{}};i[h][0].call(m.exports,function(x){var p=i[h][1][x];return c(p||x)},m,m.exports,a,i,t,r)}return t[h].exports}for(var u=typeof Te=="function"&&Te,o=0;o<r.length;o++)c(r[o]);return c})({1:[function(a,i,t){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}i.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(d){if(!u(d)||d<0||isNaN(d))throw TypeError("n must be a positive number");return this._maxListeners=d,this},r.prototype.emit=function(d){var s,l,m,x,p,g;if(this._events||(this._events={}),d==="error"&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if(s=arguments[1],s instanceof Error)throw s;var v=new Error('Uncaught, unspecified "error" event. ('+s+")");throw v.context=s,v}if(l=this._events[d],h(l))return!1;if(c(l))switch(arguments.length){case 1:l.call(this);break;case 2:l.call(this,arguments[1]);break;case 3:l.call(this,arguments[1],arguments[2]);break;default:x=Array.prototype.slice.call(arguments,1),l.apply(this,x)}else if(o(l))for(x=Array.prototype.slice.call(arguments,1),g=l.slice(),m=g.length,p=0;p<m;p++)g[p].apply(this,x);return!0},r.prototype.addListener=function(d,s){var l;if(!c(s))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",d,c(s.listener)?s.listener:s),this._events[d]?o(this._events[d])?this._events[d].push(s):this._events[d]=[this._events[d],s]:this._events[d]=s,o(this._events[d])&&!this._events[d].warned&&(h(this._maxListeners)?l=r.defaultMaxListeners:l=this._maxListeners,l&&l>0&&this._events[d].length>l&&(this._events[d].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[d].length),typeof console.trace=="function"&&console.trace())),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(d,s){if(!c(s))throw TypeError("listener must be a function");var l=!1;function m(){this.removeListener(d,m),l||(l=!0,s.apply(this,arguments))}return m.listener=s,this.on(d,m),this},r.prototype.removeListener=function(d,s){var l,m,x,p;if(!c(s))throw TypeError("listener must be a function");if(!this._events||!this._events[d])return this;if(l=this._events[d],x=l.length,m=-1,l===s||c(l.listener)&&l.listener===s)delete this._events[d],this._events.removeListener&&this.emit("removeListener",d,s);else if(o(l)){for(p=x;p-- >0;)if(l[p]===s||l[p].listener&&l[p].listener===s){m=p;break}if(m<0)return this;l.length===1?(l.length=0,delete this._events[d]):l.splice(m,1),this._events.removeListener&&this.emit("removeListener",d,s)}return this},r.prototype.removeAllListeners=function(d){var s,l;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[d]&&delete this._events[d],this;if(arguments.length===0){for(s in this._events)s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events={},this}if(l=this._events[d],c(l))this.removeListener(d,l);else if(l)for(;l.length;)this.removeListener(d,l[l.length-1]);return delete this._events[d],this},r.prototype.listeners=function(d){var s;return!this._events||!this._events[d]?s=[]:c(this._events[d])?s=[this._events[d]]:s=this._events[d].slice(),s},r.prototype.listenerCount=function(d){if(this._events){var s=this._events[d];if(c(s))return 1;if(s)return s.length}return 0},r.listenerCount=function(d,s){return d.listenerCount(s)};function c(d){return typeof d=="function"}function u(d){return typeof d=="number"}function o(d){return typeof d=="object"&&d!==null}function h(d){return d===void 0}},{}],2:[function(a,i,t){var r,c,u,o,h;h=navigator.userAgent.toLowerCase(),o=navigator.platform.toLowerCase(),r=h.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],u=r[1]==="ie"&&document.documentMode,c={name:r[1]==="version"?r[3]:r[1],version:u||parseFloat(r[1]==="opera"&&r[4]?r[4]:r[2]),platform:{name:h.match(/ip(?:ad|od|hone)/)?"ios":(h.match(/(?:webos|android)/)||o.match(/mac|win|linux/)||["other"])[0]}},c[c.name]=!0,c[c.name+parseInt(c.version,10)]=!0,c.platform[c.platform.name]=!0,i.exports=c},{}],3:[function(a,i,t){var r,c,u,o=function(l,m){for(var x in m)h.call(m,x)&&(l[x]=m[x]);function p(){this.constructor=l}return p.prototype=m.prototype,l.prototype=new p,l.__super__=m.prototype,l},h={}.hasOwnProperty,d=[].indexOf||function(l){for(var m=0,x=this.length;m<x;m++)if(m in this&&this[m]===l)return m;return-1},s=[].slice;r=a("events").EventEmitter,u=a("./browser.coffee"),c=(function(l){var m,x;o(p,l),m={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},x={delay:500,copy:!1};function p(g){var v,w,y;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(g);for(w in m)y=m[w],(v=this.options)[w]==null&&(v[w]=y)}return p.prototype.setOption=function(g,v){if(this.options[g]=v,this._canvas!=null&&(g==="width"||g==="height"))return this._canvas[g]=v},p.prototype.setOptions=function(g){var v,w,y;w=[];for(v in g)h.call(g,v)&&(y=g[v],w.push(this.setOption(v,y)));return w},p.prototype.addFrame=function(g,v){var w,y;v==null&&(v={}),w={},w.transparent=this.options.transparent;for(y in x)w[y]=v[y]||x[y];if(this.options.width==null&&this.setOption("width",g.width),this.options.height==null&&this.setOption("height",g.height),typeof ImageData<"u"&&ImageData!==null&&g instanceof ImageData)w.data=g.data;else if(typeof CanvasRenderingContext2D<"u"&&CanvasRenderingContext2D!==null&&g instanceof CanvasRenderingContext2D||typeof WebGLRenderingContext<"u"&&WebGLRenderingContext!==null&&g instanceof WebGLRenderingContext)v.copy?w.data=this.getContextData(g):w.context=g;else if(g.childNodes!=null)v.copy?w.data=this.getImageData(g):w.image=g;else throw new Error("Invalid image");return this.frames.push(w)},p.prototype.render=function(){var g,v,w;if(this.running)throw new Error("Already running");if(this.options.width==null||this.options.height==null)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=(function(){var y,I,b;for(b=[],y=0,I=this.frames.length;0<=I?y<I:y>I;0<=I?++y:--y)b.push(null);return b}).call(this),v=this.spawnWorkers(),this.options.globalPalette===!0)this.renderNextFrame();else for(g=0,w=v;0<=w?g<w:g>w;0<=w?++g:--g)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},p.prototype.abort=function(){for(var g;g=this.activeWorkers.shift(),g!=null;)this.log("killing active worker"),g.terminate();return this.running=!1,this.emit("abort")},p.prototype.spawnWorkers=function(){var g,v,w;return g=Math.min(this.options.workers,this.frames.length),(function(){w=[];for(var y=v=this.freeWorkers.length;v<=g?y<g:y>g;v<=g?y++:y--)w.push(y);return w}).apply(this).forEach((function(y){return function(I){var b;return y.log("spawning worker "+I),b=new Worker(y.options.workerScript),b.onmessage=function(S){return y.activeWorkers.splice(y.activeWorkers.indexOf(b),1),y.freeWorkers.push(b),y.frameFinished(S.data)},y.freeWorkers.push(b)}})(this)),g},p.prototype.frameFinished=function(g){var v,w;if(this.log("frame "+g.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[g.index]=g,this.options.globalPalette===!0&&(this.options.globalPalette=g.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(v=1,w=this.freeWorkers.length;1<=w?v<w:v>w;1<=w?++v:--v)this.renderNextFrame();return d.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},p.prototype.finishRendering=function(){var g,v,w,y,I,b,S,_,C,E,M,L,K,T,U,z;for(_=0,T=this.imageParts,I=0,C=T.length;I<C;I++)v=T[I],_+=(v.data.length-1)*v.pageSize+v.cursor;for(_+=v.pageSize-v.cursor,this.log("rendering finished - filesize "+Math.round(_/1e3)+"kb"),g=new Uint8Array(_),L=0,U=this.imageParts,b=0,E=U.length;b<E;b++)for(v=U[b],z=v.data,w=S=0,M=z.length;S<M;w=++S)K=z[w],g.set(K,L),w===v.data.length-1?L+=v.cursor:L+=v.pageSize;return y=new Blob([g],{type:"image/gif"}),this.emit("finished",y,g)},p.prototype.renderNextFrame=function(){var g,v,w;if(this.freeWorkers.length===0)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return g=this.frames[this.nextFrame++],w=this.freeWorkers.shift(),v=this.getTask(g),this.log("starting frame "+(v.index+1)+" of "+this.frames.length),this.activeWorkers.push(w),w.postMessage(v)},p.prototype.getContextData=function(g){return g.getImageData(0,0,this.options.width,this.options.height).data},p.prototype.getImageData=function(g){var v;return this._canvas==null&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),v=this._canvas.getContext("2d"),v.setFill=this.options.background,v.fillRect(0,0,this.options.width,this.options.height),v.drawImage(g,0,0),this.getContextData(v)},p.prototype.getTask=function(g){var v,w;if(v=this.frames.indexOf(g),w={index:v,last:v===this.frames.length-1,delay:g.delay,transparent:g.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:u.name==="chrome"},g.data!=null)w.data=g.data;else if(g.context!=null)w.data=this.getContextData(g.context);else if(g.image!=null)w.data=this.getImageData(g.image);else throw new Error("Invalid frame");return w},p.prototype.log=function(){var g;if(g=1<=arguments.length?s.call(arguments,0):[],!!this.options.debug)return console.log.apply(console,g)},p})(r),i.exports=c},{"./browser.coffee":2,events:1}]},{},[3])(3)})})(Ze)),Ze.exports}var sr=ir();const lr=Bn(sr),cr=()=>{if(!f.backgroundImage||f.transparentImages.length===0){A("背景画像と透過画像の両方が必要です");return}try{const e=document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0}),a=f.backgroundImage,i=f.transparentImages[0],t=f.transformState.scale,r=f.transformState.position,c=f.transformState.cropArea;c?(e.width=c.width,e.height=c.height):(e.width=a.metadata.width,e.height=a.metadata.height),c?n.drawImage(a.image,c.x,c.y,c.width,c.height,0,0,e.width,e.height):n.drawImage(a.image,0,0);const u=we(i,t,r,a,c);n.imageSmoothingEnabled=!1,n.drawImage(i.image,u.x,u.y,u.width,u.height),e.toBlob(o=>{if(o){const h=URL.createObjectURL(o),d=document.createElement("a");d.href=h,d.download=`x-post-image-${Date.now()}.png`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(h),console.log("PNG エクスポート完了"),ze("PNG画像をダウンロードしました")}else throw new Error("PNG生成に失敗しました")},"image/png")}catch(e){console.error("PNG エクスポートエラー:",e),A("PNG エクスポートに失敗しました: "+e.message)}},dr=()=>{if(!f.backgroundImage||f.transparentImages.length===0){A("背景画像と透過画像の両方が必要です");return}if(f.transparentImages.length===1){A("GIF生成には複数の透過画像が必要です。単一画像の場合はPNGをご利用ください。");return}try{console.log("GIF生成開始...");const e=f.backgroundImage,n=f.transformState.scale,a=f.transformState.position,i=f.transformState.cropArea;let t,r;i?(t=i.width,r=i.height):(t=e.metadata.width,r=e.metadata.height);const c=new URL("/250811_png-gif-app/assets/gif.worker-CjkyQP34.js",import.meta.url).href,u=new lr({workers:2,quality:15,width:t,height:r,repeat:0,workerScript:c}),o=document.createElement("canvas"),h=o.getContext("2d",{willReadFrequently:!0});o.width=t,o.height=r,f.transparentImages.forEach((s,l)=>{try{h.clearRect(0,0,t,r),i?h.drawImage(e.image,i.x,i.y,i.width,i.height,0,0,t,r):h.drawImage(e.image,0,0);const m=we(s,n,a,e,i);h.imageSmoothingEnabled=!1,h.drawImage(s.image,m.x,m.y,m.width,m.height),u.addFrame(o,{copy:!0,delay:f.animationSettings.frameDelay}),console.log(`フレーム ${l+1}/${f.transparentImages.length} 追加完了`)}catch(m){throw console.error(`フレーム ${l+1} の処理でエラー:`,m),m}}),u.on("finished",s=>{try{const l=URL.createObjectURL(s),m=document.createElement("a");m.href=l,m.download=`x-post-animation-${Date.now()}.gif`,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(l),console.log("GIF エクスポート完了"),ze("GIFアニメーションをダウンロードしました")}catch(l){console.error("GIF ダウンロードエラー:",l),A("GIF ダウンロードに失敗しました")}}),u.on("error",s=>{console.error("GIF生成エラー:",s),A("GIF生成中にエラーが発生しました: "+s.message)}),u.on("progress",s=>{const l=Math.round(s*100);console.log(`GIF生成進捗: ${l}%`),l%25===0&&ze(`GIF生成中... ${l}%`)});const d=setTimeout(()=>{console.error("GIF生成がタイムアウトしました"),A("GIF生成に時間がかかりすぎています。画像サイズを小さくするか、フレーム数を減らしてください。")},3e4);u.on("finished",()=>{clearTimeout(d)}),u.render(),console.log("GIF生成処理を開始しました..."),ze("GIF生成中です。しばらくお待ちください...")}catch(e){console.error("GIF エクスポートエラー:",e),A("GIF エクスポートに失敗しました: "+e.message)}},ur=()=>{const{exportPngButton:e,exportGifButton:n}=X();e.addEventListener("click",cr),n.addEventListener("click",dr)},hr=e=>{if(!e)return;e.textContent="",["nw","ne","sw","se"].forEach(i=>{const t=document.createElement("div");t.className=`bounding-box__handle bounding-box__handle--${i}`,e.appendChild(t)}),["top","right","bottom","left"].forEach(i=>{const t=document.createElement("div");t.className=`bounding-box__border bounding-box__border--${i}`,e.appendChild(t)})},gr=e=>{if(!e)return;e.textContent="",["nw","ne","sw","se","n","e","s","w"].forEach(i=>{const t=document.createElement("div");t.className=`crop-box__handle crop-box__handle--${i}`,e.appendChild(t)}),["top","right","bottom","left"].forEach(i=>{const t=document.createElement("div");t.className=`crop-box__overlay crop-box__overlay--${i}`,e.appendChild(t)})},fr=()=>{zt(),pn();const e=X();hr(e.boundingBox),gr(e.cropBox),Nn(),Sn(),nr(),ur()};document.addEventListener("DOMContentLoaded",()=>{fr()});

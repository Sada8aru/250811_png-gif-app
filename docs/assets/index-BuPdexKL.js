(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))u(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&u(c)}).observe(document,{childList:!0,subtree:!0});function l(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function u(e){if(e.ep)return;e.ep=!0;const n=l(e);fetch(e.href,n)}})();const $t=()=>({backgroundDropzone:document.getElementById("backgroundDropzone"),transparentDropzone:document.getElementById("transparentDropzone"),backgroundButton:document.getElementById("backgroundButton"),transparentButton:document.getElementById("transparentButton"),backgroundInput:document.getElementById("backgroundInput"),transparentInput:document.getElementById("transparentInput"),previewContainer:document.getElementById("previewContainer"),previewCanvas:document.getElementById("previewCanvas"),previewPlaceholder:document.getElementById("previewPlaceholder"),boundingBox:document.getElementById("boundingBox"),cropBox:document.getElementById("cropBox"),cropModeToggle:document.getElementById("cropModeToggle"),cropControls:document.getElementById("cropControls"),scaleInput:document.getElementById("scaleInput"),aspectRatioSelect:document.getElementById("aspectRatioSelect"),animationSpeedInput:document.getElementById("animationSpeedInput"),animationSpeedValue:document.getElementById("animationSpeedValue"),exportPngButton:document.getElementById("exportPngButton"),exportGifButton:document.getElementById("exportGifButton"),errorMessage:document.getElementById("errorMessage")});let Ye;const xt=()=>(Ye=$t(),Ye),N=()=>Ye??xt(),Ot=()=>({scale:1,position:{x:0,y:0},cropArea:null,aspectRatio:"original"}),p={backgroundImage:null,transparentImages:[],transformState:Ot(),outputSettings:{format:"PNG",maxWidth:1200,maxHeight:675},animationSettings:{frameDelay:500}},A=t=>{const{errorMessage:r}=N();r&&(r.textContent=t,r.style.display="block",r.style.backgroundColor="#f44336",r.style.color="white",setTimeout(()=>{r.style.display="none"},5e3))},Le=t=>{const{errorMessage:r}=N();r&&(r.textContent=t,r.style.display="block",r.style.backgroundColor="#4CAF50",r.style.color="white",setTimeout(()=>{r.style.display="none",r.style.backgroundColor="#f44336",r.style.color="white"},3e3))};function qt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ce={},at;function Xt(){if(at)return Ce;at=1;function t(e,n,c,d){var i=0,d=d===void 0?{}:d,s=d.loop===void 0?null:d.loop,a=d.palette===void 0?null:d.palette;if(n<=0||c<=0||n>65535||c>65535)throw new Error("Width/Height invalid.");function o(I){var _=I.length;if(_<2||_>256||_&_-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return _}e[i++]=71,e[i++]=73,e[i++]=70,e[i++]=56,e[i++]=57,e[i++]=97;var g=0,v=0;if(a!==null){for(var f=o(a);f>>=1;)++g;if(f=1<<g,--g,d.background!==void 0){if(v=d.background,v>=f)throw new Error("Background index out of range.");if(v===0)throw new Error("Background index explicitly passed as 0.")}}if(e[i++]=n&255,e[i++]=n>>8&255,e[i++]=c&255,e[i++]=c>>8&255,e[i++]=(a!==null?128:0)|g,e[i++]=v,e[i++]=0,a!==null)for(var h=0,m=a.length;h<m;++h){var x=a[h];e[i++]=x>>16&255,e[i++]=x>>8&255,e[i++]=x&255}if(s!==null){if(s<0||s>65535)throw new Error("Loop count invalid.");e[i++]=33,e[i++]=255,e[i++]=11,e[i++]=78,e[i++]=69,e[i++]=84,e[i++]=83,e[i++]=67,e[i++]=65,e[i++]=80,e[i++]=69,e[i++]=50,e[i++]=46,e[i++]=48,e[i++]=3,e[i++]=1,e[i++]=s&255,e[i++]=s>>8&255,e[i++]=0}var y=!1;this.addFrame=function(I,_,B,k,C,S){if(y===!0&&(--i,y=!1),S=S===void 0?{}:S,I<0||_<0||I>65535||_>65535)throw new Error("x/y invalid.");if(B<=0||k<=0||B>65535||k>65535)throw new Error("Width/Height invalid.");if(C.length<B*k)throw new Error("Not enough pixels for the frame size.");var D=!0,R=S.palette;if(R==null&&(D=!1,R=a),R==null)throw new Error("Must supply either a local or global palette.");for(var j=o(R),P=0;j>>=1;)++P;j=1<<P;var U=S.delay===void 0?0:S.delay,T=S.disposal===void 0?0:S.disposal;if(T<0||T>3)throw new Error("Disposal out of range.");var ce=!1,Z=0;if(S.transparent!==void 0&&S.transparent!==null&&(ce=!0,Z=S.transparent,Z<0||Z>=j))throw new Error("Transparent color index.");if((T!==0||ce||U!==0)&&(e[i++]=33,e[i++]=249,e[i++]=4,e[i++]=T<<2|(ce===!0?1:0),e[i++]=U&255,e[i++]=U>>8&255,e[i++]=Z,e[i++]=0),e[i++]=44,e[i++]=I&255,e[i++]=I>>8&255,e[i++]=_&255,e[i++]=_>>8&255,e[i++]=B&255,e[i++]=B>>8&255,e[i++]=k&255,e[i++]=k>>8&255,e[i++]=D===!0?128|P-1:0,D===!0)for(var de=0,$=R.length;de<$;++de){var G=R[de];e[i++]=G>>16&255,e[i++]=G>>8&255,e[i++]=G&255}return i=r(e,i,P<2?2:P,C),i},this.end=function(){return y===!1&&(e[i++]=59,y=!0),i},this.getOutputBuffer=function(){return e},this.setOutputBuffer=function(I){e=I},this.getOutputBufferPosition=function(){return i},this.setOutputBufferPosition=function(I){i=I}}function r(e,n,c,w){e[n++]=c;var i=n++,d=1<<c,s=d-1,a=d+1,o=a+1,g=c+1,v=0,f=0;function h(S){for(;v>=S;)e[n++]=f&255,f>>=8,v-=8,n===i+256&&(e[i]=255,i=n++)}function m(S){f|=S<<v,v+=g,h(8)}var x=w[0]&s,y={};m(d);for(var I=1,_=w.length;I<_;++I){var B=w[I]&s,k=x<<8|B,C=y[k];if(C===void 0){for(f|=x<<v,v+=g;v>=8;)e[n++]=f&255,f>>=8,v-=8,n===i+256&&(e[i]=255,i=n++);o===4096?(m(d),o=a+1,g=c+1,y={}):(o>=1<<g&&++g,y[k]=o++),x=B}else x=C}return m(x),m(a),h(1),i+1===n?e[i]=0:(e[i]=n-i-1,e[n++]=0),n}function l(e){var n=0;if(e[n++]!==71||e[n++]!==73||e[n++]!==70||e[n++]!==56||(e[n++]+1&253)!==56||e[n++]!==97)throw new Error("Invalid GIF 87a/89a header.");var c=e[n++]|e[n++]<<8,w=e[n++]|e[n++]<<8,i=e[n++],d=i>>7,s=i&7,a=1<<s+1;e[n++],e[n++];var o=null,g=null;d&&(o=n,g=a,n+=a*3);var v=!0,f=[],h=0,m=null,x=0,y=null;for(this.width=c,this.height=w;v&&n<e.length;)switch(e[n++]){case 33:switch(e[n++]){case 255:if(e[n]!==11||e[n+1]==78&&e[n+2]==69&&e[n+3]==84&&e[n+4]==83&&e[n+5]==67&&e[n+6]==65&&e[n+7]==80&&e[n+8]==69&&e[n+9]==50&&e[n+10]==46&&e[n+11]==48&&e[n+12]==3&&e[n+13]==1&&e[n+16]==0)n+=14,y=e[n++]|e[n++]<<8,n++;else for(n+=12;;){var I=e[n++];if(!(I>=0))throw Error("Invalid block size");if(I===0)break;n+=I}break;case 249:if(e[n++]!==4||e[n+4]!==0)throw new Error("Invalid graphics extension block.");var _=e[n++];h=e[n++]|e[n++]<<8,m=e[n++],(_&1)===0&&(m=null),x=_>>2&7,n++;break;case 254:for(;;){var I=e[n++];if(!(I>=0))throw Error("Invalid block size");if(I===0)break;n+=I}break;default:throw new Error("Unknown graphic control label: 0x"+e[n-1].toString(16))}break;case 44:var B=e[n++]|e[n++]<<8,k=e[n++]|e[n++]<<8,C=e[n++]|e[n++]<<8,S=e[n++]|e[n++]<<8,D=e[n++],R=D>>7,j=D>>6&1,P=D&7,U=1<<P+1,T=o,ce=g,Z=!1;if(R){var Z=!0;T=n,ce=U,n+=U*3}var de=n;for(n++;;){var I=e[n++];if(!(I>=0))throw Error("Invalid block size");if(I===0)break;n+=I}f.push({x:B,y:k,width:C,height:S,has_local_palette:Z,palette_offset:T,palette_size:ce,data_offset:de,data_length:n-de,transparent_index:m,interlaced:!!j,delay:h,disposal:x});break;case 59:v=!1;break;default:throw new Error("Unknown gif block: 0x"+e[n-1].toString(16))}this.numFrames=function(){return f.length},this.loopCount=function(){return y},this.frameInfo=function($){if($<0||$>=f.length)throw new Error("Frame index out of range.");return f[$]},this.decodeAndBlitFrameBGRA=function($,G){var b=this.frameInfo($),ve=b.width*b.height,J=new Uint8Array(ve);u(e,b.data_offset,J,ve);var Q=b.palette_offset,ee=b.transparent_index;ee===null&&(ee=256);var O=b.width,te=c-O,ne=O,we=(b.y*c+b.x)*4,Te=((b.y+b.height)*c+b.x)*4,L=we,re=te*4;b.interlaced===!0&&(re+=c*4*7);for(var ae=8,oe=0,Ue=J.length;oe<Ue;++oe){var q=J[oe];if(ne===0&&(L+=re,ne=O,L>=Te&&(re=te*4+c*4*(ae-1),L=we+(O+te)*(ae<<1),ae>>=1)),q===ee)L+=4;else{var $e=e[Q+q*3],Oe=e[Q+q*3+1],qe=e[Q+q*3+2];G[L++]=qe,G[L++]=Oe,G[L++]=$e,G[L++]=255}--ne}},this.decodeAndBlitFrameRGBA=function($,G){var b=this.frameInfo($),ve=b.width*b.height,J=new Uint8Array(ve);u(e,b.data_offset,J,ve);var Q=b.palette_offset,ee=b.transparent_index;ee===null&&(ee=256);var O=b.width,te=c-O,ne=O,we=(b.y*c+b.x)*4,Te=((b.y+b.height)*c+b.x)*4,L=we,re=te*4;b.interlaced===!0&&(re+=c*4*7);for(var ae=8,oe=0,Ue=J.length;oe<Ue;++oe){var q=J[oe];if(ne===0&&(L+=re,ne=O,L>=Te&&(re=te*4+c*4*(ae-1),L=we+(O+te)*(ae<<1),ae>>=1)),q===ee)L+=4;else{var $e=e[Q+q*3],Oe=e[Q+q*3+1],qe=e[Q+q*3+2];G[L++]=$e,G[L++]=Oe,G[L++]=qe,G[L++]=255}--ne}}}function u(e,n,c,w){for(var i=e[n++],d=1<<i,s=d+1,a=s+1,o=i+1,g=(1<<o)-1,v=0,f=0,h=0,m=e[n++],x=new Int32Array(4096),y=null;;){for(;v<16&&m!==0;)f|=e[n++]<<v,v+=8,m===1?m=e[n++]:--m;if(v<o)break;var I=f&g;if(f>>=o,v-=o,I===d){a=s+1,o=i+1,g=(1<<o)-1,y=null;continue}else if(I===s)break;for(var _=I<a?I:y,B=0,k=_;k>d;)k=x[k]>>8,++B;var C=k,S=h+B+(_!==I?1:0);if(S>w){console.log("Warning, gif stream longer than expected.");return}c[h++]=C,h+=B;var D=h;for(_!==I&&(c[h++]=C),k=_;B--;)k=x[k],c[--D]=k&255,k>>=8;y!==null&&a<4096&&(x[a++]=y<<8|C,a>=g+1&&o<12&&(++o,g=g<<1|1)),y=I}return h!==w&&console.log("Warning, gif stream shorter than expected."),c}try{Ce.GifWriter=t,Ce.GifReader=l}catch{}return Ce}var Wt=Xt(),X={},Xe={},W={},ot;function yt(){if(ot)return W;ot=1,Object.defineProperty(W,"__esModule",{value:!0}),W.loop=W.conditional=W.parse=void 0;var t=function u(e,n){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},w=arguments.length>3&&arguments[3]!==void 0?arguments[3]:c;if(Array.isArray(n))n.forEach(function(d){return u(e,d,c,w)});else if(typeof n=="function")n(e,c,w,u);else{var i=Object.keys(n)[0];Array.isArray(n[i])?(w[i]={},u(e,n[i],c,w[i])):w[i]=n[i](e,c,w,u)}return c};W.parse=t;var r=function(e,n){return function(c,w,i,d){n(c,w,i)&&d(c,e,w,i)}};W.conditional=r;var l=function(e,n){return function(c,w,i,d){for(var s=[],a=c.pos;n(c,w,i);){var o={};if(d(c,e,w,o),c.pos===a)break;a=c.pos,s.push(o)}return s}};return W.loop=l,W}var F={},it;function It(){if(it)return F;it=1,Object.defineProperty(F,"__esModule",{value:!0}),F.readBits=F.readArray=F.readUnsigned=F.readString=F.peekBytes=F.readBytes=F.peekByte=F.readByte=F.buildStream=void 0;var t=function(a){return{data:a,pos:0}};F.buildStream=t;var r=function(){return function(a){return a.data[a.pos++]}};F.readByte=r;var l=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(o){return o.data[o.pos+a]}};F.peekByte=l;var u=function(a){return function(o){return o.data.subarray(o.pos,o.pos+=a)}};F.readBytes=u;var e=function(a){return function(o){return o.data.subarray(o.pos,o.pos+a)}};F.peekBytes=e;var n=function(a){return function(o){return Array.from(u(a)(o)).map(function(g){return String.fromCharCode(g)}).join("")}};F.readString=n;var c=function(a){return function(o){var g=u(2)(o);return a?(g[1]<<8)+g[0]:(g[0]<<8)+g[1]}};F.readUnsigned=c;var w=function(a,o){return function(g,v,f){for(var h=typeof o=="function"?o(g,v,f):o,m=u(a),x=new Array(h),y=0;y<h;y++)x[y]=m(g);return x}};F.readArray=w;var i=function(a,o,g){for(var v=0,f=0;f<g;f++)v+=a[o+f]&&Math.pow(2,g-f-1);return v},d=function(a){return function(o){for(var g=r()(o),v=new Array(8),f=0;f<8;f++)v[7-f]=!!(g&1<<f);return Object.keys(a).reduce(function(h,m){var x=a[m];return x.length?h[m]=i(v,x.index,x.length):h[m]=v[x.index],h},{})}};return F.readBits=d,F}var st;function Yt(){return st||(st=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=yt(),l=It(),u={blocks:function(o){for(var g=0,v=[],f=o.data.length,h=0,m=(0,l.readByte)()(o);m!==g&&m;m=(0,l.readByte)()(o)){if(o.pos+m>=f){var x=f-o.pos;v.push((0,l.readBytes)(x)(o)),h+=x;break}v.push((0,l.readBytes)(m)(o)),h+=m}for(var y=new Uint8Array(h),I=0,_=0;_<v.length;_++)y.set(v[_],I),I+=v[_].length;return y}},e=(0,r.conditional)({gce:[{codes:(0,l.readBytes)(2)},{byteSize:(0,l.readByte)()},{extras:(0,l.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,l.readUnsigned)(!0)},{transparentColorIndex:(0,l.readByte)()},{terminator:(0,l.readByte)()}]},function(a){var o=(0,l.peekBytes)(2)(a);return o[0]===33&&o[1]===249}),n=(0,r.conditional)({image:[{code:(0,l.readByte)()},{descriptor:[{left:(0,l.readUnsigned)(!0)},{top:(0,l.readUnsigned)(!0)},{width:(0,l.readUnsigned)(!0)},{height:(0,l.readUnsigned)(!0)},{lct:(0,l.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,r.conditional)({lct:(0,l.readArray)(3,function(a,o,g){return Math.pow(2,g.descriptor.lct.size+1)})},function(a,o,g){return g.descriptor.lct.exists}),{data:[{minCodeSize:(0,l.readByte)()},u]}]},function(a){return(0,l.peekByte)()(a)===44}),c=(0,r.conditional)({text:[{codes:(0,l.readBytes)(2)},{blockSize:(0,l.readByte)()},{preData:function(o,g,v){return(0,l.readBytes)(v.text.blockSize)(o)}},u]},function(a){var o=(0,l.peekBytes)(2)(a);return o[0]===33&&o[1]===1}),w=(0,r.conditional)({application:[{codes:(0,l.readBytes)(2)},{blockSize:(0,l.readByte)()},{id:function(o,g,v){return(0,l.readString)(v.blockSize)(o)}},u]},function(a){var o=(0,l.peekBytes)(2)(a);return o[0]===33&&o[1]===255}),i=(0,r.conditional)({comment:[{codes:(0,l.readBytes)(2)},u]},function(a){var o=(0,l.peekBytes)(2)(a);return o[0]===33&&o[1]===254}),d=[{header:[{signature:(0,l.readString)(3)},{version:(0,l.readString)(3)}]},{lsd:[{width:(0,l.readUnsigned)(!0)},{height:(0,l.readUnsigned)(!0)},{gct:(0,l.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,l.readByte)()},{pixelAspectRatio:(0,l.readByte)()}]},(0,r.conditional)({gct:(0,l.readArray)(3,function(a,o){return Math.pow(2,o.lsd.gct.size+1)})},function(a,o){return o.lsd.gct.exists}),{frames:(0,r.loop)([e,w,i,n,c],function(a){var o=(0,l.peekByte)()(a);return o===33||o===44})}],s=d;t.default=s})(Xe)),Xe}var xe={},lt;function zt(){if(lt)return xe;lt=1,Object.defineProperty(xe,"__esModule",{value:!0}),xe.deinterlace=void 0;var t=function(l,u){for(var e=new Array(l.length),n=l.length/u,c=function(g,v){var f=l.slice(v*u,(v+1)*u);e.splice.apply(e,[g*u,u].concat(f))},w=[0,4,2,1],i=[8,8,4,2],d=0,s=0;s<4;s++)for(var a=w[s];a<n;a+=i[s])c(a,d),d++;return e};return xe.deinterlace=t,xe}var ye={},ct;function Nt(){if(ct)return ye;ct=1,Object.defineProperty(ye,"__esModule",{value:!0}),ye.lzw=void 0;var t=function(l,u,e){var n=4096,c=-1,w=e,i,d,s,a,o,g,v,k,f,h,B,m,C,S,R,D,x=new Array(e),y=new Array(n),I=new Array(n),_=new Array(n+1);for(m=l,d=1<<m,o=d+1,i=d+2,v=c,a=m+1,s=(1<<a)-1,f=0;f<d;f++)y[f]=0,I[f]=f;var B,k,C,S,D,R;for(B=k=C=S=D=R=0,h=0;h<w;){if(S===0){if(k<a){B+=u[R]<<k,k+=8,R++;continue}if(f=B&s,B>>=a,k-=a,f>i||f==o)break;if(f==d){a=m+1,s=(1<<a)-1,i=d+2,v=c;continue}if(v==c){_[S++]=I[f],v=f,C=f;continue}for(g=f,f==i&&(_[S++]=C,f=v);f>d;)_[S++]=I[f],f=y[f];C=I[f]&255,_[S++]=C,i<n&&(y[i]=v,I[i]=C,i++,(i&s)===0&&i<n&&(a++,s+=i)),v=g}S--,x[D++]=_[S],h++}for(h=D;h<w;h++)x[h]=0;return x};return ye.lzw=t,ye}var dt;function jt(){if(dt)return X;dt=1,Object.defineProperty(X,"__esModule",{value:!0}),X.decompressFrames=X.decompressFrame=X.parseGIF=void 0;var t=n(Yt()),r=yt(),l=It(),u=zt(),e=Nt();function n(s){return s&&s.__esModule?s:{default:s}}var c=function(a){var o=new Uint8Array(a);return(0,r.parse)((0,l.buildStream)(o),t.default)};X.parseGIF=c;var w=function(a){for(var o=a.pixels.length,g=new Uint8ClampedArray(o*4),v=0;v<o;v++){var f=v*4,h=a.pixels[v],m=a.colorTable[h]||[0,0,0];g[f]=m[0],g[f+1]=m[1],g[f+2]=m[2],g[f+3]=h!==a.transparentIndex?255:0}return g},i=function(a,o,g){if(!a.image){console.warn("gif frame does not have associated image.");return}var v=a.image,f=v.descriptor.width*v.descriptor.height,h=(0,e.lzw)(v.data.minCodeSize,v.data.blocks,f);v.descriptor.lct.interlaced&&(h=(0,u.deinterlace)(h,v.descriptor.width));var m={pixels:h,dims:{top:a.image.descriptor.top,left:a.image.descriptor.left,width:a.image.descriptor.width,height:a.image.descriptor.height}};return v.descriptor.lct&&v.descriptor.lct.exists?m.colorTable=v.lct:m.colorTable=o,a.gce&&(m.delay=(a.gce.delay||10)*10,m.disposalType=a.gce.extras.disposal,a.gce.extras.transparentColorGiven&&(m.transparentIndex=a.gce.transparentColorIndex)),g&&(m.patch=w(m)),m};X.decompressFrame=i;var d=function(a,o){return a.frames.filter(function(g){return g.image}).map(function(g){return i(g,a.gct,o)})};return X.decompressFrames=d,X}var ht=jt();const Ht=10*1024*1024,Kt=["image/png","image/jpeg","image/jpg","image/gif","image/webp"],_t=(t,{onInvalid:r}={})=>Kt.includes(t.type)?t.size>Ht?(r?.("„Éï„Ç°„Ç§„É´„Çµ„Ç§„Ç∫„ÅåÂ§ß„Åç„Åô„Åé„Åæ„Åô„ÄÇ10MB‰ª•‰∏ã„ÅÆ„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"),!1):!0:(r?.("ÂØæÂøú„Åó„Å¶„ÅÑ„Å™„ÅÑ„Éï„Ç°„Ç§„É´ÂΩ¢Âºè„Åß„Åô„ÄÇPNG„ÄÅJPEG„ÄÅGIF„ÄÅWebP„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"),!1),ze=t=>t.type==="image/gif",Ne=t=>new Promise((r,l)=>{const u=new FileReader;u.onload=e=>{const n=new Image;n.onload=()=>r(n),n.onerror=()=>l(new Error("ÁîªÂÉè„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")),n.src=e.target.result},u.onerror=()=>l(new Error("„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")),u.readAsDataURL(t)}),Me=(t,r)=>{const l=document.createElement("canvas"),u=l.getContext("2d",{willReadFrequently:!0});return l.width=r.width,l.height=r.height,u.drawImage(r,0,0),{id:Date.now().toString()+Math.random().toString(36).substring(2,11),file:t,image:r,canvas:l,metadata:{width:r.width,height:r.height,type:t.type}}},Vt=async(t,{fullFrame:r=!0}={})=>{const l=await t.arrayBuffer();return r?Jt(l):Qt(l)},Zt=async(t,r,l,u=null)=>{const e=document.createElement("canvas");e.width=r,e.height=l;const n=e.getContext("2d");u!==null?(n.fillStyle=u,n.fillRect(0,0,r,l)):n.clearRect(0,0,r,l);const c=[];let w=null;for(let i=0;i<t.length;i++){const d=t[i];d.disposalType===3&&(w=n.getImageData(0,0,r,l));const s=d.dims.width,a=d.dims.height;if(s>0&&a>0){const g=new ImageData(new Uint8ClampedArray(d.patch),s,a);if(window.createImageBitmap){const v=await createImageBitmap(g);n.drawImage(v,d.dims.left,d.dims.top),v.close?.()}else{const v=document.createElement("canvas");v.width=s,v.height=a,v.getContext("2d").putImageData(g,0,0),n.drawImage(v,d.dims.left,d.dims.top)}}const o=await new Promise((g,v)=>{const f=new Image;f.onload=()=>g(f),f.onerror=v,f.src=e.toDataURL("image/png")});switch(c.push({image:o,delay:d.delay??100,disposal:d.disposalType??d.disposal}),d.disposalType){case 2:u!==null?(n.fillStyle=u,n.fillRect(d.dims.left,d.dims.top,d.dims.width,d.dims.height)):n.clearRect(d.dims.left,d.dims.top,d.dims.width,d.dims.height);break;case 3:w?n.putImageData(w,0,0):n.clearRect(d.dims.left,d.dims.top,d.dims.width,d.dims.height);break}}return c},Jt=async t=>{const r=ht.parseGIF(t),l=ht.decompressFrames(r,!0);return(await Zt(l,r.lsd.width,r.lsd.height,null)).map(e=>({image:e.image,delay:e.delay,disposal:e.disposal}))},Qt=async t=>{try{const r=new Uint8Array(t),l=new Wt.GifReader(r),u=[],e=document.createElement("canvas"),n=e.getContext("2d");e.width=l.width,e.height=l.height;for(let c=0;c<l.numFrames();c++){const w=l.frameInfo(c),i=n.createImageData(e.width,e.height);l.decodeAndBlitFrameRGBA(c,i.data),n.putImageData(i,0,0);const d=new Image;await new Promise((s,a)=>{d.onload=s,d.onerror=a,d.src=e.toDataURL("image/png")}),u.push({image:d,delay:w.delay*10,disposal:w.disposal})}return u}catch(r){return console.error("GIFËß£Êûê„Ç®„É©„Éº:",r),en(t)}},en=async t=>{const r=new Blob([t],{type:"image/gif"}),l=URL.createObjectURL(r);try{const u=new Image;await new Promise((w,i)=>{u.onload=w,u.onerror=i,u.src=l});const e=document.createElement("canvas"),n=e.getContext("2d");e.width=u.width,e.height=u.height,n.drawImage(u,0,0);const c=new Image;return await new Promise((w,i)=>{c.onload=w,c.onerror=i,c.src=e.toDataURL("image/png")}),[{image:c,delay:500,disposal:0}]}catch(u){throw console.error("„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØGIFÂá¶ÁêÜ„Ç®„É©„Éº:",u),u}finally{URL.revokeObjectURL(l)}};let E,je,H,K,_e,He,et,tt;const tn=()=>{const t=N();E=t.previewCanvas,je=t.previewPlaceholder,H=t.boundingBox,K=t.cropBox,_e=t.cropModeToggle,He=t.cropControls,et=t.exportPngButton,tt=t.exportGifButton};let Fe=null,Re=0,Y=!1,ue=!1,Ie=null;const Ke=t=>{ue=t},ge=(t,r,l,u,e=null)=>{const n=t.metadata.width*r,c=t.metadata.height*r,w=l.x+(u.metadata.width-n)/2,i=l.y+(u.metadata.height-c)/2;if(e){const d=w-e.x,s=i-e.y;return{x:d,y:s,width:n,height:c,baseX:w,baseY:i,cropOffsetX:e.x,cropOffsetY:e.y}}return{x:w,y:i,width:n,height:c}},kt=()=>{if(!p.backgroundImage)return;const t=p.backgroundImage,r=E.getContext("2d",{willReadFrequently:!0});if(r.clearRect(0,0,E.width,E.height),r.drawImage(t.image,0,0),p.transparentImages.length>0){const l=p.transparentImages[0],u=p.transformState.scale,e=p.transformState.position,n=l.metadata.width*u,c=l.metadata.height*u,w=e.x+(t.metadata.width-n)/2,i=e.y+(t.metadata.height-c)/2;console.log("„Éà„É™„Éü„É≥„Ç∞„É¢„Éº„ÉâÊèèÁîª:",{posX:e.x,posY:e.y,bgWidth:t.metadata.width,bgHeight:t.metadata.height,scaledWidth:n,scaledHeight:c,absoluteX:w,absoluteY:i,cropArea:p.transformState.cropArea}),r.imageSmoothingEnabled=!1,r.drawImage(l.image,w,i,n,c)}},St=()=>{const t=!!p.backgroundImage;p.transparentImages.length>0,et.disabled=!t,tt.disabled=!(t&&p.transparentImages.length>1)},z=()=>{if(!p.backgroundImage){E.style.display="none",je.style.display="flex",et.disabled=!0,tt.disabled=!0;return}const t=p.backgroundImage,r=E.getContext("2d",{willReadFrequently:!0}),l=p.transformState.cropArea;if(Y){E.width=t.metadata.width,E.height=t.metadata.height,kt();return}if(l?(E.width=l.width,E.height=l.height):(E.width=t.metadata.width,E.height=t.metadata.height),Fe&&(clearInterval(Fe),Fe=null),p.transparentImages.length>1){Re=0;const u=()=>{r.clearRect(0,0,E.width,E.height),Y?r.drawImage(t.image,0,0):l?r.drawImage(t.image,l.x,l.y,l.width,l.height,0,0,E.width,E.height):r.drawImage(t.image,0,0);const e=p.transparentImages[Re];if(e){const n=p.transformState.scale,c=p.transformState.position,w=ge(e,n,c,t,l);r.imageSmoothingEnabled=!1,r.drawImage(e.image,w.x,w.y,w.width,w.height)}Re=(Re+1)%p.transparentImages.length};u(),Fe=setInterval(u,p.animationSettings.frameDelay)}else if(p.transparentImages.length===1){r.clearRect(0,0,E.width,E.height),l?r.drawImage(t.image,l.x,l.y,l.width,l.height,0,0,E.width,E.height):r.drawImage(t.image,0,0);const u=p.transparentImages[0],e=p.transformState.scale,n=p.transformState.position,c=ge(u,e,n,t,l);r.imageSmoothingEnabled=!1,r.drawImage(u.image,c.x,c.y,c.width,c.height)}else r.clearRect(0,0,E.width,E.height),l?r.drawImage(t.image,l.x,l.y,l.width,l.height,0,0,E.width,E.height):r.drawImage(t.image,0,0);E.style.display="block",je.style.display="none",St(),Y?setTimeout(()=>fe(),100):p.transparentImages.length>0&&setTimeout(()=>V(),100)},Et=(t=1e3)=>{Ie&&(clearTimeout(Ie),Ie=null),ue=!0,V(),Ie=setTimeout(()=>{ue=!1,V(),Ie=null},t)},V=()=>{if(!p.backgroundImage||p.transparentImages.length===0||Y||!ue){H.style.display="none";return}const t=p.backgroundImage,r=p.transparentImages[0],l=p.transformState.scale,u=p.transformState.position,e=p.transformState.cropArea,n=E.getBoundingClientRect(),c=ge(r,l,u,t,e),w=(()=>{if(e){const h=n.width/e.width,m=n.height/e.height;return Math.min(h,m)}const v=n.width/t.metadata.width,f=n.height/t.metadata.height;return Math.min(v,f)})(),i=e?(n.width-e.width*w)/2:(n.width-t.metadata.width*w)/2,d=e?(n.height-e.height*w)/2:(n.height-t.metadata.height*w)/2,s=c.x*w+i,a=c.y*w+d,o=c.width*w,g=c.height*w;H.style.display="block",H.style.left=s+"px",H.style.top=a+"px",H.style.width=o+"px",H.style.height=g+"px"},nn=t=>{switch(t){case"1:1":return 1;case"16:9":return 16/9;case"4:3":return 4/3;case"free":return null;case"original":default:return p.backgroundImage?p.backgroundImage.metadata.width/p.backgroundImage.metadata.height:1}},fe=()=>{if(!p.backgroundImage||!Y){K.style.display="none";return}const t=p.backgroundImage,r=E.getBoundingClientRect(),l=r.width/t.metadata.width,u=r.height/t.metadata.height,e=Math.min(l,u);let n=p.transformState.cropArea;if(!n){if(p.transformState.aspectRatio==="original"||p.transformState.aspectRatio==="free")n={x:0,y:0,width:t.metadata.width,height:t.metadata.height};else{const o=nn(p.transformState.aspectRatio),g=t.metadata.width/t.metadata.height;let v,f;o>g?(v=t.metadata.width,f=v/o):(f=t.metadata.height,v=f*o),n={x:(t.metadata.width-v)/2,y:(t.metadata.height-f)/2,width:v,height:f}}p.transformState.cropArea=n}const c=n.x*e,w=n.y*e,i=n.width*e,d=n.height*e,s=(r.width-t.metadata.width*e)/2,a=(r.height-t.metadata.height*e)/2;K.style.display="block",K.style.left=c+s+"px",K.style.top=w+a+"px",K.style.width=i+"px",K.style.height=d+"px"},Bt=()=>{if(Y=!Y,Y){_e.textContent="‚úèÔ∏è Á∑®ÈõÜ„É¢„Éº„Éâ",_e.classList.add("active"),He.style.display="block",H.style.display="none",ue=!1;const t=p.backgroundImage;t&&(E.width=t.metadata.width,E.height=t.metadata.height,kt()),fe()}else _e.textContent="üìê „Éà„É™„Éü„É≥„Ç∞„É¢„Éº„Éâ",_e.classList.remove("active"),He.style.display="none",K.style.display="none",ue=!1,V(),z()},se=()=>Y;let nt,rt,bt,Ct,Ve,Ze,Je,Ft,M,ke;const he=500,rn=()=>p.transparentImages.length===0?null:p.transparentImages.some(r=>r.frameInfo?.isFromGif)?"gif":p.transparentImages.length>1?"sequence":null,an=t=>t.some(r=>ze(r))?"gif":t.length>1?"sequence":null,on=t=>{let r=t.querySelector(".upload-area__hint");if(!r){r=document.createElement("small"),r.className="upload-area__hint";const l=t.querySelector(".upload-area__button");l?t.insertBefore(r,l):t.appendChild(r)}return r},Rt=(t,{icon:r,text:l,subtext:u,hint:e})=>{const n=t.querySelector(".upload-area__icon");n&&r&&(n.textContent=r);const c=t.querySelector(".upload-area__text");c&&(c.textContent=l);const w=t.querySelector(".upload-area__subtext");w&&(w.textContent=u);{const i=on(t);i.textContent=e}},sn=()=>{const t=N();nt=t.backgroundDropzone,rt=t.transparentDropzone,bt=t.backgroundButton,Ct=t.transparentButton,Ve=t.backgroundInput,Ze=t.transparentInput,Je=t.scaleInput,Ft=t.aspectRatioSelect,M=t.animationSpeedInput,ke=t.animationSpeedValue},ln=()=>{const t=(r,l)=>{r.addEventListener("dragover",u=>{u.preventDefault(),r.classList.add("upload-area__dropzone--dragover")}),r.addEventListener("dragleave",()=>{r.classList.remove("upload-area__dropzone--dragover")}),r.addEventListener("drop",u=>{u.preventDefault(),r.classList.remove("upload-area__dropzone--dragover");const e=u.dataTransfer?.files;e&&e.length>0&&l(e)})};t(nt,r=>Dt(r[0])),t(rt,Lt)},cn=()=>{bt.addEventListener("click",()=>{Ve.click()}),Ct.addEventListener("click",()=>{Ze.click()}),Ve.addEventListener("change",t=>{const r=t.target.files;r&&r.length>0&&Dt(r[0]),t.target.value=""}),Ze.addEventListener("change",t=>{const r=t.target.files;r&&r.length>0&&Lt(r),t.target.value=""})},Dt=async t=>{if(_t(t,{onInvalid:A}))try{console.log("ËÉåÊôØÁîªÂÉèË™≠„ÅøËæº„ÅøÈñãÂßã:",t.name);const r=await Ne(t),l=Me(t,r);p.backgroundImage=l,p.transformState.cropArea=null,p.transformState.aspectRatio="original",Ft.value="original",se()&&Bt(),Rt(nt,{icon:"‚úÖ",text:`ËÉåÊôØÁîªÂÉè: ${t.name}`,subtext:`${r.width} √ó ${r.height}px`,hint:"„Äå„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Äç„Åã„ÇâÂ§âÊõ¥„Åß„Åç„Åæ„Åô"}),z(),console.log("ËÉåÊôØÁîªÂÉèË™≠„ÅøËæº„ÅøÂÆå‰∫Ü")}catch(r){console.error("ËÉåÊôØÁîªÂÉèË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",r),A("ËÉåÊôØÁîªÂÉè„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: "+r.message)}},Lt=async t=>{const r=Array.from(t).filter(l=>_t(l,{onInvalid:A}));if(r.length!==0)try{console.log("ÈÄèÈÅéÁîªÂÉèË™≠„ÅøËæº„ÅøÈñãÂßã:",r.map(s=>s.name));const l=p.transparentImages.length>0,u=rn(),e=an(r);p.transparentImages=[],l||(p.transformState.position={x:0,y:0}),l&&u==="sequence"&&e==="sequence"?Je.value=p.transformState.scale:(p.transformState.scale=1,Je.value=1);for(const s of r)if(ze(s)){console.log("GIF„Éï„Ç°„Ç§„É´„ÇíÂá¶ÁêÜ‰∏≠:",s.name);try{const a=await Vt(s,{fullFrame:!0}),o=a.map(h=>h.delay),g=o.reduce((h,m)=>h+m,0)/o.length,v=Math.min(...o),f=Math.max(...o);if(g>0){const h=Math.round(g),m=parseInt(M.min,10),x=parseInt(M.max,10),y=Math.min(m,Math.max(10,Math.round(v))),I=Math.max(x,Math.round(f));M.min=y,M.max=I,M.step=h<100?10:50,p.animationSettings.frameDelay=h,M.value=h,ke.textContent=`${h}ms`,console.log(`GIF„ÅÆÂÖÉ„Éï„É¨„Éº„É†ÈñìÈöî„ÇíÈÅ©Áî®: ${h}ms (ÁØÑÂõ≤: ${y}-${I}ms)`),console.log("„Éï„É¨„Éº„É†ÈñìÈöî„ÅÆË©≥Á¥∞:",o)}else M.min=50,M.max=2e3,M.step=50,p.animationSettings.frameDelay=he,M.value=he,ke.textContent=`${he}ms`,console.log("GIF„ÅÆ„Éá„Ç£„É¨„Ç§ÊÉÖÂ†±„ÅåÊ¨†ËêΩ„Åó„Å¶„ÅÑ„Åü„Åü„ÇÅ„ÄÅ„Éá„Éï„Ç©„É´„Éà500ms„ÇíÈÅ©Áî®");for(let h=0;h<a.length;h++){const m=a[h],x=new File([s],`${s.name}_frame_${h+1}`,{type:"image/png"}),y=Me(x,m.image);y.frameInfo={delay:m.delay,disposal:m.disposal,isFromGif:!0,originalIndex:h},p.transparentImages.push(y)}console.log(`GIF„Åã„Çâ ${a.length} „Éï„É¨„Éº„É†„ÇíÊäΩÂá∫„Åó„Åæ„Åó„Åü`)}catch(a){console.error("GIFÂá¶ÁêÜ„Ç®„É©„Éº:",a),A(`GIF„Éï„Ç°„Ç§„É´ ${s.name} „ÅÆÂá¶ÁêÜ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ${a.message}`);const o=await Ne(s),g=Me(s,o);p.transparentImages.push(g)}}else{const a=await Ne(s),o=Me(s,a);p.transparentImages.push(o)}const c=p.transparentImages.some(s=>s.frameInfo?.isFromGif);if(e==="sequence"&&!c)if(M.min=50,M.max=2e3,M.step=50,u==="sequence"&&e==="sequence"){const a=p.animationSettings.frameDelay;M.value=a,ke.textContent=`${a}ms`,console.log("ÈÄ£Áï™PNG„Å©„ÅÜ„Åó„ÅÆÂ∑Æ„ÅóÊõø„Åà: ÂÜçÁîüÈÄüÂ∫¶„ÇíÁ∂≠ÊåÅ")}else p.animationSettings.frameDelay=he,M.value=he,ke.textContent=`${he}ms`,console.log("ÈÄ£Áï™PNG„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Çí„Éá„Éï„Ç©„É´„Éà500ms„Å´Ë®≠ÂÆö");const w=p.transparentImages.length,i=r.some(s=>ze(s));let d="";i?d=`GIFÂê´„ÇÄ ${r.length}„Éï„Ç°„Ç§„É´ ‚Üí ${w}„Éï„É¨„Éº„É†`:d=r.map(s=>s.name).join(", "),Rt(rt,{icon:"‚ú®",text:`ÈÄèÈÅéÁîªÂÉè: ${d}`,subtext:`Á∑è„Éï„É¨„Éº„É†Êï∞: ${w}`,hint:"„Äå„Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû„Äç„Åã„ÇâÂ§âÊõ¥„Åß„Åç„Åæ„Åô"}),z(),St(),!se()&&p.transparentImages.length>0&&(Ke(!0),V()),console.log("ÈÄèÈÅéÁîªÂÉèË™≠„ÅøËæº„ÅøÂÆå‰∫Ü")}catch(l){console.error("ÈÄèÈÅéÁîªÂÉèË™≠„ÅøËæº„Åø„Ç®„É©„Éº:",l),A("ÈÄèÈÅéÁîªÂÉè„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: "+l.message)}},dn=()=>{sn(),ln(),cn()};let Mt,At,Gt,Pt,Tt;const hn=()=>{const t=N();Mt=t.scaleInput,At=t.cropModeToggle,Gt=t.animationSpeedInput,Pt=t.animationSpeedValue,Tt=t.aspectRatioSelect},un=()=>{if(!p.backgroundImage||p.transparentImages.length===0)return;const t=p.transparentImages[0],r=p.transformState.scale,l=t.metadata.width*r,u=t.metadata.height*r;(l>p.outputSettings.maxWidth||u>p.outputSettings.maxHeight)&&A(`Êã°Â§ßÂæå„ÅÆ„Çµ„Ç§„Ç∫Ôºà${l}√ó${u}pxÔºâ„ÅåÂá∫Âäõ„Çµ„Ç§„Ç∫Âà∂ÈôêÔºà${p.outputSettings.maxWidth}√ó${p.outputSettings.maxHeight}pxÔºâ„ÇíË∂Ö„Åà„Å¶„ÅÑ„Åæ„Åô„ÄÇ`)},gn=()=>{hn(),Mt.addEventListener("input",t=>{const r=parseInt(t.target.value,10);p.transformState.scale=r,console.log("Êã°Â§ßÂÄçÁéáÂ§âÊõ¥:",r),z(),un(),!se()&&p.transparentImages.length>0&&Et(1e3)}),At.addEventListener("click",()=>{Bt()}),Gt.addEventListener("input",t=>{const r=parseInt(t.target.value,10);p.animationSettings.frameDelay=r,Pt.textContent=`${r}ms`,console.log("„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÈÄüÂ∫¶Â§âÊõ¥:",r+"ms"),p.transparentImages.length>1&&z()}),Tt.addEventListener("change",t=>{const r=t.target.value;p.transformState.aspectRatio=r,console.log("„Ç¢„Çπ„Éö„ÇØ„ÉàÊØîÂ§âÊõ¥:",r),se()?(p.transformState.cropArea=null,fe()):z()})};let le,Qe,ie,Se=!1,Ee=!1,me=0,pe=0,Ge=null,Ae=0,Be=!1,be=!1,Pe=null;const Ut=()=>{const t=N();le=t.previewCanvas,Qe=t.boundingBox,ie=t.cropBox},ut=t=>{t.target.classList.contains("bounding-box__handle")?(Ee=!0,Ge=t.target):Se=!0,me=t.clientX,pe=t.clientY,t.preventDefault(),t.stopPropagation()},gt=t=>{if(!Se&&!Ee)return;const r=t.clientX-me,l=t.clientY-pe;if(Se){const u=p.backgroundImage,e=p.transformState.cropArea,n=le.getBoundingClientRect();let c;if(e){const d=n.width/e.width,s=n.height/e.height;c=Math.min(d,s)}else{const d=n.width/u.metadata.width,s=n.height/u.metadata.height;c=Math.min(d,s)}const w=r/c,i=l/c;p.transformState.position.x+=w,p.transformState.position.y+=i,z()}else if(Ee&&Ge){const u=p.backgroundImage,e=le.getBoundingClientRect();e.width/u.metadata.width,e.height/u.metadata.height;const n=Ge.className;let c=0;n.includes("--nw")||n.includes("--sw")?c=-r:(n.includes("--ne")||n.includes("--se"))&&(c=r),Ae+=c*.1;const i=p.transformState.scale,d=Math.max(1,Math.round(i+Ae));if(d!==p.transformState.scale){p.transformState.scale=d;const{scaleInput:s}=N();s.value=d,z(),Ae=0}}me=t.clientX,pe=t.clientY},ft=()=>{Se=!1,Ee=!1,Ge=null,Ae=0},fn=()=>{Ut(),Qe.addEventListener("mousedown",ut),document.addEventListener("mousemove",gt),document.addEventListener("mouseup",ft),Qe.addEventListener("touchstart",t=>{const r=t.touches[0],l=new MouseEvent("mousedown",{clientX:r.clientX,clientY:r.clientY});ut(l),t.preventDefault()}),document.addEventListener("touchmove",t=>{if(Se||Ee){const r=t.touches[0],l=new MouseEvent("mousemove",{clientX:r.clientX,clientY:r.clientY});gt(l),t.preventDefault()}}),document.addEventListener("touchend",ft)},mt=t=>{t.target.classList.contains("crop-box__handle")?(be=!0,Pe=t.target,parseInt(ie.style.left,10),parseInt(ie.style.top,10),parseInt(ie.style.width,10),parseInt(ie.style.height,10)):Be=!0,me=t.clientX,pe=t.clientY,t.preventDefault(),t.stopPropagation()},pt=t=>{if(!Be&&!be)return;const r=t.clientX-me,l=t.clientY-pe;if(Be){const u=p.backgroundImage,e=le.getBoundingClientRect(),n=e.width/u.metadata.width,c=e.height/u.metadata.height,w=Math.min(n,c),i=r/w,d=l/w,s=p.transformState.cropArea;if(!s)return;const a=Math.max(0,Math.min(u.metadata.width-s.width,s.x+i)),o=Math.max(0,Math.min(u.metadata.height-s.height,s.y+d));p.transformState.cropArea.x=a,p.transformState.cropArea.y=o,fe()}else if(be&&Pe){const u=p.backgroundImage,e=p.transformState.cropArea,n=le.getBoundingClientRect();if(!e)return;const c=n.width/u.metadata.width,w=n.height/u.metadata.height,i=Math.min(c,w),d=r/i,s=l/i,a=Pe.className;a.includes("--nw")?(e.x=Math.max(0,e.x+d),e.y=Math.max(0,e.y+s),e.width=Math.max(50,e.width-d),e.height=Math.max(50,e.height-s)):a.includes("--ne")?(e.y=Math.max(0,e.y+s),e.width=Math.max(50,e.width+d),e.height=Math.max(50,e.height-s)):a.includes("--sw")?(e.x=Math.max(0,e.x+d),e.width=Math.max(50,e.width-d),e.height=Math.max(50,e.height+s)):a.includes("--se")?(e.width=Math.max(50,e.width+d),e.height=Math.max(50,e.height+s)):a.includes("--n")?(e.y=Math.max(0,e.y+s),e.height=Math.max(50,e.height-s)):a.includes("--s")?e.height=Math.max(50,e.height+s):a.includes("--w")?(e.x=Math.max(0,e.x+d),e.width=Math.max(50,e.width-d)):a.includes("--e")&&(e.width=Math.max(50,e.width+d)),fe()}me=t.clientX,pe=t.clientY},vt=()=>{Be=!1,be=!1,Pe=null},mn=()=>{ie.addEventListener("mousedown",mt),document.addEventListener("mousemove",pt),document.addEventListener("mouseup",vt),ie.addEventListener("touchstart",t=>{const r=t.touches[0],l=new MouseEvent("mousedown",{clientX:r.clientX,clientY:r.clientY});mt(l),t.preventDefault()}),document.addEventListener("touchmove",t=>{if(Be||be){const r=t.touches[0],l=new MouseEvent("mousemove",{clientX:r.clientX,clientY:r.clientY});pt(l),t.preventDefault()}}),document.addEventListener("touchend",vt)},pn=()=>{le.addEventListener("click",t=>{if(se()||p.transparentImages.length===0)return;const r=p.transparentImages[0],l=p.backgroundImage,u=p.transformState.scale,e=p.transformState.position,n=p.transformState.cropArea,c=le.getBoundingClientRect(),w=t.clientX-c.left,i=t.clientY-c.top,d=ge(r,u,e,l,n),s=c.width/(n?n.width:l.metadata.width),a=c.height/(n?n.height:l.metadata.height),o=Math.min(s,a),g=n?(c.width-n.width*o)/2:(c.width-l.metadata.width*o)/2,v=n?(c.height-n.height*o)/2:(c.height-l.metadata.height*o)/2,f=d.x*o+g,h=d.y*o+v,m=d.width*o,x=d.height*o;w>=f&&w<=f+m&&i>=h&&i<=h+x?(Ke(!0),V()):(Ke(!1),V())})},vn=()=>{let t=null;const r=()=>{p.backgroundImage&&(z(),V(),se()&&fe(),se()||Et(2e3))};window.addEventListener("resize",()=>{t&&clearTimeout(t),t=setTimeout(()=>{r()},150)}),window.addEventListener("orientationchange",()=>{setTimeout(r,300)})},wn=()=>{Ut(),fn(),mn(),pn(),vn()};function De(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var We={exports:{}},wt;function xn(){return wt||(wt=1,(function(t,r){(function(l){t.exports=l()})(function(){return(function l(u,e,n){function c(d,s){if(!e[d]){if(!u[d]){var a=typeof De=="function"&&De;if(!s&&a)return a(d,!0);if(w)return w(d,!0);var o=new Error("Cannot find module '"+d+"'");throw o.code="MODULE_NOT_FOUND",o}var g=e[d]={exports:{}};u[d][0].call(g.exports,function(v){var f=u[d][1][v];return c(f||v)},g,g.exports,l,u,e,n)}return e[d].exports}for(var w=typeof De=="function"&&De,i=0;i<n.length;i++)c(n[i]);return c})({1:[function(l,u,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}u.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(s){if(!w(s)||s<0||isNaN(s))throw TypeError("n must be a positive number");return this._maxListeners=s,this},n.prototype.emit=function(s){var a,o,g,v,f,h;if(this._events||(this._events={}),s==="error"&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if(a=arguments[1],a instanceof Error)throw a;var m=new Error('Uncaught, unspecified "error" event. ('+a+")");throw m.context=a,m}if(o=this._events[s],d(o))return!1;if(c(o))switch(arguments.length){case 1:o.call(this);break;case 2:o.call(this,arguments[1]);break;case 3:o.call(this,arguments[1],arguments[2]);break;default:v=Array.prototype.slice.call(arguments,1),o.apply(this,v)}else if(i(o))for(v=Array.prototype.slice.call(arguments,1),h=o.slice(),g=h.length,f=0;f<g;f++)h[f].apply(this,v);return!0},n.prototype.addListener=function(s,a){var o;if(!c(a))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",s,c(a.listener)?a.listener:a),this._events[s]?i(this._events[s])?this._events[s].push(a):this._events[s]=[this._events[s],a]:this._events[s]=a,i(this._events[s])&&!this._events[s].warned&&(d(this._maxListeners)?o=n.defaultMaxListeners:o=this._maxListeners,o&&o>0&&this._events[s].length>o&&(this._events[s].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[s].length),typeof console.trace=="function"&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(s,a){if(!c(a))throw TypeError("listener must be a function");var o=!1;function g(){this.removeListener(s,g),o||(o=!0,a.apply(this,arguments))}return g.listener=a,this.on(s,g),this},n.prototype.removeListener=function(s,a){var o,g,v,f;if(!c(a))throw TypeError("listener must be a function");if(!this._events||!this._events[s])return this;if(o=this._events[s],v=o.length,g=-1,o===a||c(o.listener)&&o.listener===a)delete this._events[s],this._events.removeListener&&this.emit("removeListener",s,a);else if(i(o)){for(f=v;f-- >0;)if(o[f]===a||o[f].listener&&o[f].listener===a){g=f;break}if(g<0)return this;o.length===1?(o.length=0,delete this._events[s]):o.splice(g,1),this._events.removeListener&&this.emit("removeListener",s,a)}return this},n.prototype.removeAllListeners=function(s){var a,o;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[s]&&delete this._events[s],this;if(arguments.length===0){for(a in this._events)a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events={},this}if(o=this._events[s],c(o))this.removeListener(s,o);else if(o)for(;o.length;)this.removeListener(s,o[o.length-1]);return delete this._events[s],this},n.prototype.listeners=function(s){var a;return!this._events||!this._events[s]?a=[]:c(this._events[s])?a=[this._events[s]]:a=this._events[s].slice(),a},n.prototype.listenerCount=function(s){if(this._events){var a=this._events[s];if(c(a))return 1;if(a)return a.length}return 0},n.listenerCount=function(s,a){return s.listenerCount(a)};function c(s){return typeof s=="function"}function w(s){return typeof s=="number"}function i(s){return typeof s=="object"&&s!==null}function d(s){return s===void 0}},{}],2:[function(l,u,e){var n,c,w,i,d;d=navigator.userAgent.toLowerCase(),i=navigator.platform.toLowerCase(),n=d.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],w=n[1]==="ie"&&document.documentMode,c={name:n[1]==="version"?n[3]:n[1],version:w||parseFloat(n[1]==="opera"&&n[4]?n[4]:n[2]),platform:{name:d.match(/ip(?:ad|od|hone)/)?"ios":(d.match(/(?:webos|android)/)||i.match(/mac|win|linux/)||["other"])[0]}},c[c.name]=!0,c[c.name+parseInt(c.version,10)]=!0,c.platform[c.platform.name]=!0,u.exports=c},{}],3:[function(l,u,e){var n,c,w,i=function(o,g){for(var v in g)d.call(g,v)&&(o[v]=g[v]);function f(){this.constructor=o}return f.prototype=g.prototype,o.prototype=new f,o.__super__=g.prototype,o},d={}.hasOwnProperty,s=[].indexOf||function(o){for(var g=0,v=this.length;g<v;g++)if(g in this&&this[g]===o)return g;return-1},a=[].slice;n=l("events").EventEmitter,w=l("./browser.coffee"),c=(function(o){var g,v;i(f,o),g={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},v={delay:500,copy:!1};function f(h){var m,x,y;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(h);for(x in g)y=g[x],(m=this.options)[x]==null&&(m[x]=y)}return f.prototype.setOption=function(h,m){if(this.options[h]=m,this._canvas!=null&&(h==="width"||h==="height"))return this._canvas[h]=m},f.prototype.setOptions=function(h){var m,x,y;x=[];for(m in h)d.call(h,m)&&(y=h[m],x.push(this.setOption(m,y)));return x},f.prototype.addFrame=function(h,m){var x,y;m==null&&(m={}),x={},x.transparent=this.options.transparent;for(y in v)x[y]=m[y]||v[y];if(this.options.width==null&&this.setOption("width",h.width),this.options.height==null&&this.setOption("height",h.height),typeof ImageData<"u"&&ImageData!==null&&h instanceof ImageData)x.data=h.data;else if(typeof CanvasRenderingContext2D<"u"&&CanvasRenderingContext2D!==null&&h instanceof CanvasRenderingContext2D||typeof WebGLRenderingContext<"u"&&WebGLRenderingContext!==null&&h instanceof WebGLRenderingContext)m.copy?x.data=this.getContextData(h):x.context=h;else if(h.childNodes!=null)m.copy?x.data=this.getImageData(h):x.image=h;else throw new Error("Invalid image");return this.frames.push(x)},f.prototype.render=function(){var h,m,x;if(this.running)throw new Error("Already running");if(this.options.width==null||this.options.height==null)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=(function(){var y,I,_;for(_=[],y=0,I=this.frames.length;0<=I?y<I:y>I;0<=I?++y:--y)_.push(null);return _}).call(this),m=this.spawnWorkers(),this.options.globalPalette===!0)this.renderNextFrame();else for(h=0,x=m;0<=x?h<x:h>x;0<=x?++h:--h)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},f.prototype.abort=function(){for(var h;h=this.activeWorkers.shift(),h!=null;)this.log("killing active worker"),h.terminate();return this.running=!1,this.emit("abort")},f.prototype.spawnWorkers=function(){var h,m,x;return h=Math.min(this.options.workers,this.frames.length),(function(){x=[];for(var y=m=this.freeWorkers.length;m<=h?y<h:y>h;m<=h?y++:y--)x.push(y);return x}).apply(this).forEach((function(y){return function(I){var _;return y.log("spawning worker "+I),_=new Worker(y.options.workerScript),_.onmessage=function(B){return y.activeWorkers.splice(y.activeWorkers.indexOf(_),1),y.freeWorkers.push(_),y.frameFinished(B.data)},y.freeWorkers.push(_)}})(this)),h},f.prototype.frameFinished=function(h){var m,x;if(this.log("frame "+h.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[h.index]=h,this.options.globalPalette===!0&&(this.options.globalPalette=h.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(m=1,x=this.freeWorkers.length;1<=x?m<x:m>x;1<=x?++m:--m)this.renderNextFrame();return s.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},f.prototype.finishRendering=function(){var h,m,x,y,I,_,B,k,C,S,D,R,j,P,U,T;for(k=0,P=this.imageParts,I=0,C=P.length;I<C;I++)m=P[I],k+=(m.data.length-1)*m.pageSize+m.cursor;for(k+=m.pageSize-m.cursor,this.log("rendering finished - filesize "+Math.round(k/1e3)+"kb"),h=new Uint8Array(k),R=0,U=this.imageParts,_=0,S=U.length;_<S;_++)for(m=U[_],T=m.data,x=B=0,D=T.length;B<D;x=++B)j=T[x],h.set(j,R),x===m.data.length-1?R+=m.cursor:R+=m.pageSize;return y=new Blob([h],{type:"image/gif"}),this.emit("finished",y,h)},f.prototype.renderNextFrame=function(){var h,m,x;if(this.freeWorkers.length===0)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return h=this.frames[this.nextFrame++],x=this.freeWorkers.shift(),m=this.getTask(h),this.log("starting frame "+(m.index+1)+" of "+this.frames.length),this.activeWorkers.push(x),x.postMessage(m)},f.prototype.getContextData=function(h){return h.getImageData(0,0,this.options.width,this.options.height).data},f.prototype.getImageData=function(h){var m;return this._canvas==null&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),m=this._canvas.getContext("2d"),m.setFill=this.options.background,m.fillRect(0,0,this.options.width,this.options.height),m.drawImage(h,0,0),this.getContextData(m)},f.prototype.getTask=function(h){var m,x;if(m=this.frames.indexOf(h),x={index:m,last:m===this.frames.length-1,delay:h.delay,transparent:h.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:w.name==="chrome"},h.data!=null)x.data=h.data;else if(h.context!=null)x.data=this.getContextData(h.context);else if(h.image!=null)x.data=this.getImageData(h.image);else throw new Error("Invalid frame");return x},f.prototype.log=function(){var h;if(h=1<=arguments.length?a.call(arguments,0):[],!!this.options.debug)return console.log.apply(console,h)},f})(n),u.exports=c},{"./browser.coffee":2,events:1}]},{},[3])(3)})})(We)),We.exports}var yn=xn();const In=qt(yn),_n=()=>{if(!p.backgroundImage||p.transparentImages.length===0){A("ËÉåÊôØÁîªÂÉè„Å®ÈÄèÈÅéÁîªÂÉè„ÅÆ‰∏°Êñπ„ÅåÂøÖË¶Å„Åß„Åô");return}try{const t=document.createElement("canvas"),r=t.getContext("2d",{willReadFrequently:!0}),l=p.backgroundImage,u=p.transparentImages[0],e=p.transformState.scale,n=p.transformState.position,c=p.transformState.cropArea;c?(t.width=c.width,t.height=c.height):(t.width=l.metadata.width,t.height=l.metadata.height),c?r.drawImage(l.image,c.x,c.y,c.width,c.height,0,0,t.width,t.height):r.drawImage(l.image,0,0);const w=ge(u,e,n,l,c);r.imageSmoothingEnabled=!1,r.drawImage(u.image,w.x,w.y,w.width,w.height),t.toBlob(i=>{if(i){const d=URL.createObjectURL(i),s=document.createElement("a");s.href=d,s.download=`x-post-image-${Date.now()}.png`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(d),console.log("PNG „Ç®„ÇØ„Çπ„Éù„Éº„ÉàÂÆå‰∫Ü"),Le("PNGÁîªÂÉè„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åó„Åü")}else throw new Error("PNGÁîüÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")},"image/png")}catch(t){console.error("PNG „Ç®„ÇØ„Çπ„Éù„Éº„Éà„Ç®„É©„Éº:",t),A("PNG „Ç®„ÇØ„Çπ„Éù„Éº„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: "+t.message)}},kn=()=>{if(!p.backgroundImage||p.transparentImages.length===0){A("ËÉåÊôØÁîªÂÉè„Å®ÈÄèÈÅéÁîªÂÉè„ÅÆ‰∏°Êñπ„ÅåÂøÖË¶Å„Åß„Åô");return}if(p.transparentImages.length===1){A("GIFÁîüÊàê„Å´„ÅØË§áÊï∞„ÅÆÈÄèÈÅéÁîªÂÉè„ÅåÂøÖË¶Å„Åß„Åô„ÄÇÂçò‰∏ÄÁîªÂÉè„ÅÆÂ†¥Âêà„ÅØPNG„Çí„ÅîÂà©Áî®„Åè„Å†„Åï„ÅÑ„ÄÇ");return}try{console.log("GIFÁîüÊàêÈñãÂßã...");const t=p.backgroundImage,r=p.transformState.scale,l=p.transformState.position,u=p.transformState.cropArea;let e,n;u?(e=u.width,n=u.height):(e=t.metadata.width,n=t.metadata.height);const c=new URL("/250811_png-gif-app/assets/gif.worker-CjkyQP34.js",import.meta.url).href,w=new In({workers:2,quality:15,width:e,height:n,repeat:0,workerScript:c}),i=document.createElement("canvas"),d=i.getContext("2d",{willReadFrequently:!0});i.width=e,i.height=n,p.transparentImages.forEach((a,o)=>{try{d.clearRect(0,0,e,n),u?d.drawImage(t.image,u.x,u.y,u.width,u.height,0,0,e,n):d.drawImage(t.image,0,0);const g=ge(a,r,l,t,u);d.imageSmoothingEnabled=!1,d.drawImage(a.image,g.x,g.y,g.width,g.height),w.addFrame(i,{copy:!0,delay:p.animationSettings.frameDelay}),console.log(`„Éï„É¨„Éº„É† ${o+1}/${p.transparentImages.length} ËøΩÂä†ÂÆå‰∫Ü`)}catch(g){throw console.error(`„Éï„É¨„Éº„É† ${o+1} „ÅÆÂá¶ÁêÜ„Åß„Ç®„É©„Éº:`,g),g}}),w.on("finished",a=>{try{const o=URL.createObjectURL(a),g=document.createElement("a");g.href=o,g.download=`x-post-animation-${Date.now()}.gif`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(o),console.log("GIF „Ç®„ÇØ„Çπ„Éù„Éº„ÉàÂÆå‰∫Ü"),Le("GIF„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Åó„Åæ„Åó„Åü")}catch(o){console.error("GIF „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Ç®„É©„Éº:",o),A("GIF „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü")}}),w.on("error",a=>{console.error("GIFÁîüÊàê„Ç®„É©„Éº:",a),A("GIFÁîüÊàê‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: "+a.message)}),w.on("progress",a=>{const o=Math.round(a*100);console.log(`GIFÁîüÊàêÈÄ≤Êçó: ${o}%`),o%25===0&&Le(`GIFÁîüÊàê‰∏≠... ${o}%`)});const s=setTimeout(()=>{console.error("GIFÁîüÊàê„Åå„Çø„Ç§„É†„Ç¢„Ç¶„Éà„Åó„Åæ„Åó„Åü"),A("GIFÁîüÊàê„Å´ÊôÇÈñì„Åå„Åã„Åã„Çä„Åô„Åé„Å¶„ÅÑ„Åæ„Åô„ÄÇÁîªÂÉè„Çµ„Ç§„Ç∫„ÇíÂ∞è„Åï„Åè„Åô„Çã„Åã„ÄÅ„Éï„É¨„Éº„É†Êï∞„ÇíÊ∏õ„Çâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ")},3e4);w.on("finished",()=>{clearTimeout(s)}),w.render(),console.log("GIFÁîüÊàêÂá¶ÁêÜ„ÇíÈñãÂßã„Åó„Åæ„Åó„Åü..."),Le("GIFÁîüÊàê‰∏≠„Åß„Åô„ÄÇ„Åó„Å∞„Çâ„Åè„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ...")}catch(t){console.error("GIF „Ç®„ÇØ„Çπ„Éù„Éº„Éà„Ç®„É©„Éº:",t),A("GIF „Ç®„ÇØ„Çπ„Éù„Éº„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: "+t.message)}},Sn=()=>{const{exportPngButton:t,exportGifButton:r}=N();t.addEventListener("click",_n),r.addEventListener("click",kn)},En=t=>{if(!t)return;t.textContent="",["nw","ne","sw","se"].forEach(u=>{const e=document.createElement("div");e.className=`bounding-box__handle bounding-box__handle--${u}`,t.appendChild(e)}),["top","right","bottom","left"].forEach(u=>{const e=document.createElement("div");e.className=`bounding-box__border bounding-box__border--${u}`,t.appendChild(e)})},Bn=t=>{if(!t)return;t.textContent="",["nw","ne","sw","se","n","e","s","w"].forEach(u=>{const e=document.createElement("div");e.className=`crop-box__handle crop-box__handle--${u}`,t.appendChild(e)}),["top","right","bottom","left"].forEach(u=>{const e=document.createElement("div");e.className=`crop-box__overlay crop-box__overlay--${u}`,t.appendChild(e)})},bn=()=>{console.log("XÁî®„Éù„Çπ„ÉàÁîªÂÉèÁîüÊàê„ÉÑ„Éº„É´ - ÂàùÊúüÂåñÈñãÂßã"),xt(),tn();const t=N();En(t.boundingBox),Bn(t.cropBox),dn(),gn(),wn(),Sn(),console.log("ÂàùÊúüÂåñÂÆå‰∫Ü")};document.addEventListener("DOMContentLoaded",bn);

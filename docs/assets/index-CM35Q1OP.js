(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function a(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(e){if(e.ep)return;e.ep=!0;const n=a(e);fetch(e.href,n)}})();const ln=()=>({backgroundDropzone:document.getElementById("backgroundDropzone"),transparentDropzone:document.getElementById("transparentDropzone"),backgroundButton:document.getElementById("backgroundButton"),transparentButton:document.getElementById("transparentButton"),backgroundInput:document.getElementById("backgroundInput"),transparentInput:document.getElementById("transparentInput"),previewContainer:document.getElementById("previewContainer"),previewCanvas:document.getElementById("previewCanvas"),previewPlaceholder:document.getElementById("previewPlaceholder"),boundingBox:document.getElementById("boundingBox"),cropBox:document.getElementById("cropBox"),modeToggleEdit:document.getElementById("modeToggleEdit"),modeToggleCrop:document.getElementById("modeToggleCrop"),cropControls:document.getElementById("cropControls"),editModeControls:document.querySelectorAll('[data-mode-panel="edit"]'),scaleInput:document.getElementById("scaleInput"),aspectRatioSelect:document.getElementById("aspectRatioSelect"),animationSpeedInput:document.getElementById("animationSpeedInput"),animationSpeedValue:document.getElementById("animationSpeedValue"),exportPngButton:document.getElementById("exportPngButton"),exportGifButton:document.getElementById("exportGifButton"),errorMessage:document.getElementById("errorMessage"),alignmentButtons:document.querySelectorAll("[data-align-target]"),positionInputX:document.getElementById("positionInputX"),positionInputY:document.getElementById("positionInputY")});let Ze;const Tt=()=>(Ze=ln(),Ze),O=()=>Ze??Tt(),cn=()=>({scale:1,position:{x:0,y:0},cropArea:null,aspectRatio:"original"}),g={backgroundImage:null,transparentImages:[],transformState:cn(),outputSettings:{format:"PNG",maxWidth:1200,maxHeight:675},animationSettings:{frameDelay:500}},A=t=>{const{errorMessage:r}=O();r&&(r.textContent=t,r.style.display="block",r.style.backgroundColor="#f44336",r.style.color="white",setTimeout(()=>{r.style.display="none"},5e3))},Te=t=>{const{errorMessage:r}=O();r&&(r.textContent=t,r.style.display="block",r.style.backgroundColor="#4CAF50",r.style.color="white",setTimeout(()=>{r.style.display="none",r.style.backgroundColor="#f44336",r.style.color="white"},3e3))},dn=1,hn=10,Je=t=>t?hn:dn,un=(t,r)=>{switch(t){case"ArrowUp":return Je(r);case"ArrowDown":return-Je(r);default:return null}},gn=(t,r)=>{const a=Je(r);switch(t){case"ArrowLeft":return{axis:"x",delta:-a};case"ArrowRight":return{axis:"x",delta:a};case"ArrowUp":return{axis:"y",delta:-a};case"ArrowDown":return{axis:"y",delta:a};default:return null}};let k,Qe,V,Z,ve,we,et,Xt=[],dt,ht;const mn=()=>{const t=O();k=t.previewCanvas,Qe=t.previewPlaceholder,V=t.boundingBox,Z=t.cropBox,ve=t.modeToggleEdit,we=t.modeToggleCrop,et=t.cropControls,Xt=Array.from(t.editModeControls??[]),dt=t.exportPngButton,ht=t.exportGifButton,tt(),nt(!G)};let Re=null,Ae=0,G=!1,ue=!1,ke=null;const ze=t=>{ue=t},fn=()=>ue,tt=()=>{!ve||!we||(G?(we.classList.add("mode-toggle__button--active"),we.setAttribute("aria-pressed","true"),ve.classList.remove("mode-toggle__button--active"),ve.setAttribute("aria-pressed","false")):(ve.classList.add("mode-toggle__button--active"),ve.setAttribute("aria-pressed","true"),we.classList.remove("mode-toggle__button--active"),we.setAttribute("aria-pressed","false")))},nt=t=>{Xt.forEach(r=>{r&&(r.style.display=t?"":"none",r.setAttribute("aria-hidden",t?"false":"true"))})},xe=(t,r,a,s,e=null,n={})=>{const{useCropAreaOffset:c=!0}=n,m=t.metadata.width*r,l=t.metadata.height*r,h=a.x+(s.metadata.width-m)/2,d=a.y+(s.metadata.height-l)/2;if(e&&c){const o=h-e.x,i=d-e.y;return{x:o,y:i,width:m,height:l,baseX:h,baseY:d,cropOffsetX:e.x,cropOffsetY:e.y}}return{x:h,y:d,width:m,height:l}},Yt=()=>{if(!g.backgroundImage)return;const t=g.backgroundImage,r=k.getContext("2d",{willReadFrequently:!0});if(r.clearRect(0,0,k.width,k.height),r.drawImage(t.image,0,0),g.transparentImages.length>0){const a=g.transparentImages[0],s=g.transformState.scale,e=g.transformState.position,n=a.metadata.width*s,c=a.metadata.height*s,m=e.x+(t.metadata.width-n)/2,l=e.y+(t.metadata.height-c)/2;console.log("トリミングモード描画:",{posX:e.x,posY:e.y,bgWidth:t.metadata.width,bgHeight:t.metadata.height,scaledWidth:n,scaledHeight:c,absoluteX:m,absoluteY:l,cropArea:g.transformState.cropArea}),r.imageSmoothingEnabled=!1,r.drawImage(a.image,m,l,n,c)}},zt=()=>{const t=!!g.backgroundImage;g.transparentImages.length>0,dt.disabled=!t,ht.disabled=!(t&&g.transparentImages.length>1)},Y=()=>{if(!g.backgroundImage){k.style.display="none",Qe.style.display="flex",dt.disabled=!0,ht.disabled=!0;return}const t=g.backgroundImage,r=k.getContext("2d",{willReadFrequently:!0}),a=g.transformState.cropArea;if(G){k.width=t.metadata.width,k.height=t.metadata.height,Yt();return}if(a?(k.width=a.width,k.height=a.height):(k.width=t.metadata.width,k.height=t.metadata.height),Re&&(clearInterval(Re),Re=null),g.transparentImages.length>1){Ae=0;const s=()=>{r.clearRect(0,0,k.width,k.height),G?r.drawImage(t.image,0,0):a?r.drawImage(t.image,a.x,a.y,a.width,a.height,0,0,k.width,k.height):r.drawImage(t.image,0,0);const e=g.transparentImages[Ae];if(e){const n=g.transformState.scale,c=g.transformState.position,m=xe(e,n,c,t,a,{useCropAreaOffset:!G});r.imageSmoothingEnabled=!1,r.drawImage(e.image,m.x,m.y,m.width,m.height)}Ae=(Ae+1)%g.transparentImages.length};s(),Re=setInterval(s,g.animationSettings.frameDelay)}else if(g.transparentImages.length===1){r.clearRect(0,0,k.width,k.height),a?r.drawImage(t.image,a.x,a.y,a.width,a.height,0,0,k.width,k.height):r.drawImage(t.image,0,0);const s=g.transparentImages[0],e=g.transformState.scale,n=g.transformState.position,c=xe(s,e,n,t,a,{useCropAreaOffset:!G});r.imageSmoothingEnabled=!1,r.drawImage(s.image,c.x,c.y,c.width,c.height)}else r.clearRect(0,0,k.width,k.height),a?r.drawImage(t.image,a.x,a.y,a.width,a.height,0,0,k.width,k.height):r.drawImage(t.image,0,0);k.style.display="block",Qe.style.display="none",zt(),G?setTimeout(()=>ye(),100):g.transparentImages.length>0&&setTimeout(()=>ee(),100)},$e=(t=1e3)=>{ke&&(clearTimeout(ke),ke=null),ue=!0,ee(),ke=setTimeout(()=>{ue=!1,ee(),ke=null},t)},ft={"top-left":{horizontal:"start",vertical:"start"},"top-center":{horizontal:"center",vertical:"start"},"top-right":{horizontal:"end",vertical:"start"},"middle-left":{horizontal:"start",vertical:"center"},"middle-center":{horizontal:"center",vertical:"center"},"middle-right":{horizontal:"end",vertical:"center"},"bottom-left":{horizontal:"start",vertical:"end"},"bottom-center":{horizontal:"center",vertical:"end"},"bottom-right":{horizontal:"end",vertical:"end"}},pt=(t,r,a,s)=>{const e=a,n=a+s-r;return n<e?a+(s-r)/2:Math.min(Math.max(t,e),n)},vt=(t,r,a,s)=>{switch(t){case"start":return r;case"end":return r+a-s;case"center":default:return r+(a-s)/2}},pn=t=>{if(!ft[t]||!g.backgroundImage||g.transparentImages.length===0)return;const r=g.backgroundImage,a=g.transparentImages[0],s=g.transformState.scale,e=g.transformState.cropArea,n=a.metadata.width*s,c=a.metadata.height*s,m=e?{x:e.x,y:e.y,width:e.width,height:e.height}:{x:0,y:0,width:r.metadata.width,height:r.metadata.height},l=ft[t],h=vt(l.horizontal,m.x,m.width,n),d=vt(l.vertical,m.y,m.height,c),o=pt(h,n,m.x,m.width),i=pt(d,c,m.y,m.height);g.transformState.position.x=o-(r.metadata.width-n)/2,g.transformState.position.y=i-(r.metadata.height-c)/2,ze(!0),Y(),$e(1200)},ee=()=>{if(!g.backgroundImage||g.transparentImages.length===0||G||!ue){V.style.display="none";return}const t=g.backgroundImage,r=g.transparentImages[0],a=g.transformState.scale,s=g.transformState.position,e=g.transformState.cropArea,n=k.getBoundingClientRect(),c=xe(r,a,s,t,e),m=(()=>{if(e){const u=n.width/e.width,v=n.height/e.height;return Math.min(u,v)}const w=n.width/t.metadata.width,f=n.height/t.metadata.height;return Math.min(w,f)})(),l=e?(n.width-e.width*m)/2:(n.width-t.metadata.width*m)/2,h=e?(n.height-e.height*m)/2:(n.height-t.metadata.height*m)/2,d=c.x*m+l,o=c.y*m+h,i=c.width*m,p=c.height*m;V.style.display="block",V.style.left=d+"px",V.style.top=o+"px",V.style.width=i+"px",V.style.height=p+"px"},Ot=t=>{switch(t){case"1:1":return 1;case"16:9":return 16/9;case"9:16":return 9/16;case"4:3":return 4/3;case"3:4":return 3/4;case"free":return null;case"original":default:return g.backgroundImage?g.backgroundImage.metadata.width/g.backgroundImage.metadata.height:1}},ye=()=>{if(!g.backgroundImage||!G){Z.style.display="none";return}const t=g.backgroundImage,r=k.getBoundingClientRect(),a=r.width/t.metadata.width,s=r.height/t.metadata.height,e=Math.min(a,s);let n=g.transformState.cropArea;if(!n){if(g.transformState.aspectRatio==="original"||g.transformState.aspectRatio==="free")n={x:0,y:0,width:t.metadata.width,height:t.metadata.height};else{const i=Ot(g.transformState.aspectRatio),p=t.metadata.width/t.metadata.height;let w,f;i>p?(w=t.metadata.width,f=w/i):(f=t.metadata.height,w=f*i),n={x:(t.metadata.width-w)/2,y:(t.metadata.height-f)/2,width:w,height:f}}g.transformState.cropArea=n}const c=n.x*e,m=n.y*e,l=n.width*e,h=n.height*e,d=(r.width-t.metadata.width*e)/2,o=(r.height-t.metadata.height*e)/2;Z.style.display="block",Z.style.left=c+d+"px",Z.style.top=m+o+"px",Z.style.width=l+"px",Z.style.height=h+"px"},rt=t=>{const r=!!t;if(G===r){tt();return}if(G=r,G){et.style.display="block",nt(!1),V.style.display="none",ue=!1;const a=g.backgroundImage;a&&(k.width=a.metadata.width,k.height=a.metadata.height,Yt()),ye()}else et.style.display="none",nt(!0),Z.style.display="none",ue=!1,ee(),Y();tt()},te=()=>G;let Ut,$t,Wt,qt,Nt,jt,Ht=[],j,H;const vn=()=>{const t=O();Ut=t.scaleInput,$t=t.modeToggleEdit,Wt=t.modeToggleCrop,qt=t.animationSpeedInput,Nt=t.animationSpeedValue,jt=t.aspectRatioSelect,Ht=Array.from(t.alignmentButtons??[]),j=t.positionInputX,H=t.positionInputY},wn=()=>!!(g.backgroundImage&&g.transparentImages.length>0),ut=()=>{if(!wn())return null;const t=g.backgroundImage,r=g.transparentImages[0];if(!r?.metadata)return null;const a=g.transformState.scale,s=r.metadata.width*a,e=r.metadata.height*a,n=g.transformState.cropArea,c=n?{x:n.x,y:n.y,width:n.width,height:n.height}:{x:0,y:0,width:t.metadata.width,height:t.metadata.height},m=g.transformState.position.x+(t.metadata.width-s)/2,l=g.transformState.position.y+(t.metadata.height-e)/2;return{bg:t,bounds:c,overlaySize:{width:s,height:e},absoluteX:m,absoluteY:l}},wt=(t,r,a,s)=>{const e=a,n=a+s-r;return n<e?a+(s-r)/2:Math.min(Math.max(t,e),n)},xt=t=>{[j,H].forEach(r=>{r&&(r.disabled=t)})},Q=()=>{if(!j||!H)return;const t=ut();if(!t){xt(!0),j.value="",H.value="";return}xt(!1),j.value=Math.round(t.absoluteX),H.value=Math.round(t.absoluteY),j.setAttribute("aria-valuemin",`${Math.round(t.bounds.x)}`),H.setAttribute("aria-valuemin",`${Math.round(t.bounds.y)}`);const r=t.bounds.x+t.bounds.width-t.overlaySize.width,a=t.bounds.y+t.bounds.height-t.overlaySize.height;j.setAttribute("aria-valuemax",`${Math.round(r)}`),H.setAttribute("aria-valuemax",`${Math.round(a)}`)},Kt=(t,r,a)=>{const s=wt(r,t.overlaySize.width,t.bounds.x,t.bounds.width),e=wt(a,t.overlaySize.height,t.bounds.y,t.bounds.height);g.transformState.position.x=s-(t.bg.metadata.width-t.overlaySize.width)/2,g.transformState.position.y=e-(t.bg.metadata.height-t.overlaySize.height)/2,Y(),$e(1e3),Q()},Vt=(t,r)=>{const a=ut();if(!a)return;const s=t==="x"?a.absoluteX+r:a.absoluteX,e=t==="y"?a.absoluteY+r:a.absoluteY;Kt(a,s,e)},xn=(t,r)=>{const a=Number.parseInt(r,10);if(Number.isNaN(a))return;const s=ut();if(!s)return;const e=t==="x"?a:s.absoluteX,n=t==="y"?a:s.absoluteY;Kt(s,e,n)},yt=t=>{const r=t.target.dataset.axis;r&&xn(r,t.target.value)},yn=t=>{t.target.dataset.axis&&Number.isNaN(Number.parseInt(t.target.value,10))&&Q()},In=t=>{const r=t.target.dataset.axis;if(!r)return;const a=un(t.key,t.shiftKey);a!==null&&(t.preventDefault(),Vt(r,a))},bn=()=>{!j||!H||[j,H].forEach(t=>{t.addEventListener("input",yt),t.addEventListener("change",yt),t.addEventListener("blur",yn),t.addEventListener("keydown",In)})},_n=()=>{if(!g.backgroundImage||g.transparentImages.length===0)return;const t=g.transparentImages[0],r=g.transformState.scale,a=t.metadata.width*r,s=t.metadata.height*r;(a>g.outputSettings.maxWidth||s>g.outputSettings.maxHeight)&&A(`拡大後のサイズ（${a}×${s}px）が出力サイズ制限（${g.outputSettings.maxWidth}×${g.outputSettings.maxHeight}px）を超えています。`)},En=()=>{vn(),Ut.addEventListener("input",t=>{const r=parseInt(t.target.value,10);g.transformState.scale=r,console.log("拡大倍率変更:",r),Y(),_n(),Q(),!te()&&g.transparentImages.length>0&&$e(1e3)}),$t.addEventListener("click",()=>{rt(!1)}),Wt.addEventListener("click",()=>{rt(!0)}),qt.addEventListener("input",t=>{const r=parseInt(t.target.value,10);g.animationSettings.frameDelay=r,Nt.textContent=`${r}ms`,console.log("アニメーション速度変更:",r+"ms"),g.transparentImages.length>1&&Y()}),jt.addEventListener("change",t=>{const r=t.target.value;g.transformState.aspectRatio=r,console.log("アスペクト比変更:",r),te()?(g.transformState.cropArea=null,ye()):Y()}),Ht.forEach(t=>{t.addEventListener("click",()=>{const r=t.getAttribute("data-align-target");r&&(console.log("整列ボタン押下:",r),pn(r),Q())})}),bn(),Q()};function kn(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Pe={},It;function Sn(){if(It)return Pe;It=1;function t(e,n,c,h){var l=0,h=h===void 0?{}:h,d=h.loop===void 0?null:h.loop,o=h.palette===void 0?null:h.palette;if(n<=0||c<=0||n>65535||c>65535)throw new Error("Width/Height invalid.");function i(I){var b=I.length;if(b<2||b>256||b&b-1)throw new Error("Invalid code/color length, must be power of 2 and 2 .. 256.");return b}e[l++]=71,e[l++]=73,e[l++]=70,e[l++]=56,e[l++]=57,e[l++]=97;var p=0,w=0;if(o!==null){for(var f=i(o);f>>=1;)++p;if(f=1<<p,--p,h.background!==void 0){if(w=h.background,w>=f)throw new Error("Background index out of range.");if(w===0)throw new Error("Background index explicitly passed as 0.")}}if(e[l++]=n&255,e[l++]=n>>8&255,e[l++]=c&255,e[l++]=c>>8&255,e[l++]=(o!==null?128:0)|p,e[l++]=w,e[l++]=0,o!==null)for(var u=0,v=o.length;u<v;++u){var x=o[u];e[l++]=x>>16&255,e[l++]=x>>8&255,e[l++]=x&255}if(d!==null){if(d<0||d>65535)throw new Error("Loop count invalid.");e[l++]=33,e[l++]=255,e[l++]=11,e[l++]=78,e[l++]=69,e[l++]=84,e[l++]=83,e[l++]=67,e[l++]=65,e[l++]=80,e[l++]=69,e[l++]=50,e[l++]=46,e[l++]=48,e[l++]=3,e[l++]=1,e[l++]=d&255,e[l++]=d>>8&255,e[l++]=0}var y=!1;this.addFrame=function(I,b,S,_,C,E){if(y===!0&&(--l,y=!1),E=E===void 0?{}:E,I<0||b<0||I>65535||b>65535)throw new Error("x/y invalid.");if(S<=0||_<=0||S>65535||_>65535)throw new Error("Width/Height invalid.");if(C.length<S*_)throw new Error("Not enough pixels for the frame size.");var D=!0,L=E.palette;if(L==null&&(D=!1,L=o),L==null)throw new Error("Must supply either a local or global palette.");for(var K=i(L),T=0;K>>=1;)++T;K=1<<T;var z=E.delay===void 0?0:E.delay,X=E.disposal===void 0?0:E.disposal;if(X<0||X>3)throw new Error("Disposal out of range.");var me=!1,ne=0;if(E.transparent!==void 0&&E.transparent!==null&&(me=!0,ne=E.transparent,ne<0||ne>=K))throw new Error("Transparent color index.");if((X!==0||me||z!==0)&&(e[l++]=33,e[l++]=249,e[l++]=4,e[l++]=X<<2|(me===!0?1:0),e[l++]=z&255,e[l++]=z>>8&255,e[l++]=ne,e[l++]=0),e[l++]=44,e[l++]=I&255,e[l++]=I>>8&255,e[l++]=b&255,e[l++]=b>>8&255,e[l++]=S&255,e[l++]=S>>8&255,e[l++]=_&255,e[l++]=_>>8&255,e[l++]=D===!0?128|T-1:0,D===!0)for(var fe=0,U=L.length;fe<U;++fe){var P=L[fe];e[l++]=P>>16&255,e[l++]=P>>8&255,e[l++]=P&255}return l=r(e,l,T<2?2:T,C),l},this.end=function(){return y===!1&&(e[l++]=59,y=!0),l},this.getOutputBuffer=function(){return e},this.setOutputBuffer=function(I){e=I},this.getOutputBufferPosition=function(){return l},this.setOutputBufferPosition=function(I){l=I}}function r(e,n,c,m){e[n++]=c;var l=n++,h=1<<c,d=h-1,o=h+1,i=o+1,p=c+1,w=0,f=0;function u(E){for(;w>=E;)e[n++]=f&255,f>>=8,w-=8,n===l+256&&(e[l]=255,l=n++)}function v(E){f|=E<<w,w+=p,u(8)}var x=m[0]&d,y={};v(h);for(var I=1,b=m.length;I<b;++I){var S=m[I]&d,_=x<<8|S,C=y[_];if(C===void 0){for(f|=x<<w,w+=p;w>=8;)e[n++]=f&255,f>>=8,w-=8,n===l+256&&(e[l]=255,l=n++);i===4096?(v(h),i=o+1,p=c+1,y={}):(i>=1<<p&&++p,y[_]=i++),x=S}else x=C}return v(x),v(o),u(1),l+1===n?e[l]=0:(e[l]=n-l-1,e[n++]=0),n}function a(e){var n=0;if(e[n++]!==71||e[n++]!==73||e[n++]!==70||e[n++]!==56||(e[n++]+1&253)!==56||e[n++]!==97)throw new Error("Invalid GIF 87a/89a header.");var c=e[n++]|e[n++]<<8,m=e[n++]|e[n++]<<8,l=e[n++],h=l>>7,d=l&7,o=1<<d+1;e[n++],e[n++];var i=null,p=null;h&&(i=n,p=o,n+=o*3);var w=!0,f=[],u=0,v=null,x=0,y=null;for(this.width=c,this.height=m;w&&n<e.length;)switch(e[n++]){case 33:switch(e[n++]){case 255:if(e[n]!==11||e[n+1]==78&&e[n+2]==69&&e[n+3]==84&&e[n+4]==83&&e[n+5]==67&&e[n+6]==65&&e[n+7]==80&&e[n+8]==69&&e[n+9]==50&&e[n+10]==46&&e[n+11]==48&&e[n+12]==3&&e[n+13]==1&&e[n+16]==0)n+=14,y=e[n++]|e[n++]<<8,n++;else for(n+=12;;){var I=e[n++];if(!(I>=0))throw Error("Invalid block size");if(I===0)break;n+=I}break;case 249:if(e[n++]!==4||e[n+4]!==0)throw new Error("Invalid graphics extension block.");var b=e[n++];u=e[n++]|e[n++]<<8,v=e[n++],(b&1)===0&&(v=null),x=b>>2&7,n++;break;case 254:for(;;){var I=e[n++];if(!(I>=0))throw Error("Invalid block size");if(I===0)break;n+=I}break;default:throw new Error("Unknown graphic control label: 0x"+e[n-1].toString(16))}break;case 44:var S=e[n++]|e[n++]<<8,_=e[n++]|e[n++]<<8,C=e[n++]|e[n++]<<8,E=e[n++]|e[n++]<<8,D=e[n++],L=D>>7,K=D>>6&1,T=D&7,z=1<<T+1,X=i,me=p,ne=!1;if(L){var ne=!0;X=n,me=z,n+=z*3}var fe=n;for(n++;;){var I=e[n++];if(!(I>=0))throw Error("Invalid block size");if(I===0)break;n+=I}f.push({x:S,y:_,width:C,height:E,has_local_palette:ne,palette_offset:X,palette_size:me,data_offset:fe,data_length:n-fe,transparent_index:v,interlaced:!!K,delay:u,disposal:x});break;case 59:w=!1;break;default:throw new Error("Unknown gif block: 0x"+e[n-1].toString(16))}this.numFrames=function(){return f.length},this.loopCount=function(){return y},this.frameInfo=function(U){if(U<0||U>=f.length)throw new Error("Frame index out of range.");return f[U]},this.decodeAndBlitFrameBGRA=function(U,P){var B=this.frameInfo(U),_e=B.width*B.height,re=new Uint8Array(_e);s(e,B.data_offset,re,_e);var ae=B.palette_offset,oe=B.transparent_index;oe===null&&(oe=256);var $=B.width,ie=c-$,se=$,Ee=(B.y*c+B.x)*4,We=((B.y+B.height)*c+B.x)*4,F=Ee,le=ie*4;B.interlaced===!0&&(le+=c*4*7);for(var ce=8,de=0,qe=re.length;de<qe;++de){var W=re[de];if(se===0&&(F+=le,se=$,F>=We&&(le=ie*4+c*4*(ce-1),F=Ee+($+ie)*(ce<<1),ce>>=1)),W===oe)F+=4;else{var Ne=e[ae+W*3],je=e[ae+W*3+1],He=e[ae+W*3+2];P[F++]=He,P[F++]=je,P[F++]=Ne,P[F++]=255}--se}},this.decodeAndBlitFrameRGBA=function(U,P){var B=this.frameInfo(U),_e=B.width*B.height,re=new Uint8Array(_e);s(e,B.data_offset,re,_e);var ae=B.palette_offset,oe=B.transparent_index;oe===null&&(oe=256);var $=B.width,ie=c-$,se=$,Ee=(B.y*c+B.x)*4,We=((B.y+B.height)*c+B.x)*4,F=Ee,le=ie*4;B.interlaced===!0&&(le+=c*4*7);for(var ce=8,de=0,qe=re.length;de<qe;++de){var W=re[de];if(se===0&&(F+=le,se=$,F>=We&&(le=ie*4+c*4*(ce-1),F=Ee+($+ie)*(ce<<1),ce>>=1)),W===oe)F+=4;else{var Ne=e[ae+W*3],je=e[ae+W*3+1],He=e[ae+W*3+2];P[F++]=Ne,P[F++]=je,P[F++]=He,P[F++]=255}--se}}}function s(e,n,c,m){for(var l=e[n++],h=1<<l,d=h+1,o=d+1,i=l+1,p=(1<<i)-1,w=0,f=0,u=0,v=e[n++],x=new Int32Array(4096),y=null;;){for(;w<16&&v!==0;)f|=e[n++]<<w,w+=8,v===1?v=e[n++]:--v;if(w<i)break;var I=f&p;if(f>>=i,w-=i,I===h){o=d+1,i=l+1,p=(1<<i)-1,y=null;continue}else if(I===d)break;for(var b=I<o?I:y,S=0,_=b;_>h;)_=x[_]>>8,++S;var C=_,E=u+S+(b!==I?1:0);if(E>m){console.log("Warning, gif stream longer than expected.");return}c[u++]=C,u+=S;var D=u;for(b!==I&&(c[u++]=C),_=b;S--;)_=x[_],c[--D]=_&255,_>>=8;y!==null&&o<4096&&(x[o++]=y<<8|C,o>=p+1&&i<12&&(++i,p=p<<1|1)),y=I}return u!==m&&console.log("Warning, gif stream shorter than expected."),c}try{Pe.GifWriter=t,Pe.GifReader=a}catch{}return Pe}var Bn=Sn(),q={},Ke={},N={},bt;function Zt(){if(bt)return N;bt=1,Object.defineProperty(N,"__esModule",{value:!0}),N.loop=N.conditional=N.parse=void 0;var t=function s(e,n){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:c;if(Array.isArray(n))n.forEach(function(h){return s(e,h,c,m)});else if(typeof n=="function")n(e,c,m,s);else{var l=Object.keys(n)[0];Array.isArray(n[l])?(m[l]={},s(e,n[l],c,m[l])):m[l]=n[l](e,c,m,s)}return c};N.parse=t;var r=function(e,n){return function(c,m,l,h){n(c,m,l)&&h(c,e,m,l)}};N.conditional=r;var a=function(e,n){return function(c,m,l,h){for(var d=[],o=c.pos;n(c,m,l);){var i={};if(h(c,e,m,i),c.pos===o)break;o=c.pos,d.push(i)}return d}};return N.loop=a,N}var M={},_t;function Jt(){if(_t)return M;_t=1,Object.defineProperty(M,"__esModule",{value:!0}),M.readBits=M.readArray=M.readUnsigned=M.readString=M.peekBytes=M.readBytes=M.peekByte=M.readByte=M.buildStream=void 0;var t=function(o){return{data:o,pos:0}};M.buildStream=t;var r=function(){return function(o){return o.data[o.pos++]}};M.readByte=r;var a=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(i){return i.data[i.pos+o]}};M.peekByte=a;var s=function(o){return function(i){return i.data.subarray(i.pos,i.pos+=o)}};M.readBytes=s;var e=function(o){return function(i){return i.data.subarray(i.pos,i.pos+o)}};M.peekBytes=e;var n=function(o){return function(i){return Array.from(s(o)(i)).map(function(p){return String.fromCharCode(p)}).join("")}};M.readString=n;var c=function(o){return function(i){var p=s(2)(i);return o?(p[1]<<8)+p[0]:(p[0]<<8)+p[1]}};M.readUnsigned=c;var m=function(o,i){return function(p,w,f){for(var u=typeof i=="function"?i(p,w,f):i,v=s(o),x=new Array(u),y=0;y<u;y++)x[y]=v(p);return x}};M.readArray=m;var l=function(o,i,p){for(var w=0,f=0;f<p;f++)w+=o[i+f]&&Math.pow(2,p-f-1);return w},h=function(o){return function(i){for(var p=r()(i),w=new Array(8),f=0;f<8;f++)w[7-f]=!!(p&1<<f);return Object.keys(o).reduce(function(u,v){var x=o[v];return x.length?u[v]=l(w,x.index,x.length):u[v]=w[x.index],u},{})}};return M.readBits=h,M}var Et;function Cn(){return Et||(Et=1,(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=Zt(),a=Jt(),s={blocks:function(i){for(var p=0,w=[],f=i.data.length,u=0,v=(0,a.readByte)()(i);v!==p&&v;v=(0,a.readByte)()(i)){if(i.pos+v>=f){var x=f-i.pos;w.push((0,a.readBytes)(x)(i)),u+=x;break}w.push((0,a.readBytes)(v)(i)),u+=v}for(var y=new Uint8Array(u),I=0,b=0;b<w.length;b++)y.set(w[b],I),I+=w[b].length;return y}},e=(0,r.conditional)({gce:[{codes:(0,a.readBytes)(2)},{byteSize:(0,a.readByte)()},{extras:(0,a.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,a.readUnsigned)(!0)},{transparentColorIndex:(0,a.readByte)()},{terminator:(0,a.readByte)()}]},function(o){var i=(0,a.peekBytes)(2)(o);return i[0]===33&&i[1]===249}),n=(0,r.conditional)({image:[{code:(0,a.readByte)()},{descriptor:[{left:(0,a.readUnsigned)(!0)},{top:(0,a.readUnsigned)(!0)},{width:(0,a.readUnsigned)(!0)},{height:(0,a.readUnsigned)(!0)},{lct:(0,a.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,r.conditional)({lct:(0,a.readArray)(3,function(o,i,p){return Math.pow(2,p.descriptor.lct.size+1)})},function(o,i,p){return p.descriptor.lct.exists}),{data:[{minCodeSize:(0,a.readByte)()},s]}]},function(o){return(0,a.peekByte)()(o)===44}),c=(0,r.conditional)({text:[{codes:(0,a.readBytes)(2)},{blockSize:(0,a.readByte)()},{preData:function(i,p,w){return(0,a.readBytes)(w.text.blockSize)(i)}},s]},function(o){var i=(0,a.peekBytes)(2)(o);return i[0]===33&&i[1]===1}),m=(0,r.conditional)({application:[{codes:(0,a.readBytes)(2)},{blockSize:(0,a.readByte)()},{id:function(i,p,w){return(0,a.readString)(w.blockSize)(i)}},s]},function(o){var i=(0,a.peekBytes)(2)(o);return i[0]===33&&i[1]===255}),l=(0,r.conditional)({comment:[{codes:(0,a.readBytes)(2)},s]},function(o){var i=(0,a.peekBytes)(2)(o);return i[0]===33&&i[1]===254}),h=[{header:[{signature:(0,a.readString)(3)},{version:(0,a.readString)(3)}]},{lsd:[{width:(0,a.readUnsigned)(!0)},{height:(0,a.readUnsigned)(!0)},{gct:(0,a.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,a.readByte)()},{pixelAspectRatio:(0,a.readByte)()}]},(0,r.conditional)({gct:(0,a.readArray)(3,function(o,i){return Math.pow(2,i.lsd.gct.size+1)})},function(o,i){return i.lsd.gct.exists}),{frames:(0,r.loop)([e,m,l,n,c],function(o){var i=(0,a.peekByte)()(o);return i===33||i===44})}],d=h;t.default=d})(Ke)),Ke}var Se={},kt;function Mn(){if(kt)return Se;kt=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.deinterlace=void 0;var t=function(a,s){for(var e=new Array(a.length),n=a.length/s,c=function(p,w){var f=a.slice(w*s,(w+1)*s);e.splice.apply(e,[p*s,s].concat(f))},m=[0,4,2,1],l=[8,8,4,2],h=0,d=0;d<4;d++)for(var o=m[d];o<n;o+=l[d])c(o,h),h++;return e};return Se.deinterlace=t,Se}var Be={},St;function Ln(){if(St)return Be;St=1,Object.defineProperty(Be,"__esModule",{value:!0}),Be.lzw=void 0;var t=function(a,s,e){var n=4096,c=-1,m=e,l,h,d,o,i,p,w,_,f,u,S,v,C,E,L,D,x=new Array(e),y=new Array(n),I=new Array(n),b=new Array(n+1);for(v=a,h=1<<v,i=h+1,l=h+2,w=c,o=v+1,d=(1<<o)-1,f=0;f<h;f++)y[f]=0,I[f]=f;var S,_,C,E,D,L;for(S=_=C=E=D=L=0,u=0;u<m;){if(E===0){if(_<o){S+=s[L]<<_,_+=8,L++;continue}if(f=S&d,S>>=o,_-=o,f>l||f==i)break;if(f==h){o=v+1,d=(1<<o)-1,l=h+2,w=c;continue}if(w==c){b[E++]=I[f],w=f,C=f;continue}for(p=f,f==l&&(b[E++]=C,f=w);f>h;)b[E++]=I[f],f=y[f];C=I[f]&255,b[E++]=C,l<n&&(y[l]=w,I[l]=C,l++,(l&d)===0&&l<n&&(o++,d+=l)),w=p}E--,x[D++]=b[E],u++}for(u=D;u<m;u++)x[u]=0;return x};return Be.lzw=t,Be}var Bt;function Dn(){if(Bt)return q;Bt=1,Object.defineProperty(q,"__esModule",{value:!0}),q.decompressFrames=q.decompressFrame=q.parseGIF=void 0;var t=n(Cn()),r=Zt(),a=Jt(),s=Mn(),e=Ln();function n(d){return d&&d.__esModule?d:{default:d}}var c=function(o){var i=new Uint8Array(o);return(0,r.parse)((0,a.buildStream)(i),t.default)};q.parseGIF=c;var m=function(o){for(var i=o.pixels.length,p=new Uint8ClampedArray(i*4),w=0;w<i;w++){var f=w*4,u=o.pixels[w],v=o.colorTable[u]||[0,0,0];p[f]=v[0],p[f+1]=v[1],p[f+2]=v[2],p[f+3]=u!==o.transparentIndex?255:0}return p},l=function(o,i,p){if(!o.image){console.warn("gif frame does not have associated image.");return}var w=o.image,f=w.descriptor.width*w.descriptor.height,u=(0,e.lzw)(w.data.minCodeSize,w.data.blocks,f);w.descriptor.lct.interlaced&&(u=(0,s.deinterlace)(u,w.descriptor.width));var v={pixels:u,dims:{top:o.image.descriptor.top,left:o.image.descriptor.left,width:o.image.descriptor.width,height:o.image.descriptor.height}};return w.descriptor.lct&&w.descriptor.lct.exists?v.colorTable=w.lct:v.colorTable=i,o.gce&&(v.delay=(o.gce.delay||10)*10,v.disposalType=o.gce.extras.disposal,o.gce.extras.transparentColorGiven&&(v.transparentIndex=o.gce.transparentColorIndex)),p&&(v.patch=m(v)),v};q.decompressFrame=l;var h=function(o,i){return o.frames.filter(function(p){return p.image}).map(function(p){return l(p,o.gct,i)})};return q.decompressFrames=h,q}var Ct=Dn();const Fn=10*1024*1024,Rn=["image/png","image/jpeg","image/jpg","image/gif","image/webp"],Qt=(t,{onInvalid:r}={})=>Rn.includes(t.type)?t.size>Fn?(r?.("ファイルサイズが大きすぎます。10MB以下のファイルを選択してください。"),!1):!0:(r?.("対応していないファイル形式です。PNG、JPEG、GIF、WebPファイルを選択してください。"),!1),at=t=>t.type==="image/gif",ot=t=>new Promise((r,a)=>{const s=new FileReader;s.onload=e=>{const n=new Image;n.onload=()=>r(n),n.onerror=()=>a(new Error("画像の読み込みに失敗しました")),n.src=e.target.result},s.onerror=()=>a(new Error("ファイルの読み込みに失敗しました")),s.readAsDataURL(t)}),Xe=(t,r)=>{const a=document.createElement("canvas"),s=a.getContext("2d",{willReadFrequently:!0});return a.width=r.width,a.height=r.height,s.drawImage(r,0,0),{id:Date.now().toString()+Math.random().toString(36).substring(2,11),file:t,image:r,canvas:a,metadata:{width:r.width,height:r.height,type:t.type}}},An=async(t,{fullFrame:r=!0}={})=>{const a=await t.arrayBuffer();return r?Gn(a):Tn(a)},Pn=async(t,r,a,s=null)=>{const e=document.createElement("canvas");e.width=r,e.height=a;const n=e.getContext("2d");s!==null?(n.fillStyle=s,n.fillRect(0,0,r,a)):n.clearRect(0,0,r,a);const c=[];let m=null;for(let l=0;l<t.length;l++){const h=t[l];h.disposalType===3&&(m=n.getImageData(0,0,r,a));const d=h.dims.width,o=h.dims.height;if(d>0&&o>0){const p=new ImageData(new Uint8ClampedArray(h.patch),d,o);if(window.createImageBitmap){const w=await createImageBitmap(p);n.drawImage(w,h.dims.left,h.dims.top),w.close?.()}else{const w=document.createElement("canvas");w.width=d,w.height=o,w.getContext("2d").putImageData(p,0,0),n.drawImage(w,h.dims.left,h.dims.top)}}const i=await new Promise((p,w)=>{const f=new Image;f.onload=()=>p(f),f.onerror=w,f.src=e.toDataURL("image/png")});switch(c.push({image:i,delay:h.delay??100,disposal:h.disposalType??h.disposal}),h.disposalType){case 2:s!==null?(n.fillStyle=s,n.fillRect(h.dims.left,h.dims.top,h.dims.width,h.dims.height)):n.clearRect(h.dims.left,h.dims.top,h.dims.width,h.dims.height);break;case 3:m?n.putImageData(m,0,0):n.clearRect(h.dims.left,h.dims.top,h.dims.width,h.dims.height);break}}return c},Gn=async t=>{const r=Ct.parseGIF(t),a=Ct.decompressFrames(r,!0);return(await Pn(a,r.lsd.width,r.lsd.height,null)).map(e=>({image:e.image,delay:e.delay,disposal:e.disposal}))},Tn=async t=>{try{const r=new Uint8Array(t),a=new Bn.GifReader(r),s=[],e=document.createElement("canvas"),n=e.getContext("2d");e.width=a.width,e.height=a.height;for(let c=0;c<a.numFrames();c++){const m=a.frameInfo(c),l=n.createImageData(e.width,e.height);a.decodeAndBlitFrameRGBA(c,l.data),n.putImageData(l,0,0);const h=new Image;await new Promise((d,o)=>{h.onload=d,h.onerror=o,h.src=e.toDataURL("image/png")}),s.push({image:h,delay:m.delay*10,disposal:m.disposal})}return s}catch(r){return console.error("GIF解析エラー:",r),Xn(t)}},Xn=async t=>{const r=new Blob([t],{type:"image/gif"}),a=URL.createObjectURL(r);try{const s=new Image;await new Promise((m,l)=>{s.onload=m,s.onerror=l,s.src=a});const e=document.createElement("canvas"),n=e.getContext("2d");e.width=s.width,e.height=s.height,n.drawImage(s,0,0);const c=new Image;return await new Promise((m,l)=>{c.onload=m,c.onerror=l,c.src=e.toDataURL("image/png")}),[{image:c,delay:500,disposal:0}]}catch(s){throw console.error("フォールバックGIF処理エラー:",s),s}finally{URL.revokeObjectURL(a)}};let gt,mt,en,tn,it,st,lt,nn,R,Ce;const pe=500,Yn=()=>g.transparentImages.length===0?null:g.transparentImages.some(r=>r.frameInfo?.isFromGif)?"gif":g.transparentImages.length>1?"sequence":null,zn=t=>t.some(r=>at(r))?"gif":t.length>1?"sequence":null,rn=(t,{icon:r,text:a,subtext:s})=>{const e=t.querySelector(".upload-area__icon");e&&r&&(e.textContent=r);const n=t.querySelector(".upload-area__text");n&&(n.textContent=a);const c=t.querySelector(".upload-area__subtext");c&&(c.textContent=s)},On=()=>{const t=O();gt=t.backgroundDropzone,mt=t.transparentDropzone,en=t.backgroundButton,tn=t.transparentButton,it=t.backgroundInput,st=t.transparentInput,lt=t.scaleInput,nn=t.aspectRatioSelect,R=t.animationSpeedInput,Ce=t.animationSpeedValue},Un=()=>{const t=(r,a)=>{r.addEventListener("dragover",s=>{s.preventDefault(),r.classList.add("upload-area__dropzone--dragover")}),r.addEventListener("dragleave",()=>{r.classList.remove("upload-area__dropzone--dragover")}),r.addEventListener("drop",s=>{s.preventDefault(),r.classList.remove("upload-area__dropzone--dragover");const e=s.dataTransfer?.files;e&&e.length>0&&a(e)})};t(gt,r=>an(r[0])),t(mt,on)},$n=()=>{en.addEventListener("click",()=>{it.click()}),tn.addEventListener("click",()=>{st.click()}),it.addEventListener("change",t=>{const r=t.target.files;r&&r.length>0&&an(r[0]),t.target.value=""}),st.addEventListener("change",t=>{const r=t.target.files;r&&r.length>0&&on(r),t.target.value=""})},an=async t=>{if(Qt(t,{onInvalid:A}))try{console.log("背景画像読み込み開始:",t.name);const r=await ot(t),a=Xe(t,r);g.backgroundImage=a,g.transformState.cropArea=null,g.transformState.aspectRatio="original",nn.value="original",te()&&rt(!1),rn(gt,{icon:"✅",text:`背景画像: ${t.name}`,subtext:`${r.width} × ${r.height}px`}),Y(),Q(),console.log("背景画像読み込み完了")}catch(r){console.error("背景画像読み込みエラー:",r),A("背景画像の読み込みに失敗しました: "+r.message)}},on=async t=>{const r=Array.from(t).filter(a=>Qt(a,{onInvalid:A}));if(r.length!==0)try{console.log("透過画像読み込み開始:",r.map(d=>d.name));const a=g.transparentImages.length>0,s=Yn(),e=zn(r);g.transparentImages=[],a||(g.transformState.position={x:0,y:0}),a&&s==="sequence"&&e==="sequence"?lt.value=g.transformState.scale:(g.transformState.scale=1,lt.value=1);for(const d of r)if(at(d)){console.log("GIFファイルを処理中:",d.name);try{const o=await An(d,{fullFrame:!0}),i=o.map(u=>u.delay),p=i.reduce((u,v)=>u+v,0)/i.length,w=Math.min(...i),f=Math.max(...i);if(p>0){const u=Math.round(p),v=parseInt(R.min,10),x=parseInt(R.max,10),y=Math.min(v,Math.max(10,Math.round(w))),I=Math.max(x,Math.round(f));R.min=y,R.max=I,R.step=u<100?10:50,g.animationSettings.frameDelay=u,R.value=u,Ce.textContent=`${u}ms`,console.log(`GIFの元フレーム間隔を適用: ${u}ms (範囲: ${y}-${I}ms)`),console.log("フレーム間隔の詳細:",i)}else R.min=50,R.max=2e3,R.step=50,g.animationSettings.frameDelay=pe,R.value=pe,Ce.textContent=`${pe}ms`,console.log("GIFのディレイ情報が欠落していたため、デフォルト500msを適用");for(let u=0;u<o.length;u++){const v=o[u],x=new File([d],`${d.name}_frame_${u+1}`,{type:"image/png"}),y=Xe(x,v.image);y.frameInfo={delay:v.delay,disposal:v.disposal,isFromGif:!0,originalIndex:u},g.transparentImages.push(y)}console.log(`GIFから ${o.length} フレームを抽出しました`)}catch(o){console.error("GIF処理エラー:",o),A(`GIFファイル ${d.name} の処理に失敗しました: ${o.message}`);const i=await ot(d),p=Xe(d,i);g.transparentImages.push(p)}}else{const o=await ot(d),i=Xe(d,o);g.transparentImages.push(i)}const c=g.transparentImages.some(d=>d.frameInfo?.isFromGif);if(e==="sequence"&&!c)if(R.min=50,R.max=2e3,R.step=50,s==="sequence"&&e==="sequence"){const o=g.animationSettings.frameDelay;R.value=o,Ce.textContent=`${o}ms`,console.log("連番PNGどうしの差し替え: 再生速度を維持")}else g.animationSettings.frameDelay=pe,R.value=pe,Ce.textContent=`${pe}ms`,console.log("連番PNGアニメーションをデフォルト500msに設定");const m=g.transparentImages.length,l=r.some(d=>at(d));let h="";l?h=`GIF含む ${r.length}ファイル → ${m}フレーム`:h=r.map(d=>d.name).join(", "),rn(mt,{icon:"✨",text:`透過画像: ${h}`,subtext:`総フレーム数: ${m}`}),Y(),Q(),zt(),!te()&&g.transparentImages.length>0&&(ze(!0),ee()),console.log("透過画像読み込み完了")}catch(a){console.error("透過画像読み込みエラー:",a),A("透過画像の読み込みに失敗しました: "+a.message)}},Wn=()=>{On(),Un(),$n()};let ge,ct,he,Me=!1,Le=!1,Ie=0,be=0,Oe=null,Ye=0,De=!1,Fe=!1,Ue=null;const J=50,Mt=(t,r,a)=>{let s=t;return s=Math.max(r,s),typeof a=="number"&&(s=Math.min(a,s)),s},qn=(t="")=>t.includes("--nw")?"nw":t.includes("--ne")?"ne":t.includes("--sw")?"sw":t.includes("--se")?"se":t.includes("--n")?"north":t.includes("--s")?"south":t.includes("--w")?"west":t.includes("--e")?"east":null,Nn=(t,r,a,s,e)=>{let n=Math.max(J,t),c=Math.max(J,r);return typeof s=="number"&&n>s&&(n=s,c=n/a),typeof e=="number"&&c>e&&(c=e,n=c*a,typeof s=="number"&&n>s&&(n=s,c=n/a)),n=Math.max(J,n),c=Math.max(J,c),{width:n,height:c}},jn=(t,r,a,s)=>{const e=r.x+r.width,n=r.y+r.height,c=r.x+r.width/2,m=r.y+r.height/2;switch(t){case"nw":return{maxWidth:e,maxHeight:n};case"ne":return{maxWidth:a-r.x,maxHeight:n};case"sw":return{maxWidth:e,maxHeight:s-r.y};case"se":return{maxWidth:a-r.x,maxHeight:s-r.y};case"north":return{maxWidth:2*Math.min(c,a-c),maxHeight:n};case"south":return{maxWidth:2*Math.min(c,a-c),maxHeight:s-r.y};case"west":return{maxWidth:e,maxHeight:2*Math.min(m,s-m)};case"east":return{maxWidth:a-r.x,maxHeight:2*Math.min(m,s-m)};default:return{maxWidth:void 0,maxHeight:void 0}}},Hn=(t,r,a,s)=>{const e=s.x+s.width,n=s.y+s.height,c=s.x+s.width/2,m=s.y+s.height/2;switch(t){case"nw":return{x:e-r,y:n-a};case"ne":return{x:s.x,y:n-a};case"sw":return{x:e-r,y:s.y};case"se":return{x:s.x,y:s.y};case"north":return{x:c-r/2,y:n-a};case"south":return{x:c-r/2,y:s.y};case"west":return{x:e-r,y:m-a/2};case"east":return{x:s.x,y:m-a/2};default:return{x:s.x,y:s.y}}},Kn=(t,r,a,s,e,n,c)=>{const m=g.transformState.aspectRatio;if(!m||m==="free")return;const l=Ot(m);if(!l)return;const h=qn(t);if(!h)return;const d=["nw","ne","sw","se"].includes(h);let o=a.width,i=a.height;if(d)Math.abs(s)>=Math.abs(e)?(o=Math.max(J,a.width),i=o/l):(i=Math.max(J,a.height),o=i*l);else if(h==="north"||h==="south")i=Math.max(J,a.height),o=i*l;else if(h==="east"||h==="west")o=Math.max(J,a.width),i=o/l;else return;const{maxWidth:p,maxHeight:w}=jn(h,r,n,c),f=Nn(o,i,l,p,w),u=Hn(h,f.width,f.height,r);a.x=Mt(u.x,0,n-f.width),a.y=Mt(u.y,0,c-f.height),a.width=f.width,a.height=f.height},sn=()=>{const t=O();ge=t.previewCanvas,ct=t.boundingBox,he=t.cropBox},Lt=t=>{t.target.classList.contains("bounding-box__handle")?(Le=!0,Oe=t.target):Me=!0,Ie=t.clientX,be=t.clientY,t.preventDefault(),t.stopPropagation()},Dt=t=>{if(!Me&&!Le)return;const r=t.clientX-Ie,a=t.clientY-be;if(Me){const s=g.backgroundImage,e=g.transformState.cropArea,n=ge.getBoundingClientRect();let c;if(e){const h=n.width/e.width,d=n.height/e.height;c=Math.min(h,d)}else{const h=n.width/s.metadata.width,d=n.height/s.metadata.height;c=Math.min(h,d)}const m=r/c,l=a/c;g.transformState.position.x+=m,g.transformState.position.y+=l,Y(),Q()}else if(Le&&Oe){const s=g.backgroundImage,e=ge.getBoundingClientRect();e.width/s.metadata.width,e.height/s.metadata.height;const n=Oe.className;let c=0;n.includes("--nw")||n.includes("--sw")?c=-r:(n.includes("--ne")||n.includes("--se"))&&(c=r),Ye+=c*.1;const l=g.transformState.scale,h=Math.max(1,Math.round(l+Ye));if(h!==g.transformState.scale){g.transformState.scale=h;const{scaleInput:d}=O();d.value=h,Y(),Ye=0}}Ie=t.clientX,be=t.clientY},Ft=()=>{Me=!1,Le=!1,Oe=null,Ye=0},Vn=()=>{sn(),ct.addEventListener("mousedown",Lt),document.addEventListener("mousemove",Dt),document.addEventListener("mouseup",Ft),ct.addEventListener("touchstart",t=>{const r=t.touches[0],a=new MouseEvent("mousedown",{clientX:r.clientX,clientY:r.clientY});Lt(a),t.preventDefault()}),document.addEventListener("touchmove",t=>{if(Me||Le){const r=t.touches[0],a=new MouseEvent("mousemove",{clientX:r.clientX,clientY:r.clientY});Dt(a),t.preventDefault()}}),document.addEventListener("touchend",Ft)},Rt=t=>{t.target.classList.contains("crop-box__handle")?(Fe=!0,Ue=t.target,parseInt(he.style.left,10),parseInt(he.style.top,10),parseInt(he.style.width,10),parseInt(he.style.height,10)):De=!0,Ie=t.clientX,be=t.clientY,t.preventDefault(),t.stopPropagation()},At=t=>{if(!De&&!Fe)return;const r=t.clientX-Ie,a=t.clientY-be;if(De){const s=g.backgroundImage,e=ge.getBoundingClientRect(),n=e.width/s.metadata.width,c=e.height/s.metadata.height,m=Math.min(n,c),l=r/m,h=a/m,d=g.transformState.cropArea;if(!d)return;const o=Math.max(0,Math.min(s.metadata.width-d.width,d.x+l)),i=Math.max(0,Math.min(s.metadata.height-d.height,d.y+h));g.transformState.cropArea.x=o,g.transformState.cropArea.y=i,ye()}else if(Fe&&Ue){const s=g.backgroundImage,e=g.transformState.cropArea,n=ge.getBoundingClientRect();if(!e)return;const c=n.width/s.metadata.width,m=n.height/s.metadata.height,l=Math.min(c,m),h=r/l,d=a/l,o=Ue.className,i={...e};o.includes("--nw")?(e.x=Math.max(0,e.x+h),e.y=Math.max(0,e.y+d),e.width=Math.max(50,e.width-h),e.height=Math.max(50,e.height-d)):o.includes("--ne")?(e.y=Math.max(0,e.y+d),e.width=Math.max(50,e.width+h),e.height=Math.max(50,e.height-d)):o.includes("--sw")?(e.x=Math.max(0,e.x+h),e.width=Math.max(50,e.width-h),e.height=Math.max(50,e.height+d)):o.includes("--se")?(e.width=Math.max(50,e.width+h),e.height=Math.max(50,e.height+d)):o.includes("--n")?(e.y=Math.max(0,e.y+d),e.height=Math.max(50,e.height-d)):o.includes("--s")?e.height=Math.max(50,e.height+d):o.includes("--w")?(e.x=Math.max(0,e.x+h),e.width=Math.max(50,e.width-h)):o.includes("--e")&&(e.width=Math.max(50,e.width+h)),Kn(o,i,e,h,d,s.metadata.width,s.metadata.height),ye()}Ie=t.clientX,be=t.clientY},Pt=()=>{De=!1,Fe=!1,Ue=null},Zn=()=>{he.addEventListener("mousedown",Rt),document.addEventListener("mousemove",At),document.addEventListener("mouseup",Pt),he.addEventListener("touchstart",t=>{const r=t.touches[0],a=new MouseEvent("mousedown",{clientX:r.clientX,clientY:r.clientY});Rt(a),t.preventDefault()}),document.addEventListener("touchmove",t=>{if(De||Fe){const r=t.touches[0],a=new MouseEvent("mousemove",{clientX:r.clientX,clientY:r.clientY});At(a),t.preventDefault()}}),document.addEventListener("touchend",Pt)},Jn=()=>{ge.addEventListener("click",t=>{if(te()||g.transparentImages.length===0)return;const r=g.transparentImages[0],a=g.backgroundImage,s=g.transformState.scale,e=g.transformState.position,n=g.transformState.cropArea,c=ge.getBoundingClientRect(),m=t.clientX-c.left,l=t.clientY-c.top,h=xe(r,s,e,a,n),d=c.width/(n?n.width:a.metadata.width),o=c.height/(n?n.height:a.metadata.height),i=Math.min(d,o),p=n?(c.width-n.width*i)/2:(c.width-a.metadata.width*i)/2,w=n?(c.height-n.height*i)/2:(c.height-a.metadata.height*i)/2,f=h.x*i+p,u=h.y*i+w,v=h.width*i,x=h.height*i;m>=f&&m<=f+v&&l>=u&&l<=u+x?(ze(!0),ee()):(ze(!1),ee())})},Qn=()=>{let t=null;const r=()=>{g.backgroundImage&&(Y(),ee(),te()&&ye(),te()||$e(2e3))};window.addEventListener("resize",()=>{t&&clearTimeout(t),t=setTimeout(()=>{r()},150)}),window.addEventListener("orientationchange",()=>{setTimeout(r,300)})},er=()=>{sn(),Vn(),Zn(),Jn(),Qn(),rr()},tr=()=>{const t=O(),r=document.activeElement;return r===t.positionInputX||r===t.positionInputY},nr=t=>{if(t.defaultPrevented||te()||tr()||!fn()||!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t.key)||!g.backgroundImage||g.transparentImages.length===0)return;const r=gn(t.key,t.shiftKey);r&&(t.preventDefault(),Vt(r.axis,r.delta))},rr=()=>{window.addEventListener("keydown",nr)};function Ge(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ve={exports:{}},Gt;function ar(){return Gt||(Gt=1,(function(t,r){(function(a){t.exports=a()})(function(){return(function a(s,e,n){function c(h,d){if(!e[h]){if(!s[h]){var o=typeof Ge=="function"&&Ge;if(!d&&o)return o(h,!0);if(m)return m(h,!0);var i=new Error("Cannot find module '"+h+"'");throw i.code="MODULE_NOT_FOUND",i}var p=e[h]={exports:{}};s[h][0].call(p.exports,function(w){var f=s[h][1][w];return c(f||w)},p,p.exports,a,s,e,n)}return e[h].exports}for(var m=typeof Ge=="function"&&Ge,l=0;l<n.length;l++)c(n[l]);return c})({1:[function(a,s,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}s.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(d){if(!m(d)||d<0||isNaN(d))throw TypeError("n must be a positive number");return this._maxListeners=d,this},n.prototype.emit=function(d){var o,i,p,w,f,u;if(this._events||(this._events={}),d==="error"&&(!this._events.error||l(this._events.error)&&!this._events.error.length)){if(o=arguments[1],o instanceof Error)throw o;var v=new Error('Uncaught, unspecified "error" event. ('+o+")");throw v.context=o,v}if(i=this._events[d],h(i))return!1;if(c(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:w=Array.prototype.slice.call(arguments,1),i.apply(this,w)}else if(l(i))for(w=Array.prototype.slice.call(arguments,1),u=i.slice(),p=u.length,f=0;f<p;f++)u[f].apply(this,w);return!0},n.prototype.addListener=function(d,o){var i;if(!c(o))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",d,c(o.listener)?o.listener:o),this._events[d]?l(this._events[d])?this._events[d].push(o):this._events[d]=[this._events[d],o]:this._events[d]=o,l(this._events[d])&&!this._events[d].warned&&(h(this._maxListeners)?i=n.defaultMaxListeners:i=this._maxListeners,i&&i>0&&this._events[d].length>i&&(this._events[d].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[d].length),typeof console.trace=="function"&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(d,o){if(!c(o))throw TypeError("listener must be a function");var i=!1;function p(){this.removeListener(d,p),i||(i=!0,o.apply(this,arguments))}return p.listener=o,this.on(d,p),this},n.prototype.removeListener=function(d,o){var i,p,w,f;if(!c(o))throw TypeError("listener must be a function");if(!this._events||!this._events[d])return this;if(i=this._events[d],w=i.length,p=-1,i===o||c(i.listener)&&i.listener===o)delete this._events[d],this._events.removeListener&&this.emit("removeListener",d,o);else if(l(i)){for(f=w;f-- >0;)if(i[f]===o||i[f].listener&&i[f].listener===o){p=f;break}if(p<0)return this;i.length===1?(i.length=0,delete this._events[d]):i.splice(p,1),this._events.removeListener&&this.emit("removeListener",d,o)}return this},n.prototype.removeAllListeners=function(d){var o,i;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[d]&&delete this._events[d],this;if(arguments.length===0){for(o in this._events)o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[d],c(i))this.removeListener(d,i);else if(i)for(;i.length;)this.removeListener(d,i[i.length-1]);return delete this._events[d],this},n.prototype.listeners=function(d){var o;return!this._events||!this._events[d]?o=[]:c(this._events[d])?o=[this._events[d]]:o=this._events[d].slice(),o},n.prototype.listenerCount=function(d){if(this._events){var o=this._events[d];if(c(o))return 1;if(o)return o.length}return 0},n.listenerCount=function(d,o){return d.listenerCount(o)};function c(d){return typeof d=="function"}function m(d){return typeof d=="number"}function l(d){return typeof d=="object"&&d!==null}function h(d){return d===void 0}},{}],2:[function(a,s,e){var n,c,m,l,h;h=navigator.userAgent.toLowerCase(),l=navigator.platform.toLowerCase(),n=h.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],m=n[1]==="ie"&&document.documentMode,c={name:n[1]==="version"?n[3]:n[1],version:m||parseFloat(n[1]==="opera"&&n[4]?n[4]:n[2]),platform:{name:h.match(/ip(?:ad|od|hone)/)?"ios":(h.match(/(?:webos|android)/)||l.match(/mac|win|linux/)||["other"])[0]}},c[c.name]=!0,c[c.name+parseInt(c.version,10)]=!0,c.platform[c.platform.name]=!0,s.exports=c},{}],3:[function(a,s,e){var n,c,m,l=function(i,p){for(var w in p)h.call(p,w)&&(i[w]=p[w]);function f(){this.constructor=i}return f.prototype=p.prototype,i.prototype=new f,i.__super__=p.prototype,i},h={}.hasOwnProperty,d=[].indexOf||function(i){for(var p=0,w=this.length;p<w;p++)if(p in this&&this[p]===i)return p;return-1},o=[].slice;n=a("events").EventEmitter,m=a("./browser.coffee"),c=(function(i){var p,w;l(f,i),p={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},w={delay:500,copy:!1};function f(u){var v,x,y;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(u);for(x in p)y=p[x],(v=this.options)[x]==null&&(v[x]=y)}return f.prototype.setOption=function(u,v){if(this.options[u]=v,this._canvas!=null&&(u==="width"||u==="height"))return this._canvas[u]=v},f.prototype.setOptions=function(u){var v,x,y;x=[];for(v in u)h.call(u,v)&&(y=u[v],x.push(this.setOption(v,y)));return x},f.prototype.addFrame=function(u,v){var x,y;v==null&&(v={}),x={},x.transparent=this.options.transparent;for(y in w)x[y]=v[y]||w[y];if(this.options.width==null&&this.setOption("width",u.width),this.options.height==null&&this.setOption("height",u.height),typeof ImageData<"u"&&ImageData!==null&&u instanceof ImageData)x.data=u.data;else if(typeof CanvasRenderingContext2D<"u"&&CanvasRenderingContext2D!==null&&u instanceof CanvasRenderingContext2D||typeof WebGLRenderingContext<"u"&&WebGLRenderingContext!==null&&u instanceof WebGLRenderingContext)v.copy?x.data=this.getContextData(u):x.context=u;else if(u.childNodes!=null)v.copy?x.data=this.getImageData(u):x.image=u;else throw new Error("Invalid image");return this.frames.push(x)},f.prototype.render=function(){var u,v,x;if(this.running)throw new Error("Already running");if(this.options.width==null||this.options.height==null)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=(function(){var y,I,b;for(b=[],y=0,I=this.frames.length;0<=I?y<I:y>I;0<=I?++y:--y)b.push(null);return b}).call(this),v=this.spawnWorkers(),this.options.globalPalette===!0)this.renderNextFrame();else for(u=0,x=v;0<=x?u<x:u>x;0<=x?++u:--u)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},f.prototype.abort=function(){for(var u;u=this.activeWorkers.shift(),u!=null;)this.log("killing active worker"),u.terminate();return this.running=!1,this.emit("abort")},f.prototype.spawnWorkers=function(){var u,v,x;return u=Math.min(this.options.workers,this.frames.length),(function(){x=[];for(var y=v=this.freeWorkers.length;v<=u?y<u:y>u;v<=u?y++:y--)x.push(y);return x}).apply(this).forEach((function(y){return function(I){var b;return y.log("spawning worker "+I),b=new Worker(y.options.workerScript),b.onmessage=function(S){return y.activeWorkers.splice(y.activeWorkers.indexOf(b),1),y.freeWorkers.push(b),y.frameFinished(S.data)},y.freeWorkers.push(b)}})(this)),u},f.prototype.frameFinished=function(u){var v,x;if(this.log("frame "+u.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[u.index]=u,this.options.globalPalette===!0&&(this.options.globalPalette=u.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(v=1,x=this.freeWorkers.length;1<=x?v<x:v>x;1<=x?++v:--v)this.renderNextFrame();return d.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},f.prototype.finishRendering=function(){var u,v,x,y,I,b,S,_,C,E,D,L,K,T,z,X;for(_=0,T=this.imageParts,I=0,C=T.length;I<C;I++)v=T[I],_+=(v.data.length-1)*v.pageSize+v.cursor;for(_+=v.pageSize-v.cursor,this.log("rendering finished - filesize "+Math.round(_/1e3)+"kb"),u=new Uint8Array(_),L=0,z=this.imageParts,b=0,E=z.length;b<E;b++)for(v=z[b],X=v.data,x=S=0,D=X.length;S<D;x=++S)K=X[x],u.set(K,L),x===v.data.length-1?L+=v.cursor:L+=v.pageSize;return y=new Blob([u],{type:"image/gif"}),this.emit("finished",y,u)},f.prototype.renderNextFrame=function(){var u,v,x;if(this.freeWorkers.length===0)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return u=this.frames[this.nextFrame++],x=this.freeWorkers.shift(),v=this.getTask(u),this.log("starting frame "+(v.index+1)+" of "+this.frames.length),this.activeWorkers.push(x),x.postMessage(v)},f.prototype.getContextData=function(u){return u.getImageData(0,0,this.options.width,this.options.height).data},f.prototype.getImageData=function(u){var v;return this._canvas==null&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),v=this._canvas.getContext("2d"),v.setFill=this.options.background,v.fillRect(0,0,this.options.width,this.options.height),v.drawImage(u,0,0),this.getContextData(v)},f.prototype.getTask=function(u){var v,x;if(v=this.frames.indexOf(u),x={index:v,last:v===this.frames.length-1,delay:u.delay,transparent:u.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:m.name==="chrome"},u.data!=null)x.data=u.data;else if(u.context!=null)x.data=this.getContextData(u.context);else if(u.image!=null)x.data=this.getImageData(u.image);else throw new Error("Invalid frame");return x},f.prototype.log=function(){var u;if(u=1<=arguments.length?o.call(arguments,0):[],!!this.options.debug)return console.log.apply(console,u)},f})(n),s.exports=c},{"./browser.coffee":2,events:1}]},{},[3])(3)})})(Ve)),Ve.exports}var or=ar();const ir=kn(or),sr=()=>{if(!g.backgroundImage||g.transparentImages.length===0){A("背景画像と透過画像の両方が必要です");return}try{const t=document.createElement("canvas"),r=t.getContext("2d",{willReadFrequently:!0}),a=g.backgroundImage,s=g.transparentImages[0],e=g.transformState.scale,n=g.transformState.position,c=g.transformState.cropArea;c?(t.width=c.width,t.height=c.height):(t.width=a.metadata.width,t.height=a.metadata.height),c?r.drawImage(a.image,c.x,c.y,c.width,c.height,0,0,t.width,t.height):r.drawImage(a.image,0,0);const m=xe(s,e,n,a,c);r.imageSmoothingEnabled=!1,r.drawImage(s.image,m.x,m.y,m.width,m.height),t.toBlob(l=>{if(l){const h=URL.createObjectURL(l),d=document.createElement("a");d.href=h,d.download=`x-post-image-${Date.now()}.png`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(h),console.log("PNG エクスポート完了"),Te("PNG画像をダウンロードしました")}else throw new Error("PNG生成に失敗しました")},"image/png")}catch(t){console.error("PNG エクスポートエラー:",t),A("PNG エクスポートに失敗しました: "+t.message)}},lr=()=>{if(!g.backgroundImage||g.transparentImages.length===0){A("背景画像と透過画像の両方が必要です");return}if(g.transparentImages.length===1){A("GIF生成には複数の透過画像が必要です。単一画像の場合はPNGをご利用ください。");return}try{console.log("GIF生成開始...");const t=g.backgroundImage,r=g.transformState.scale,a=g.transformState.position,s=g.transformState.cropArea;let e,n;s?(e=s.width,n=s.height):(e=t.metadata.width,n=t.metadata.height);const c=new URL("/250811_png-gif-app/assets/gif.worker-CjkyQP34.js",import.meta.url).href,m=new ir({workers:2,quality:15,width:e,height:n,repeat:0,workerScript:c}),l=document.createElement("canvas"),h=l.getContext("2d",{willReadFrequently:!0});l.width=e,l.height=n,g.transparentImages.forEach((o,i)=>{try{h.clearRect(0,0,e,n),s?h.drawImage(t.image,s.x,s.y,s.width,s.height,0,0,e,n):h.drawImage(t.image,0,0);const p=xe(o,r,a,t,s);h.imageSmoothingEnabled=!1,h.drawImage(o.image,p.x,p.y,p.width,p.height),m.addFrame(l,{copy:!0,delay:g.animationSettings.frameDelay}),console.log(`フレーム ${i+1}/${g.transparentImages.length} 追加完了`)}catch(p){throw console.error(`フレーム ${i+1} の処理でエラー:`,p),p}}),m.on("finished",o=>{try{const i=URL.createObjectURL(o),p=document.createElement("a");p.href=i,p.download=`x-post-animation-${Date.now()}.gif`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(i),console.log("GIF エクスポート完了"),Te("GIFアニメーションをダウンロードしました")}catch(i){console.error("GIF ダウンロードエラー:",i),A("GIF ダウンロードに失敗しました")}}),m.on("error",o=>{console.error("GIF生成エラー:",o),A("GIF生成中にエラーが発生しました: "+o.message)}),m.on("progress",o=>{const i=Math.round(o*100);console.log(`GIF生成進捗: ${i}%`),i%25===0&&Te(`GIF生成中... ${i}%`)});const d=setTimeout(()=>{console.error("GIF生成がタイムアウトしました"),A("GIF生成に時間がかかりすぎています。画像サイズを小さくするか、フレーム数を減らしてください。")},3e4);m.on("finished",()=>{clearTimeout(d)}),m.render(),console.log("GIF生成処理を開始しました..."),Te("GIF生成中です。しばらくお待ちください...")}catch(t){console.error("GIF エクスポートエラー:",t),A("GIF エクスポートに失敗しました: "+t.message)}},cr=()=>{const{exportPngButton:t,exportGifButton:r}=O();t.addEventListener("click",sr),r.addEventListener("click",lr)},dr=t=>{if(!t)return;t.textContent="",["nw","ne","sw","se"].forEach(s=>{const e=document.createElement("div");e.className=`bounding-box__handle bounding-box__handle--${s}`,t.appendChild(e)}),["top","right","bottom","left"].forEach(s=>{const e=document.createElement("div");e.className=`bounding-box__border bounding-box__border--${s}`,t.appendChild(e)})},hr=t=>{if(!t)return;t.textContent="",["nw","ne","sw","se","n","e","s","w"].forEach(s=>{const e=document.createElement("div");e.className=`crop-box__handle crop-box__handle--${s}`,t.appendChild(e)}),["top","right","bottom","left"].forEach(s=>{const e=document.createElement("div");e.className=`crop-box__overlay crop-box__overlay--${s}`,t.appendChild(e)})},ur=()=>{console.log("X用ポスト画像生成ツール - 初期化開始"),Tt(),mn();const t=O();dr(t.boundingBox),hr(t.cropBox),Wn(),En(),er(),cr(),console.log("初期化完了")};document.addEventListener("DOMContentLoaded",ur);
